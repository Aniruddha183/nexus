module.exports=[53696,a=>{"use strict";let b=(0,a.i(50461).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);a.s(["Check",()=>b],53696)},59501,a=>{"use strict";let b=(0,a.i(50461).default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);a.s(["Upload",()=>b],59501)},9086,a=>{"use strict";let b=(0,a.i(50461).default)("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);a.s(["FileText",()=>b],9086)},69763,a=>a.a(async(b,c)=>{try{var d,e,f,g,h={640:(a,b,c)=>{c.d(b,{AnnotationLayer:()=>N,FreeTextAnnotationElement:()=>z,InkAnnotationElement:()=>G,StampAnnotationElement:()=>L});var d=c(266),e=c(473),f=c(780);function g(a){return Math.floor(255*Math.max(0,Math.min(1,a))).toString(16).padStart(2,"0")}function h(a){return Math.max(0,Math.min(255,255*a))}class i{static CMYK_G([a,b,c,d]){return["G",1-Math.min(1,.3*a+.59*c+.11*b+d)]}static G_CMYK([a]){return["CMYK",0,0,0,1-a]}static G_RGB([a]){return["RGB",a,a,a]}static G_rgb([a]){return[a=h(a),a,a]}static G_HTML([a]){let b=g(a);return`#${b}${b}${b}`}static RGB_G([a,b,c]){return["G",.3*a+.59*b+.11*c]}static RGB_rgb(a){return a.map(h)}static RGB_HTML(a){return`#${a.map(g).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([a,b,c,d]){return["RGB",1-Math.min(1,a+d),1-Math.min(1,c+d),1-Math.min(1,b+d)]}static CMYK_rgb([a,b,c,d]){return[h(1-Math.min(1,a+d)),h(1-Math.min(1,c+d)),h(1-Math.min(1,b+d))]}static CMYK_HTML(a){let b=this.CMYK_RGB(a).slice(1);return this.RGB_HTML(b)}static RGB_CMYK([a,b,c]){let d=1-a,e=1-b,f=1-c,g=Math.min(d,e,f);return["CMYK",d,e,f,g]}}var j=c(160);let k=new WeakSet;function l(a){return{width:a[2]-a[0],height:a[3]-a[1]}}class m{static create(a){switch(a.data.annotationType){case d.AnnotationType.LINK:return new o(a);case d.AnnotationType.TEXT:return new p(a);case d.AnnotationType.WIDGET:switch(a.data.fieldType){case"Tx":return new r(a);case"Btn":if(a.data.radioButton)return new u(a);if(a.data.checkBox)return new t(a);return new v(a);case"Ch":return new w(a);case"Sig":return new s(a)}return new q(a);case d.AnnotationType.POPUP:return new x(a);case d.AnnotationType.FREETEXT:return new z(a);case d.AnnotationType.LINE:return new A(a);case d.AnnotationType.SQUARE:return new B(a);case d.AnnotationType.CIRCLE:return new C(a);case d.AnnotationType.POLYLINE:return new D(a);case d.AnnotationType.CARET:return new F(a);case d.AnnotationType.INK:return new G(a);case d.AnnotationType.POLYGON:return new E(a);case d.AnnotationType.HIGHLIGHT:return new H(a);case d.AnnotationType.UNDERLINE:return new I(a);case d.AnnotationType.SQUIGGLY:return new J(a);case d.AnnotationType.STRIKEOUT:return new K(a);case d.AnnotationType.STAMP:return new L(a);case d.AnnotationType.FILEATTACHMENT:return new M(a);default:return new n(a)}}}class n{#a=!1;constructor(a,{isRenderable:b=!1,ignoreBorder:c=!1,createQuadrilaterals:d=!1}={}){this.isRenderable=b,this.data=a.data,this.layer=a.layer,this.linkService=a.linkService,this.downloadManager=a.downloadManager,this.imageResourcesPath=a.imageResourcesPath,this.renderForms=a.renderForms,this.svgFactory=a.svgFactory,this.annotationStorage=a.annotationStorage,this.enableScripting=a.enableScripting,this.hasJSActions=a.hasJSActions,this._fieldObjects=a.fieldObjects,this.parent=a.parent,b&&(this.container=this._createContainer(c)),d&&this._createQuadrilaterals()}static _hasPopupData({titleObj:a,contentsObj:b,richText:c}){return!!(a?.str||b?.str||c?.str)}get hasPopupData(){return n._hasPopupData(this.data)}_createContainer(a){let{data:b,parent:{page:c,viewport:e}}=this,f=document.createElement("section");f.setAttribute("data-annotation-id",b.id),this instanceof q||(f.tabIndex=1e3),f.style.zIndex=this.parent.zIndex++,this.data.popupRef&&f.setAttribute("aria-haspopup","dialog"),b.noRotate&&f.classList.add("norotate");let{pageWidth:g,pageHeight:h,pageX:i,pageY:j}=e.rawDims;if(!b.rect||this instanceof x){let{rotation:a}=b;return b.hasOwnCanvas||0===a||this.setRotation(a,f),f}let{width:k,height:m}=l(b.rect),n=d.Util.normalizeRect([b.rect[0],c.view[3]-b.rect[1]+c.view[1],b.rect[2],c.view[3]-b.rect[3]+c.view[1]]);if(!a&&b.borderStyle.width>0){f.style.borderWidth=`${b.borderStyle.width}px`;let a=b.borderStyle.horizontalCornerRadius,c=b.borderStyle.verticalCornerRadius;if(a>0||c>0){let b=`calc(${a}px * var(--scale-factor)) / calc(${c}px * var(--scale-factor))`;f.style.borderRadius=b}else if(this instanceof u){let a=`calc(${k}px * var(--scale-factor)) / calc(${m}px * var(--scale-factor))`;f.style.borderRadius=a}switch(b.borderStyle.style){case d.AnnotationBorderStyleType.SOLID:f.style.borderStyle="solid";break;case d.AnnotationBorderStyleType.DASHED:f.style.borderStyle="dashed";break;case d.AnnotationBorderStyleType.BEVELED:(0,d.warn)("Unimplemented border style: beveled");break;case d.AnnotationBorderStyleType.INSET:(0,d.warn)("Unimplemented border style: inset");break;case d.AnnotationBorderStyleType.UNDERLINE:f.style.borderBottomStyle="solid"}let e=b.borderColor||null;e?(this.#a=!0,f.style.borderColor=d.Util.makeHexColor(0|e[0],0|e[1],0|e[2])):f.style.borderWidth=0}f.style.left=`${100*(n[0]-i)/g}%`,f.style.top=`${100*(n[1]-j)/h}%`;let{rotation:o}=b;return b.hasOwnCanvas||0===o?(f.style.width=`${100*k/g}%`,f.style.height=`${100*m/h}%`):this.setRotation(o,f),f}setRotation(a,b=this.container){let c,d;if(!this.data.rect)return;let{pageWidth:e,pageHeight:f}=this.parent.viewport.rawDims,{width:g,height:h}=l(this.data.rect);a%180==0?(c=100*g/e,d=100*h/f):(c=100*h/e,d=100*g/f),b.style.width=`${c}%`,b.style.height=`${d}%`,b.setAttribute("data-main-rotation",(360-a)%360)}get _commonActions(){let a=(a,b,c)=>{let d=c.detail[a],e=d[0],f=d.slice(1);c.target.style[b]=i[`${e}_HTML`](f),this.annotationStorage.setValue(this.data.id,{[b]:i[`${e}_rgb`](f)})};return(0,d.shadow)(this,"_commonActions",{display:a=>{let{display:b}=a.detail,c=b%2==1;this.container.style.visibility=c?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:c,noPrint:1===b||2===b})},print:a=>{this.annotationStorage.setValue(this.data.id,{noPrint:!a.detail.print})},hidden:a=>{let{hidden:b}=a.detail;this.container.style.visibility=b?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:b,noView:b})},focus:a=>{setTimeout(()=>a.target.focus({preventScroll:!1}),0)},userName:a=>{a.target.title=a.detail.userName},readonly:a=>{a.target.disabled=a.detail.readonly},required:a=>{this._setRequired(a.target,a.detail.required)},bgColor:b=>{a("bgColor","backgroundColor",b)},fillColor:b=>{a("fillColor","backgroundColor",b)},fgColor:b=>{a("fgColor","color",b)},textColor:b=>{a("textColor","color",b)},borderColor:b=>{a("borderColor","borderColor",b)},strokeColor:b=>{a("strokeColor","borderColor",b)},rotation:a=>{let b=a.detail.rotation;this.setRotation(b),this.annotationStorage.setValue(this.data.id,{rotation:b})}})}_dispatchEventFromSandbox(a,b){let c=this._commonActions;for(let d of Object.keys(b.detail)){let e=a[d]||c[d];e?.(b)}}_setDefaultPropertiesFromJS(a){if(!this.enableScripting)return;let b=this.annotationStorage.getRawValue(this.data.id);if(!b)return;let c=this._commonActions;for(let[d,e]of Object.entries(b)){let f=c[d];if(f){let c={detail:{[d]:e},target:a};f(c),delete b[d]}}}_createQuadrilaterals(){let a;if(!this.container)return;let{quadPoints:b}=this.data;if(!b)return;let[c,d,e,f]=this.data.rect;if(1===b.length){let[,{x:a,y:g},{x:h,y:i}]=b[0];if(e===a&&f===g&&c===h&&d===i)return}let{style:g}=this.container;if(this.#a){let{borderColor:b,borderWidth:c}=g;g.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${b}" stroke-width="${c}">`],this.container.classList.add("hasBorder")}let h=e-c,i=f-d,{svgFactory:j}=this,k=j.createElement("svg");k.classList.add("quadrilateralsContainer"),k.setAttribute("width",0),k.setAttribute("height",0);let l=j.createElement("defs");k.append(l);let m=j.createElement("clipPath"),n=`clippath_${this.data.id}`;for(let[,{x:d,y:e},{x:g,y:k}]of(m.setAttribute("id",n),m.setAttribute("clipPathUnits","objectBoundingBox"),l.append(m),b)){let b=j.createElement("rect"),l=(g-c)/h,n=(f-e)/i,o=(d-g)/h,p=(e-k)/i;b.setAttribute("x",l),b.setAttribute("y",n),b.setAttribute("width",o),b.setAttribute("height",p),m.append(b),a?.push(`<rect vector-effect="non-scaling-stroke" x="${l}" y="${n}" width="${o}" height="${p}"/>`)}this.#a&&(a.push("</g></svg>')"),g.backgroundImage=a.join("")),this.container.append(k),this.container.style.clipPath=`url(#${n})`}_createPopup(){let{container:a,data:b}=this;a.setAttribute("aria-haspopup","dialog");let c=new x({data:{color:b.color,titleObj:b.titleObj,modificationDate:b.modificationDate,contentsObj:b.contentsObj,richText:b.richText,parentRect:b.rect,borderStyle:0,id:`popup_${b.id}`,rotation:b.rotation},parent:this.parent,elements:[this]});this.parent.div.append(c.render())}render(){(0,d.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(a,b=null){let c=[];if(this._fieldObjects){let e=this._fieldObjects[a];if(e)for(let{page:a,id:f,exportValues:g}of e){if(-1===a||f===b)continue;let e="string"==typeof g?g:null,h=document.querySelector(`[data-element-id="${f}"]`);if(h&&!k.has(h)){(0,d.warn)(`_getElementsByName - element not allowed: ${f}`);continue}c.push({id:f,exportValue:e,domElement:h})}return c}for(let d of document.getElementsByName(a)){let{exportValue:a}=d,e=d.getAttribute("data-element-id");e!==b&&k.has(d)&&c.push({id:e,exportValue:a,domElement:d})}return c}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){let a=this.getElementsToTriggerPopup();if(Array.isArray(a))for(let b of a)b.classList.add("highlightArea");else a.classList.add("highlightArea")}get _isEditable(){return!1}_editOnDoubleClick(){if(!this._isEditable)return;let{annotationEditorType:a,data:{id:b}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:a,editId:b})})}}class o extends n{constructor(a,b=null){super(a,{isRenderable:!0,ignoreBorder:!!b?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=a.data.isTooltipOnly}render(){let{data:a,linkService:b}=this,c=document.createElement("a");c.setAttribute("data-element-id",a.id);let d=!1;return a.url?(b.addLinkAttributes(c,a.url,a.newWindow),d=!0):a.action?(this._bindNamedAction(c,a.action),d=!0):a.attachment?(this.#b(c,a.attachment,a.attachmentDest),d=!0):a.setOCGState?(this.#c(c,a.setOCGState),d=!0):a.dest?(this._bindLink(c,a.dest),d=!0):(a.actions&&(a.actions.Action||a.actions["Mouse Up"]||a.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(c,a),d=!0),a.resetForm?(this._bindResetFormAction(c,a.resetForm),d=!0):this.isTooltipOnly&&!d&&(this._bindLink(c,""),d=!0)),this.container.classList.add("linkAnnotation"),d&&this.container.append(c),this.container}#d(){this.container.setAttribute("data-internal-link","")}_bindLink(a,b){a.href=this.linkService.getDestinationHash(b),a.onclick=()=>(b&&this.linkService.goToDestination(b),!1),(b||""===b)&&this.#d()}_bindNamedAction(a,b){a.href=this.linkService.getAnchorUrl(""),a.onclick=()=>(this.linkService.executeNamedAction(b),!1),this.#d()}#b(a,b,c=null){a.href=this.linkService.getAnchorUrl(""),a.onclick=()=>(this.downloadManager?.openOrDownloadData(b.content,b.filename,c),!1),this.#d()}#c(a,b){a.href=this.linkService.getAnchorUrl(""),a.onclick=()=>(this.linkService.executeSetOCGState(b),!1),this.#d()}_bindJSAction(a,b){a.href=this.linkService.getAnchorUrl("");let c=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(let d of Object.keys(b.actions)){let e=c.get(d);e&&(a[e]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:b.id,name:d}}),!1))}a.onclick||(a.onclick=()=>!1),this.#d()}_bindResetFormAction(a,b){let c=a.onclick;if(c||(a.href=this.linkService.getAnchorUrl("")),this.#d(),!this._fieldObjects){(0,d.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),c||(a.onclick=()=>!1);return}a.onclick=()=>{c?.();let{fields:a,refs:e,include:f}=b,g=[];if(0!==a.length||0!==e.length){let b=new Set(e);for(let c of a)for(let{id:a}of this._fieldObjects[c]||[])b.add(a);for(let a of Object.values(this._fieldObjects))for(let c of a)b.has(c.id)===f&&g.push(c)}else for(let a of Object.values(this._fieldObjects))g.push(...a);let h=this.annotationStorage,i=[];for(let a of g){let{id:b}=a;switch(i.push(b),a.type){case"text":{let c=a.defaultValue||"";h.setValue(b,{value:c});break}case"checkbox":case"radiobutton":{let c=a.defaultValue===a.exportValues;h.setValue(b,{value:c});break}case"combobox":case"listbox":{let c=a.defaultValue||"";h.setValue(b,{value:c});break}default:continue}let c=document.querySelector(`[data-element-id="${b}"]`);if(c){if(!k.has(c)){(0,d.warn)(`_bindResetFormAction - element not allowed: ${b}`);continue}c.dispatchEvent(new Event("resetform"))}}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:i,name:"ResetForm"}}),!1}}}class p extends n{constructor(a){super(a,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");let a=document.createElement("img");return a.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",a.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),a.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(a),this.container}}class q extends n{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(a){this.data.hasOwnCanvas&&(a.previousSibling?.nodeName==="CANVAS"&&(a.previousSibling.hidden=!0),a.hidden=!1)}_getKeyModifier(a){return d.FeatureTest.platform.isMac?a.metaKey:a.ctrlKey}_setEventListener(a,b,c,d,e){c.includes("mouse")?a.addEventListener(c,a=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:d,value:e(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):a.addEventListener(c,a=>{if("blur"===c){if(!b.focused||!a.relatedTarget)return;b.focused=!1}else if("focus"===c){if(b.focused)return;b.focused=!0}e&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:d,value:e(a)}})})}_setEventListeners(a,b,c,d){for(let[e,f]of c)("Action"===f||this.data.actions?.[f])&&(("Focus"===f||"Blur"===f)&&(b||={focused:!1}),this._setEventListener(a,b,e,f,d),"Focus"!==f||this.data.actions?.Blur?"Blur"!==f||this.data.actions?.Focus||this._setEventListener(a,b,"focus","Focus",null):this._setEventListener(a,b,"blur","Blur",null))}_setBackgroundColor(a){let b=this.data.backgroundColor||null;a.style.backgroundColor=null===b?"transparent":d.Util.makeHexColor(b[0],b[1],b[2])}_setTextStyle(a){let b,{fontColor:c}=this.data.defaultAppearanceData,e=this.data.defaultAppearanceData.fontSize||9,f=a.style,g=a=>Math.round(10*a)/10;if(this.data.multiLine){let a=Math.abs(this.data.rect[3]-this.data.rect[1]-2),c=Math.round(a/(d.LINE_FACTOR*e))||1;b=Math.min(e,g(a/c/d.LINE_FACTOR))}else{let a=Math.abs(this.data.rect[3]-this.data.rect[1]-2);b=Math.min(e,g(a/d.LINE_FACTOR))}f.fontSize=`calc(${b}px * var(--scale-factor))`,f.color=d.Util.makeHexColor(c[0],c[1],c[2]),null!==this.data.textAlignment&&(f.textAlign=["left","center","right"][this.data.textAlignment])}_setRequired(a,b){b?a.setAttribute("required",!0):a.removeAttribute("required"),a.setAttribute("aria-required",b)}}class r extends q{constructor(a){super(a,{isRenderable:a.renderForms||a.data.hasOwnCanvas||!a.data.hasAppearance&&!!a.data.fieldValue})}setPropertyOnSiblings(a,b,c,d){let e=this.annotationStorage;for(let f of this._getElementsByName(a.name,a.id))f.domElement&&(f.domElement[b]=c),e.setValue(f.id,{[d]:c})}render(){let a=this.annotationStorage,b=this.data.id;this.container.classList.add("textWidgetAnnotation");let c=null;if(this.renderForms){let d=a.getValue(b,{value:this.data.fieldValue}),e=d.value||"",f=a.getValue(b,{charLimit:this.data.maxLen}).charLimit;f&&e.length>f&&(e=e.slice(0,f));let g=d.formattedValue||this.data.textContent?.join("\n")||null;g&&this.data.comb&&(g=g.replaceAll(/\s+/g,""));let h={userValue:e,formattedValue:g,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?((c=document.createElement("textarea")).textContent=g??e,this.data.doNotScroll&&(c.style.overflowY="hidden")):((c=document.createElement("input")).type="text",c.setAttribute("value",g??e),this.data.doNotScroll&&(c.style.overflowX="hidden")),this.data.hasOwnCanvas&&(c.hidden=!0),k.add(c),c.setAttribute("data-element-id",b),c.disabled=this.data.readOnly,c.name=this.data.fieldName,c.tabIndex=1e3,this._setRequired(c,this.data.required),f&&(c.maxLength=f),c.addEventListener("input",d=>{a.setValue(b,{value:d.target.value}),this.setPropertyOnSiblings(c,"value",d.target.value,"value"),h.formattedValue=null}),c.addEventListener("resetform",a=>{let b=this.data.defaultFieldValue??"";c.value=h.userValue=b,h.formattedValue=null});let i=a=>{let{formattedValue:b}=h;null!=b&&(a.target.value=b),a.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){c.addEventListener("focus",a=>{if(h.focused)return;let{target:b}=a;h.userValue&&(b.value=h.userValue),h.lastCommittedValue=b.value,h.commitKey=1,this.data.actions?.Focus||(h.focused=!0)}),c.addEventListener("updatefromsandbox",c=>{this.showElementAndHideCanvas(c.target),this._dispatchEventFromSandbox({value(c){h.userValue=c.detail.value??"",a.setValue(b,{value:h.userValue.toString()}),c.target.value=h.userValue},formattedValue(c){let{formattedValue:d}=c.detail;h.formattedValue=d,null!=d&&c.target!==document.activeElement&&(c.target.value=d),a.setValue(b,{formattedValue:d})},selRange(a){a.target.setSelectionRange(...a.detail.selRange)},charLimit:c=>{let{charLimit:d}=c.detail,{target:e}=c;if(0===d)return void e.removeAttribute("maxLength");e.setAttribute("maxLength",d);let f=h.userValue;f&&!(f.length<=d)&&(e.value=h.userValue=f=f.slice(0,d),a.setValue(b,{value:f}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:b,name:"Keystroke",value:f,willCommit:!0,commitKey:1,selStart:e.selectionStart,selEnd:e.selectionEnd}}))}},c)}),c.addEventListener("keydown",a=>{h.commitKey=1;let c=-1;if("Escape"===a.key?c=0:"Enter"!==a.key||this.data.multiLine?"Tab"===a.key&&(h.commitKey=3):c=2,-1===c)return;let{value:d}=a.target;h.lastCommittedValue!==d&&(h.lastCommittedValue=d,h.userValue=d,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:b,name:"Keystroke",value:d,willCommit:!0,commitKey:c,selStart:a.target.selectionStart,selEnd:a.target.selectionEnd}}))});let d=i;i=null,c.addEventListener("blur",a=>{if(!h.focused||!a.relatedTarget)return;this.data.actions?.Blur||(h.focused=!1);let{value:c}=a.target;h.userValue=c,h.lastCommittedValue!==c&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:b,name:"Keystroke",value:c,willCommit:!0,commitKey:h.commitKey,selStart:a.target.selectionStart,selEnd:a.target.selectionEnd}}),d(a)}),this.data.actions?.Keystroke&&c.addEventListener("beforeinput",a=>{h.lastCommittedValue=null;let{data:c,target:d}=a,{value:e,selectionStart:f,selectionEnd:g}=d,i=f,j=g;switch(a.inputType){case"deleteWordBackward":{let a=e.substring(0,f).match(/\w*[^\w]*$/);a&&(i-=a[0].length);break}case"deleteWordForward":{let a=e.substring(f).match(/^[^\w]*\w*/);a&&(j+=a[0].length);break}case"deleteContentBackward":f===g&&(i-=1);break;case"deleteContentForward":f===g&&(j+=1)}a.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:b,name:"Keystroke",value:e,change:c||"",willCommit:!1,selStart:i,selEnd:j}})}),this._setEventListeners(c,h,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.value)}if(i&&c.addEventListener("blur",i),this.data.comb){let a=(this.data.rect[2]-this.data.rect[0])/f;c.classList.add("comb"),c.style.letterSpacing=`calc(${a}px * var(--scale-factor) - 1ch)`}}else(c=document.createElement("div")).textContent=this.data.fieldValue,c.style.verticalAlign="middle",c.style.display="table-cell",this.data.hasOwnCanvas&&(c.hidden=!0);return this._setTextStyle(c),this._setBackgroundColor(c),this._setDefaultPropertiesFromJS(c),this.container.append(c),this.container}}class s extends q{constructor(a){super(a,{isRenderable:!!a.data.hasOwnCanvas})}}class t extends q{constructor(a){super(a,{isRenderable:a.renderForms})}render(){let a=this.annotationStorage,b=this.data,c=b.id,d=a.getValue(c,{value:b.exportValue===b.fieldValue}).value;"string"==typeof d&&(d="Off"!==d,a.setValue(c,{value:d})),this.container.classList.add("buttonWidgetAnnotation","checkBox");let e=document.createElement("input");return k.add(e),e.setAttribute("data-element-id",c),e.disabled=b.readOnly,this._setRequired(e,this.data.required),e.type="checkbox",e.name=b.fieldName,d&&e.setAttribute("checked",!0),e.setAttribute("exportValue",b.exportValue),e.tabIndex=1e3,e.addEventListener("change",d=>{let{name:e,checked:f}=d.target;for(let d of this._getElementsByName(e,c)){let c=f&&d.exportValue===b.exportValue;d.domElement&&(d.domElement.checked=c),a.setValue(d.id,{value:c})}a.setValue(c,{value:f})}),e.addEventListener("resetform",a=>{let c=b.defaultFieldValue||"Off";a.target.checked=c===b.exportValue}),this.enableScripting&&this.hasJSActions&&(e.addEventListener("updatefromsandbox",b=>{this._dispatchEventFromSandbox({value(b){b.target.checked="Off"!==b.detail.value,a.setValue(c,{value:b.target.checked})}},b)}),this._setEventListeners(e,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(e),this._setDefaultPropertiesFromJS(e),this.container.append(e),this.container}}class u extends q{constructor(a){super(a,{isRenderable:a.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");let a=this.annotationStorage,b=this.data,c=b.id,d=a.getValue(c,{value:b.fieldValue===b.buttonValue}).value;if("string"==typeof d&&(d=d!==b.buttonValue,a.setValue(c,{value:d})),d)for(let d of this._getElementsByName(b.fieldName,c))a.setValue(d.id,{value:!1});let e=document.createElement("input");if(k.add(e),e.setAttribute("data-element-id",c),e.disabled=b.readOnly,this._setRequired(e,this.data.required),e.type="radio",e.name=b.fieldName,d&&e.setAttribute("checked",!0),e.tabIndex=1e3,e.addEventListener("change",b=>{let{name:d,checked:e}=b.target;for(let b of this._getElementsByName(d,c))a.setValue(b.id,{value:!1});a.setValue(c,{value:e})}),e.addEventListener("resetform",a=>{let c=b.defaultFieldValue;a.target.checked=null!=c&&c===b.buttonValue}),this.enableScripting&&this.hasJSActions){let d=b.buttonValue;e.addEventListener("updatefromsandbox",b=>{this._dispatchEventFromSandbox({value:b=>{let e=d===b.detail.value;for(let d of this._getElementsByName(b.target.name)){let b=e&&d.id===c;d.domElement&&(d.domElement.checked=b),a.setValue(d.id,{value:b})}}},b)}),this._setEventListeners(e,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(e),this._setDefaultPropertiesFromJS(e),this.container.append(e),this.container}}class v extends o{constructor(a){super(a,{ignoreBorder:a.data.hasAppearance})}render(){let a=super.render();a.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(a.title=this.data.alternativeText);let b=a.lastChild;return this.enableScripting&&this.hasJSActions&&b&&(this._setDefaultPropertiesFromJS(b),b.addEventListener("updatefromsandbox",a=>{this._dispatchEventFromSandbox({},a)})),a}}class w extends q{constructor(a){super(a,{isRenderable:a.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");let a=this.annotationStorage,b=this.data.id,c=a.getValue(b,{value:this.data.fieldValue}),d=document.createElement("select");k.add(d),d.setAttribute("data-element-id",b),d.disabled=this.data.readOnly,this._setRequired(d,this.data.required),d.name=this.data.fieldName,d.tabIndex=1e3;let e=this.data.combo&&this.data.options.length>0;for(let a of(!this.data.combo&&(d.size=this.data.options.length,this.data.multiSelect&&(d.multiple=!0)),d.addEventListener("resetform",a=>{let b=this.data.defaultFieldValue;for(let a of d.options)a.selected=a.value===b}),this.data.options)){let b=document.createElement("option");b.textContent=a.displayValue,b.value=a.exportValue,c.value.includes(a.exportValue)&&(b.setAttribute("selected",!0),e=!1),d.append(b)}let f=null;if(e){let a=document.createElement("option");a.value=" ",a.setAttribute("hidden",!0),a.setAttribute("selected",!0),d.prepend(a),f=()=>{a.remove(),d.removeEventListener("input",f),f=null},d.addEventListener("input",f)}let g=a=>{let b=a?"value":"textContent",{options:c,multiple:e}=d;return e?Array.prototype.filter.call(c,a=>a.selected).map(a=>a[b]):-1===c.selectedIndex?null:c[c.selectedIndex][b]},h=g(!1),i=a=>{let b=a.target.options;return Array.prototype.map.call(b,a=>({displayValue:a.textContent,exportValue:a.value}))};return this.enableScripting&&this.hasJSActions?(d.addEventListener("updatefromsandbox",c=>{this._dispatchEventFromSandbox({value(c){f?.();let e=c.detail.value,i=new Set(Array.isArray(e)?e:[e]);for(let a of d.options)a.selected=i.has(a.value);a.setValue(b,{value:g(!0)}),h=g(!1)},multipleSelection(a){d.multiple=!0},remove(c){let e=d.options,f=c.detail.remove;if(e[f].selected=!1,d.remove(f),e.length>0){let a=Array.prototype.findIndex.call(e,a=>a.selected);-1===a&&(e[0].selected=!0)}a.setValue(b,{value:g(!0),items:i(c)}),h=g(!1)},clear(c){for(;0!==d.length;)d.remove(0);a.setValue(b,{value:null,items:[]}),h=g(!1)},insert(c){let{index:e,displayValue:f,exportValue:j}=c.detail.insert,k=d.children[e],l=document.createElement("option");l.textContent=f,l.value=j,k?k.before(l):d.append(l),a.setValue(b,{value:g(!0),items:i(c)}),h=g(!1)},items(c){let{items:e}=c.detail;for(;0!==d.length;)d.remove(0);for(let a of e){let{displayValue:b,exportValue:c}=a,e=document.createElement("option");e.textContent=b,e.value=c,d.append(e)}d.options.length>0&&(d.options[0].selected=!0),a.setValue(b,{value:g(!0),items:i(c)}),h=g(!1)},indices(c){let d=new Set(c.detail.indices);for(let a of c.target.options)a.selected=d.has(a.index);a.setValue(b,{value:g(!0)}),h=g(!1)},editable(a){a.target.disabled=!a.detail.editable}},c)}),d.addEventListener("input",c=>{let d=g(!0);a.setValue(b,{value:d}),c.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:b,name:"Keystroke",value:h,changeEx:d,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(d,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],a=>a.target.value)):d.addEventListener("input",function(c){a.setValue(b,{value:g(!0)})}),this.data.combo&&this._setTextStyle(d),this._setBackgroundColor(d),this._setDefaultPropertiesFromJS(d),this.container.append(d),this.container}}class x extends n{constructor(a){const{data:b,elements:c}=a;super(a,{isRenderable:n._hasPopupData(b)}),this.elements=c}render(){this.container.classList.add("popupAnnotation");let a=new y({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),b=[];for(let c of this.elements)c.popup=a,b.push(c.data.id),c.addHighlightArea();return this.container.setAttribute("aria-controls",b.map(a=>`${d.AnnotationPrefix}${a}`).join(",")),this.container}}class y{#e=this.#f.bind(this);#g=this.#h.bind(this);#i=this.#j.bind(this);#k=this.#l.bind(this);#m=null;#n=null;#o=null;#p=null;#q=null;#r=null;#s=null;#t=!1;#u=null;#v=null;#w=null;#x=null;#y=!1;constructor({container:a,color:b,elements:c,titleObj:d,modificationDate:f,contentsObj:g,richText:h,parent:i,rect:j,parentRect:k,open:l}){for(const l of(this.#n=a,this.#x=d,this.#o=g,this.#w=h,this.#r=i,this.#m=b,this.#v=j,this.#s=k,this.#q=c,this.#p=e.PDFDateString.toDateObject(f),this.trigger=c.flatMap(a=>a.getElementsToTriggerPopup()),this.trigger))l.addEventListener("click",this.#k),l.addEventListener("mouseenter",this.#i),l.addEventListener("mouseleave",this.#g),l.classList.add("popupTriggerArea");for(const a of c)a.container?.addEventListener("keydown",this.#e);this.#n.hidden=!0,l&&this.#l()}render(){if(this.#u)return;let{page:{view:a},viewport:{rawDims:{pageWidth:b,pageHeight:c,pageX:e,pageY:f}}}=this.#r,g=this.#u=document.createElement("div");if(g.className="popup",this.#m){let a=g.style.outlineColor=d.Util.makeHexColor(...this.#m);CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?g.style.backgroundColor=`color-mix(in srgb, ${a} 30%, white)`:g.style.backgroundColor=d.Util.makeHexColor(...this.#m.map(a=>Math.floor(.7*(255-a)+a)))}let h=document.createElement("span");h.className="header";let i=document.createElement("h1");if(h.append(i),{dir:i.dir,str:i.textContent}=this.#x,g.append(h),this.#p){let a=document.createElement("span");a.classList.add("popupDate"),a.setAttribute("data-l10n-id","pdfjs-annotation-date-string"),a.setAttribute("data-l10n-args",JSON.stringify({date:this.#p.toLocaleDateString(),time:this.#p.toLocaleTimeString()})),h.append(a)}let k=this.#o,l=this.#w;if(l?.str&&(!k?.str||k.str===l.str))j.XfaLayer.render({xfaHtml:l.html,intent:"richText",div:g}),g.lastChild.classList.add("richText","popupContent");else{let a=this._formatContents(k);g.append(a)}let m=!!this.#s,n=m?this.#s:this.#v;for(let a of this.#q)if(!n||null!==d.Util.intersect(a.data.rect,n)){n=a.data.rect,m=!0;break}let o=d.Util.normalizeRect([n[0],a[3]-n[1]+a[1],n[2],a[3]-n[3]+a[1]]),p=m?n[2]-n[0]+5:0,q=o[0]+p,r=o[1],{style:s}=this.#n;s.left=`${100*(q-e)/b}%`,s.top=`${100*(r-f)/c}%`,this.#n.append(g)}_formatContents({str:a,dir:b}){let c=document.createElement("p");c.classList.add("popupContent"),c.dir=b;let d=a.split(/(?:\r\n?|\n)/);for(let a=0,b=d.length;a<b;++a){let e=d[a];c.append(document.createTextNode(e)),a<b-1&&c.append(document.createElement("br"))}return c}#f(a){a.altKey||a.shiftKey||a.ctrlKey||a.metaKey||("Enter"===a.key||"Escape"===a.key&&this.#t)&&this.#l()}#l(){this.#t=!this.#t,this.#t?(this.#j(),this.#n.addEventListener("click",this.#k),this.#n.addEventListener("keydown",this.#e)):(this.#h(),this.#n.removeEventListener("click",this.#k),this.#n.removeEventListener("keydown",this.#e))}#j(){this.#u||this.render(),this.isVisible?this.#t&&this.#n.classList.add("focused"):(this.#n.hidden=!1,this.#n.style.zIndex=parseInt(this.#n.style.zIndex)+1e3)}#h(){this.#n.classList.remove("focused"),!this.#t&&this.isVisible&&(this.#n.hidden=!0,this.#n.style.zIndex=parseInt(this.#n.style.zIndex)-1e3)}forceHide(){this.#y=this.isVisible,this.#y&&(this.#n.hidden=!0)}maybeShow(){this.#y&&(this.#y=!1,this.#n.hidden=!1)}get isVisible(){return!1===this.#n.hidden}}class z extends n{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0}),this.textContent=a.data.textContent,this.textPosition=a.data.textPosition,this.annotationEditorType=d.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){let a=document.createElement("div");for(let b of(a.classList.add("annotationTextContent"),a.setAttribute("role","comment"),this.textContent)){let c=document.createElement("span");c.textContent=b,a.append(c)}this.container.append(a)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}get _isEditable(){return this.data.hasOwnCanvas}}class A extends n{#z=null;constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");let a=this.data,{width:b,height:c}=l(a.rect),d=this.svgFactory.create(b,c,!0),e=this.#z=this.svgFactory.createElement("svg:line");return e.setAttribute("x1",a.rect[2]-a.lineCoordinates[0]),e.setAttribute("y1",a.rect[3]-a.lineCoordinates[1]),e.setAttribute("x2",a.rect[2]-a.lineCoordinates[2]),e.setAttribute("y2",a.rect[3]-a.lineCoordinates[3]),e.setAttribute("stroke-width",a.borderStyle.width||1),e.setAttribute("stroke","transparent"),e.setAttribute("fill","transparent"),d.append(e),this.container.append(d),!a.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#z}addHighlightArea(){this.container.classList.add("highlightArea")}}class B extends n{#A=null;constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");let a=this.data,{width:b,height:c}=l(a.rect),d=this.svgFactory.create(b,c,!0),e=a.borderStyle.width,f=this.#A=this.svgFactory.createElement("svg:rect");return f.setAttribute("x",e/2),f.setAttribute("y",e/2),f.setAttribute("width",b-e),f.setAttribute("height",c-e),f.setAttribute("stroke-width",e||1),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),d.append(f),this.container.append(d),!a.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#A}addHighlightArea(){this.container.classList.add("highlightArea")}}class C extends n{#B=null;constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");let a=this.data,{width:b,height:c}=l(a.rect),d=this.svgFactory.create(b,c,!0),e=a.borderStyle.width,f=this.#B=this.svgFactory.createElement("svg:ellipse");return f.setAttribute("cx",b/2),f.setAttribute("cy",c/2),f.setAttribute("rx",b/2-e/2),f.setAttribute("ry",c/2-e/2),f.setAttribute("stroke-width",e||1),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),d.append(f),this.container.append(d),!a.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#B}addHighlightArea(){this.container.classList.add("highlightArea")}}class D extends n{#C=null;constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);let a=this.data,{width:b,height:c}=l(a.rect),d=this.svgFactory.create(b,c,!0),e=[];for(let b of a.vertices){let c=b.x-a.rect[0],d=a.rect[3]-b.y;e.push(c+","+d)}e=e.join(" ");let f=this.#C=this.svgFactory.createElement(this.svgElementName);return f.setAttribute("points",e),f.setAttribute("stroke-width",a.borderStyle.width||1),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),d.append(f),this.container.append(d),!a.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#C}addHighlightArea(){this.container.classList.add("highlightArea")}}class E extends D{constructor(a){super(a),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class F extends n{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class G extends n{#D=[];constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=d.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);let a=this.data,{width:b,height:c}=l(a.rect),d=this.svgFactory.create(b,c,!0);for(let b of a.inkLists){let c=[];for(let d of b){let b=d.x-a.rect[0],e=a.rect[3]-d.y;c.push(`${b},${e}`)}c=c.join(" ");let e=this.svgFactory.createElement(this.svgElementName);this.#D.push(e),e.setAttribute("points",c),e.setAttribute("stroke-width",a.borderStyle.width||1),e.setAttribute("stroke","transparent"),e.setAttribute("fill","transparent"),!a.popupRef&&this.hasPopupData&&this._createPopup(),d.append(e)}return this.container.append(d),this.container}getElementsToTriggerPopup(){return this.#D}addHighlightArea(){this.container.classList.add("highlightArea")}}class H extends n{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class I extends n{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class J extends n{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class K extends n{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class L extends n{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class M extends n{#E=null;constructor(a){super(a,{isRenderable:!0});const{filename:b,content:c}=this.data.file;this.filename=(0,e.getFilenameFromUrl)(b,!0),this.content=c,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,filename:b,content:c})}render(){let a;this.container.classList.add("fileAttachmentAnnotation");let{container:b,data:c}=this;c.hasAppearance||0===c.fillAlpha?a=document.createElement("div"):((a=document.createElement("img")).src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(c.name)?"paperclip":"pushpin"}.svg`,c.fillAlpha&&c.fillAlpha<1&&(a.style=`filter: opacity(${Math.round(100*c.fillAlpha)}%);`)),a.addEventListener("dblclick",this.#F.bind(this)),this.#E=a;let{isMac:e}=d.FeatureTest.platform;return b.addEventListener("keydown",a=>{"Enter"===a.key&&(e?a.metaKey:a.ctrlKey)&&this.#F()}),!c.popupRef&&this.hasPopupData?this._createPopup():a.classList.add("popupTriggerArea"),b.append(a),b}getElementsToTriggerPopup(){return this.#E}addHighlightArea(){this.container.classList.add("highlightArea")}#F(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class N{#G=null;#H=null;#I=new Map;constructor({div:a,accessibilityManager:b,annotationCanvasMap:c,page:d,viewport:e}){this.div=a,this.#G=b,this.#H=c,this.page=d,this.viewport=e,this.zIndex=0}#J(a,b){let c=a.firstChild||a;c.id=`${d.AnnotationPrefix}${b}`,this.div.append(a),this.#G?.moveElementInDOM(this.div,a,c,!1)}async render(a){let{annotations:b}=a,c=this.div;(0,e.setLayerDimensions)(c,this.viewport);let g=new Map,h={data:null,layer:c,linkService:a.linkService,downloadManager:a.downloadManager,imageResourcesPath:a.imageResourcesPath||"",renderForms:!1!==a.renderForms,svgFactory:new e.DOMSVGFactory,annotationStorage:a.annotationStorage||new f.AnnotationStorage,enableScripting:!0===a.enableScripting,hasJSActions:a.hasJSActions,fieldObjects:a.fieldObjects,parent:this,elements:null};for(let a of b){if(a.noHTML)continue;let b=a.annotationType===d.AnnotationType.POPUP;if(b){let b=g.get(a.id);if(!b)continue;h.elements=b}else{let{width:b,height:c}=l(a.rect);if(b<=0||c<=0)continue}h.data=a;let c=m.create(h);if(!c.isRenderable)continue;if(!b&&a.popupRef){let b=g.get(a.popupRef);b?b.push(c):g.set(a.popupRef,[c])}c.annotationEditorType>0&&this.#I.set(c.data.id,c);let e=c.render();a.hidden&&(e.style.visibility="hidden"),this.#J(e,a.id)}this.#K()}update({viewport:a}){let b=this.div;this.viewport=a,(0,e.setLayerDimensions)(b,{rotation:a.rotation}),this.#K(),b.hidden=!1}#K(){if(!this.#H)return;let a=this.div;for(let[b,c]of this.#H){let d=a.querySelector(`[data-annotation-id="${b}"]`);if(!d)continue;let{firstChild:e}=d;e?"CANVAS"===e.nodeName?e.replaceWith(c):e.before(c):d.append(c)}this.#H.clear()}getEditableAnnotations(){return Array.from(this.#I.values())}getEditableAnnotation(a){return this.#I.get(a)}}},780:(a,b,c)=>{c.d(b,{AnnotationStorage:()=>h,PrintAnnotationStorage:()=>i,SerializableEmpty:()=>g});var d=c(266),e=c(115),f=c(825);let g=Object.freeze({map:null,hash:"",transfer:void 0});class h{#L=!1;#M=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(a,b){let c=this.#M.get(a);return void 0===c?b:Object.assign(b,c)}getRawValue(a){return this.#M.get(a)}remove(a){if(this.#M.delete(a),0===this.#M.size&&this.resetModified(),"function"==typeof this.onAnnotationEditor){for(let a of this.#M.values())if(a instanceof e.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(a,b){let c=this.#M.get(a),d=!1;if(void 0!==c)for(let[a,e]of Object.entries(b))c[a]!==e&&(d=!0,c[a]=e);else d=!0,this.#M.set(a,b);d&&this.#N(),b instanceof e.AnnotationEditor&&"function"==typeof this.onAnnotationEditor&&this.onAnnotationEditor(b.constructor._type)}has(a){return this.#M.has(a)}getAll(){return this.#M.size>0?(0,d.objectFromMap)(this.#M):null}setAll(a){for(let[b,c]of Object.entries(a))this.setValue(b,c)}get size(){return this.#M.size}#N(){this.#L||(this.#L=!0,"function"==typeof this.onSetModified&&this.onSetModified())}resetModified(){this.#L&&(this.#L=!1,"function"==typeof this.onResetModified&&this.onResetModified())}get print(){return new i(this)}get serializable(){if(0===this.#M.size)return g;let a=new Map,b=new f.MurmurHash3_64,c=[],d=Object.create(null),h=!1;for(let[c,f]of this.#M){let g=f instanceof e.AnnotationEditor?f.serialize(!1,d):f;g&&(a.set(c,g),b.update(`${c}:${JSON.stringify(g)}`),h||=!!g.bitmap)}if(h)for(let b of a.values())b.bitmap&&c.push(b.bitmap);return a.size>0?{map:a,hash:b.hexdigest(),transfer:c}:g}}class i extends h{#O;constructor(a){super();const{map:b,hash:c,transfer:d}=a.serializable,e=structuredClone(b,d?{transfer:d}:null);this.#O={map:e,hash:c,transfer:d}}get print(){(0,d.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#O}}},406:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{PDFDataRangeTransport:()=>B,PDFWorker:()=>G,build:()=>M,getDocument:()=>u,version:()=>L});var e=c(266),f=c(780),g=c(473),h=c(742),i=c(738),j=c(250),k=c(368),l=c(694),m=c(472),n=c(890),o=c(92),p=c(171),q=c(474),r=c(498),s=c(521),t=a([i,r]);[i,r]=t.then?(await t)():t;let w=e.isNodeJS?i.NodeCanvasFactory:g.DOMCanvasFactory,x=e.isNodeJS?i.NodeCMapReaderFactory:g.DOMCMapReaderFactory,y=e.isNodeJS?i.NodeFilterFactory:g.DOMFilterFactory,z=e.isNodeJS?i.NodeStandardFontDataFactory:g.DOMStandardFontDataFactory;function u(a){if("string"==typeof a||a instanceof URL?a={url:a}:(0,e.isArrayBuffer)(a)&&(a={data:a}),"object"!=typeof a)throw Error("Invalid parameter in getDocument, need parameter object.");if(!a.url&&!a.data&&!a.range)throw Error("Invalid parameter object: need either .data, .range or .url");let b=new A,{docId:c}=b,d=a.url?function(a){if(a instanceof URL)return a.href;try{return new URL(a,window.location).href}catch{if(e.isNodeJS&&"string"==typeof a)return a}throw Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}(a.url):null,f=a.data?function(a){if(e.isNodeJS&&"undefined"!=typeof Buffer&&a instanceof Buffer)throw Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(a instanceof Uint8Array&&a.byteLength===a.buffer.byteLength)return a;if("string"==typeof a)return(0,e.stringToBytes)(a);if("object"==typeof a&&!isNaN(a?.length)||(0,e.isArrayBuffer)(a))return new Uint8Array(a);throw Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}(a.data):null,h=a.httpHeaders||null,i=!0===a.withCredentials,j=a.password??null,m=a.range instanceof B?a.range:null,n=Number.isInteger(a.rangeChunkSize)&&a.rangeChunkSize>0?a.rangeChunkSize:65536,s=a.worker instanceof G?a.worker:null,t=a.verbosity,u="string"!=typeof a.docBaseUrl||(0,g.isDataScheme)(a.docBaseUrl)?null:a.docBaseUrl,C="string"==typeof a.cMapUrl?a.cMapUrl:null,D=!1!==a.cMapPacked,E=a.CMapReaderFactory||x,F="string"==typeof a.standardFontDataUrl?a.standardFontDataUrl:null,I=a.StandardFontDataFactory||z,J=!0!==a.stopAtErrors,K=Number.isInteger(a.maxImageSize)&&a.maxImageSize>-1?a.maxImageSize:-1,L=!1!==a.isEvalSupported,M="boolean"==typeof a.isOffscreenCanvasSupported?a.isOffscreenCanvasSupported:!e.isNodeJS,N=Number.isInteger(a.canvasMaxAreaInBytes)?a.canvasMaxAreaInBytes:-1,O="boolean"==typeof a.disableFontFace?a.disableFontFace:e.isNodeJS,P=!0===a.fontExtraProperties,Q=!0===a.enableXfa,R=a.ownerDocument||globalThis.document,S=!0===a.disableRange,T=!0===a.disableStream,U=!0===a.disableAutoFetch,V=!0===a.pdfBug,W=m?m.length:a.length??NaN,X="boolean"==typeof a.useSystemFonts?a.useSystemFonts:!e.isNodeJS&&!O,Y="boolean"==typeof a.useWorkerFetch?a.useWorkerFetch:E===g.DOMCMapReaderFactory&&I===g.DOMStandardFontDataFactory&&C&&F&&(0,g.isValidFetchUrl)(C,document.baseURI)&&(0,g.isValidFetchUrl)(F,document.baseURI),Z=a.canvasFactory||new w({ownerDocument:R}),$=a.filterFactory||new y({docId:c,ownerDocument:R});(0,e.setVerbosityLevel)(t);let _={canvasFactory:Z,filterFactory:$};if(Y||(_.cMapReaderFactory=new E({baseUrl:C,isCompressed:D}),_.standardFontDataFactory=new I({baseUrl:F})),!s){let a={verbosity:t,port:k.GlobalWorkerOptions.workerPort};b._worker=s=a.port?G.fromPort(a):new G(a)}let aa={docId:c,apiVersion:"4.0.379",data:f,password:j,disableAutoFetch:U,rangeChunkSize:n,length:W,docBaseUrl:u,enableXfa:Q,evaluatorOptions:{maxImageSize:K,disableFontFace:O,ignoreErrors:J,isEvalSupported:L,isOffscreenCanvasSupported:M,canvasMaxAreaInBytes:N,fontExtraProperties:P,useSystemFonts:X,cMapUrl:Y?C:null,standardFontDataUrl:Y?F:null}},ab={ignoreErrors:J,isEvalSupported:L,disableFontFace:O,fontExtraProperties:P,enableXfa:Q,ownerDocument:R,disableAutoFetch:U,pdfBug:V,styleElement:null};return s.promise.then(function(){if(b.destroyed)throw Error("Loading aborted");let a=v(s,aa),j=new Promise(function(a){let b;if(m)b=new o.PDFDataTransportStream({length:W,initialData:m.initialData,progressiveDone:m.progressiveDone,contentDispositionFilename:m.contentDispositionFilename,disableRange:S,disableStream:T},m);else if(!f){var c;c={url:d,length:W,httpHeaders:h,withCredentials:i,rangeChunkSize:n,disableRange:S,disableStream:T},b=e.isNodeJS?new r.PDFNodeStream(c):(0,g.isValidFetchUrl)(c.url)?new p.PDFFetchStream(c):new q.PDFNetworkStream(c)}a(b)});return Promise.all([a,j]).then(function([a,d]){if(b.destroyed)throw Error("Loading aborted");let e=new l.MessageHandler(c,a,s.port),f=new H(e,b,d,ab,_);b._transport=f,e.send("Ready",null)})}).catch(b._capability.reject),b}async function v(a,b){if(a.destroyed)throw Error("Worker was destroyed");let c=await a.messageHandler.sendWithPromise("GetDocRequest",b,b.data?[b.data.buffer]:null);if(a.destroyed)throw Error("Worker was destroyed");return c}class A{static #P=0;constructor(){this._capability=new e.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${A.#P++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(a){throw this._worker?.port&&delete this._worker._pendingDestroy,a}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}}class B{constructor(a,b,c=!1,d=null){this.length=a,this.initialData=b,this.progressiveDone=c,this.contentDispositionFilename=d,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new e.PromiseCapability}addRangeListener(a){this._rangeListeners.push(a)}addProgressListener(a){this._progressListeners.push(a)}addProgressiveReadListener(a){this._progressiveReadListeners.push(a)}addProgressiveDoneListener(a){this._progressiveDoneListeners.push(a)}onDataRange(a,b){for(let c of this._rangeListeners)c(a,b)}onDataProgress(a,b){this._readyCapability.promise.then(()=>{for(let c of this._progressListeners)c(a,b)})}onDataProgressiveRead(a){this._readyCapability.promise.then(()=>{for(let b of this._progressiveReadListeners)b(a)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(let a of this._progressiveDoneListeners)a()})}transportReady(){this._readyCapability.resolve()}requestDataRange(a,b){(0,e.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class C{constructor(a,b){this._pdfInfo=a,this._transport=b}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,e.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(a){return this._transport.getPage(a)}getPageIndex(a){return this._transport.getPageIndex(a)}getDestinations(){return this._transport.getDestinations()}getDestination(a){return this._transport.getDestination(a)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(a=!1){return this._transport.startCleanup(a||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class D{#Q=null;#R=!1;constructor(a,b,c,d=!1){this._pageIndex=a,this._pageInfo=b,this._transport=c,this._stats=d?new g.StatTimer:null,this._pdfBug=d,this.commonObjs=c.commonObjs,this.objs=new I,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:a,rotation:b=this.rotate,offsetX:c=0,offsetY:d=0,dontFlip:e=!1}={}){return new g.PageViewport({viewBox:this.view,scale:a,rotation:b,offsetX:c,offsetY:d,dontFlip:e})}getAnnotations({intent:a="display"}={}){let b=this._transport.getRenderingIntent(a);return this._transport.getAnnotations(this._pageIndex,b.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,e.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:a,viewport:b,intent:c="display",annotationMode:d=e.AnnotationMode.ENABLE,transform:f=null,background:g=null,optionalContentConfigPromise:h=null,annotationCanvasMap:i=null,pageColors:j=null,printAnnotationStorage:k=null}){this._stats?.time("Overall");let l=this._transport.getRenderingIntent(c,d,k);this.#R=!1,this.#S(),h||(h=this._transport.getOptionalContentConfig());let m=this._intentStates.get(l.cacheKey);m||(m=Object.create(null),this._intentStates.set(l.cacheKey,m)),m.streamReaderCancelTimeout&&(clearTimeout(m.streamReaderCancelTimeout),m.streamReaderCancelTimeout=null);let n=!!(l.renderingIntent&e.RenderingIntentFlag.PRINT);m.displayReadyCapability||(m.displayReadyCapability=new e.PromiseCapability,m.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(l));let o=a=>{m.renderTasks.delete(p),(this._maybeCleanupAfterRender||n)&&(this.#R=!0),this.#T(!n),a?(p.capability.reject(a),this._abortOperatorList({intentState:m,reason:a instanceof Error?a:Error(a)})):p.capability.resolve(),this._stats?.timeEnd("Rendering"),this._stats?.timeEnd("Overall")},p=new K({callback:o,params:{canvasContext:a,viewport:b,transform:f,background:g},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:i,operatorList:m.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!n,pdfBug:this._pdfBug,pageColors:j});(m.renderTasks||=new Set).add(p);let q=p.task;return Promise.all([m.displayReadyCapability.promise,h]).then(([a,b])=>{this.destroyed?o():(this._stats?.time("Rendering"),p.initializeGraphics({transparency:a,optionalContentConfig:b}),p.operatorListChanged())}).catch(o),q}getOperatorList({intent:a="display",annotationMode:b=e.AnnotationMode.ENABLE,printAnnotationStorage:c=null}={}){let d,f=this._transport.getRenderingIntent(a,b,c,!0),g=this._intentStates.get(f.cacheKey);return g||(g=Object.create(null),this._intentStates.set(f.cacheKey,g)),g.opListReadCapability||((d=Object.create(null)).operatorListChanged=function(){g.operatorList.lastChunk&&(g.opListReadCapability.resolve(g.operatorList),g.renderTasks.delete(d))},g.opListReadCapability=new e.PromiseCapability,(g.renderTasks||=new Set).add(d),g.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(f)),g.opListReadCapability.promise}streamTextContent({includeMarkedContent:a=!1,disableNormalization:b=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:!0===a,disableNormalization:!0===b},{highWaterMark:100,size:a=>a.items.length})}getTextContent(a={}){if(this._transport._htmlForXfa)return this.getXfa().then(a=>s.XfaText.textContent(a));let b=this.streamTextContent(a);return new Promise(function(a,c){let d=b.getReader(),e={items:[],styles:Object.create(null)};!function b(){d.read().then(function({value:c,done:d}){d?a(e):(Object.assign(e.styles,c.styles),e.items.push(...c.items),b())},c)}()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;let a=[];for(let b of this._intentStates.values())if(this._abortOperatorList({intentState:b,reason:Error("Page was destroyed."),force:!0}),!b.opListReadCapability)for(let c of b.renderTasks)a.push(c.completed),c.cancel();return this.objs.clear(),this.#R=!1,this.#S(),Promise.all(a)}cleanup(a=!1){this.#R=!0;let b=this.#T(!1);return a&&b&&(this._stats&&=new g.StatTimer),b}#T(a=!1){if(this.#S(),!this.#R||this.destroyed)return!1;if(a)return this.#Q=setTimeout(()=>{this.#Q=null,this.#T(!1)},5e3),!1;for(let{renderTasks:a,operatorList:b}of this._intentStates.values())if(a.size>0||!b.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#R=!1,!0}#S(){this.#Q&&(clearTimeout(this.#Q),this.#Q=null)}_startRenderPage(a,b){let c=this._intentStates.get(b);c&&(this._stats?.timeEnd("Page Request"),c.displayReadyCapability?.resolve(a))}_renderPageChunk(a,b){for(let c=0,d=a.length;c<d;c++)b.operatorList.fnArray.push(a.fnArray[c]),b.operatorList.argsArray.push(a.argsArray[c]);for(let c of(b.operatorList.lastChunk=a.lastChunk,b.operatorList.separateAnnots=a.separateAnnots,b.renderTasks))c.operatorListChanged();a.lastChunk&&this.#T(!0)}_pumpOperatorList({renderingIntent:a,cacheKey:b,annotationStorageSerializable:c}){let{map:d,transfer:e}=c,f=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:a,cacheKey:b,annotationStorage:d},e).getReader(),g=this._intentStates.get(b);g.streamReader=f;let h=()=>{f.read().then(({value:a,done:b})=>{if(b){g.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(a,g),h())},a=>{if(g.streamReader=null,!this._transport.destroyed){if(g.operatorList){for(let a of(g.operatorList.lastChunk=!0,g.renderTasks))a.operatorListChanged();this.#T(!0)}if(g.displayReadyCapability)g.displayReadyCapability.reject(a);else if(g.opListReadCapability)g.opListReadCapability.reject(a);else throw a}})};h()}_abortOperatorList({intentState:a,reason:b,force:c=!1}){if(a.streamReader){if(a.streamReaderCancelTimeout&&(clearTimeout(a.streamReaderCancelTimeout),a.streamReaderCancelTimeout=null),!c){if(a.renderTasks.size>0)return;if(b instanceof g.RenderingCancelledException){let c=100;b.extraDelay>0&&b.extraDelay<1e3&&(c+=b.extraDelay),a.streamReaderCancelTimeout=setTimeout(()=>{a.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:a,reason:b,force:!0})},c);return}}if(a.streamReader.cancel(new e.AbortException(b.message)).catch(()=>{}),a.streamReader=null,!this._transport.destroyed){for(let[b,c]of this._intentStates)if(c===a){this._intentStates.delete(b);break}this.cleanup()}}}get stats(){return this._stats}}class E{#U=new Set;#V=Promise.resolve();postMessage(a,b){let c={data:structuredClone(a,b?{transfer:b}:null)};this.#V.then(()=>{for(let a of this.#U)a.call(this,c)})}addEventListener(a,b){this.#U.add(b)}removeEventListener(a,b){this.#U.delete(b)}terminate(){this.#U.clear()}}let F={isWorkerDisabled:!1,fakeWorkerId:0};e.isNodeJS&&(F.isWorkerDisabled=!0,k.GlobalWorkerOptions.workerSrc||="./pdf.worker.mjs"),F.isSameOrigin=function(a,b){let c;try{if(!(c=new URL(a)).origin||"null"===c.origin)return!1}catch{return!1}let d=new URL(b,c);return c.origin===d.origin},F.createCDNWrapper=function(a){let b=`await import("${a}");`;return URL.createObjectURL(new Blob([b],{type:"text/javascript"}))};class G{static #W;constructor({name:a=null,port:b=null,verbosity:c=(0,e.getVerbosityLevel)()}={}){if(this.name=a,this.destroyed=!1,this.verbosity=c,this._readyCapability=new e.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,b){if(G.#W?.has(b))throw Error("Cannot use more than one PDFWorker per port.");(G.#W||=new WeakMap).set(b,this),this._initializeFromPort(b);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(a){this._port=a,this._messageHandler=new l.MessageHandler("main","worker",a),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!F.isWorkerDisabled&&!G.#X){let{workerSrc:a}=G;try{F.isSameOrigin(window.location.href,a)||(a=F.createCDNWrapper(new URL(a,window.location).href));let b=new Worker(a,{type:"module"}),c=new l.MessageHandler("main","worker",b),d=()=>{b.removeEventListener("error",e),c.destroy(),b.terminate(),this.destroyed?this._readyCapability.reject(Error("Worker was destroyed")):this._setupFakeWorker()},e=()=>{this._webWorker||d()};b.addEventListener("error",e),c.on("test",a=>{(b.removeEventListener("error",e),this.destroyed)?d():a?(this._messageHandler=c,this._port=b,this._webWorker=b,this._readyCapability.resolve(),c.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),c.destroy(),b.terminate())}),c.on("ready",a=>{if(b.removeEventListener("error",e),this.destroyed)return void d();try{f()}catch{this._setupFakeWorker()}});let f=()=>{let a=new Uint8Array;c.send("test",a,[a.buffer])};f();return}catch{(0,e.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){F.isWorkerDisabled||((0,e.warn)("Setting up fake worker."),F.isWorkerDisabled=!0),G._setupFakeWorkerGlobal.then(a=>{if(this.destroyed)return void this._readyCapability.reject(Error("Worker was destroyed"));let b=new E;this._port=b;let c=`fake${F.fakeWorkerId++}`,d=new l.MessageHandler(c+"_worker",c,b);a.setup(d,b);let e=new l.MessageHandler(c,c+"_worker",b);this._messageHandler=e,this._readyCapability.resolve(),e.send("configure",{verbosity:this.verbosity})}).catch(a=>{this._readyCapability.reject(Error(`Setting up fake worker failed: "${a.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),G.#W?.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(a){if(!a?.port)throw Error("PDFWorker.fromPort - invalid method signature.");let b=this.#W?.get(a.port);if(b){if(b._pendingDestroy)throw Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return b}return new G(a)}static get workerSrc(){if(k.GlobalWorkerOptions.workerSrc)return k.GlobalWorkerOptions.workerSrc;throw Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get #X(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){let a=async()=>this.#X?this.#X:(await import(this.workerSrc)).WorkerMessageHandler;return(0,e.shadow)(this,"_setupFakeWorkerGlobal",a())}}class H{#Y=new Map;#Z=new Map;#$=new Map;#_=null;constructor(a,b,c,d,f){this.messageHandler=a,this.loadingTask=b,this.commonObjs=new I,this.fontLoader=new h.FontLoader({ownerDocument:d.ownerDocument,styleElement:d.styleElement}),this._params=d,this.canvasFactory=f.canvasFactory,this.filterFactory=f.filterFactory,this.cMapReaderFactory=f.cMapReaderFactory,this.standardFontDataFactory=f.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=c,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new e.PromiseCapability,this.setupMessageHandler()}#aa(a,b=null){let c=this.#Y.get(a);if(c)return c;let d=this.messageHandler.sendWithPromise(a,b);return this.#Y.set(a,d),d}get annotationStorage(){return(0,e.shadow)(this,"annotationStorage",new f.AnnotationStorage)}getRenderingIntent(a,b=e.AnnotationMode.ENABLE,c=null,d=!1){let g=e.RenderingIntentFlag.DISPLAY,h=f.SerializableEmpty;switch(a){case"any":g=e.RenderingIntentFlag.ANY;break;case"display":break;case"print":g=e.RenderingIntentFlag.PRINT;break;default:(0,e.warn)(`getRenderingIntent - invalid intent: ${a}`)}switch(b){case e.AnnotationMode.DISABLE:g+=e.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case e.AnnotationMode.ENABLE:break;case e.AnnotationMode.ENABLE_FORMS:g+=e.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case e.AnnotationMode.ENABLE_STORAGE:h=((g+=e.RenderingIntentFlag.ANNOTATIONS_STORAGE)&e.RenderingIntentFlag.PRINT&&c instanceof f.PrintAnnotationStorage?c:this.annotationStorage).serializable;break;default:(0,e.warn)(`getRenderingIntent - invalid annotationMode: ${b}`)}return d&&(g+=e.RenderingIntentFlag.OPLIST),{renderingIntent:g,cacheKey:`${g}_${h.hash}`,annotationStorageSerializable:h}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new e.PromiseCapability,this.#_?.reject(Error("Worker was destroyed during onPassword callback"));let a=[];for(let b of this.#Z.values())a.push(b._destroy());this.#Z.clear(),this.#$.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();let b=this.messageHandler.sendWithPromise("Terminate",null);return a.push(b),Promise.all(a).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#Y.clear(),this.filterFactory.destroy(),this._networkStream?.cancelAllRequests(new e.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){let{messageHandler:a,loadingTask:b}=this;a.on("GetReader",(a,b)=>{(0,e.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=a=>{this._lastProgress={loaded:a.loaded,total:a.total}},b.onPull=()=>{this._fullReader.read().then(function({value:a,done:c}){c?b.close():((0,e.assert)(a instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),b.enqueue(new Uint8Array(a),1,[a]))}).catch(a=>{b.error(a)})},b.onCancel=a=>{this._fullReader.cancel(a),b.ready.catch(a=>{if(!this.destroyed)throw a})}}),a.on("ReaderHeadersReady",a=>{let c=new e.PromiseCapability,d=this._fullReader;return d.headersReady.then(()=>{d.isStreamingSupported&&d.isRangeSupported||(this._lastProgress&&b.onProgress?.(this._lastProgress),d.onProgress=a=>{b.onProgress?.({loaded:a.loaded,total:a.total})}),c.resolve({isStreamingSupported:d.isStreamingSupported,isRangeSupported:d.isRangeSupported,contentLength:d.contentLength})},c.reject),c.promise}),a.on("GetRangeReader",(a,b)=>{(0,e.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");let c=this._networkStream.getRangeReader(a.begin,a.end);c?(b.onPull=()=>{c.read().then(function({value:a,done:c}){c?b.close():((0,e.assert)(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),b.enqueue(new Uint8Array(a),1,[a]))}).catch(a=>{b.error(a)})},b.onCancel=a=>{c.cancel(a),b.ready.catch(a=>{if(!this.destroyed)throw a})}):b.close()}),a.on("GetDoc",({pdfInfo:a})=>{this._numPages=a.numPages,this._htmlForXfa=a.htmlForXfa,delete a.htmlForXfa,b._capability.resolve(new C(a,this))}),a.on("DocException",function(a){let c;switch(a.name){case"PasswordException":c=new e.PasswordException(a.message,a.code);break;case"InvalidPDFException":c=new e.InvalidPDFException(a.message);break;case"MissingPDFException":c=new e.MissingPDFException(a.message);break;case"UnexpectedResponseException":c=new e.UnexpectedResponseException(a.message,a.status);break;case"UnknownErrorException":c=new e.UnknownErrorException(a.message,a.details);break;default:(0,e.unreachable)("DocException - expected a valid Error.")}b._capability.reject(c)}),a.on("PasswordRequest",a=>{if(this.#_=new e.PromiseCapability,b.onPassword){let c=a=>{a instanceof Error?this.#_.reject(a):this.#_.resolve({password:a})};try{b.onPassword(c,a.code)}catch(a){this.#_.reject(a)}}else this.#_.reject(new e.PasswordException(a.message,a.code));return this.#_.promise}),a.on("DataLoaded",a=>{b.onProgress?.({loaded:a.length,total:a.length}),this.downloadInfoCapability.resolve(a)}),a.on("StartRenderPage",a=>{this.destroyed||this.#Z.get(a.pageIndex)._startRenderPage(a.transparency,a.cacheKey)}),a.on("commonobj",([b,c,d])=>{if(this.destroyed||this.commonObjs.has(b))return null;switch(c){case"Font":let f=this._params;if("error"in d){let a=d.error;(0,e.warn)(`Error during font loading: ${a}`),this.commonObjs.resolve(b,a);break}let g=f.pdfBug&&globalThis.FontInspector?.enabled?(a,b)=>globalThis.FontInspector.fontAdded(a,b):null,i=new h.FontFaceObject(d,{isEvalSupported:f.isEvalSupported,disableFontFace:f.disableFontFace,ignoreErrors:f.ignoreErrors,inspectFont:g});this.fontLoader.bind(i).catch(c=>a.sendWithPromise("FontFallback",{id:b})).finally(()=>{!f.fontExtraProperties&&i.data&&(i.data=null),this.commonObjs.resolve(b,i)});break;case"CopyLocalImage":let{imageRef:j}=d;for(let a of((0,e.assert)(j,"The imageRef must be defined."),this.#Z.values()))for(let[,c]of a.objs)if(c.ref===j){if(!c.dataLen)return null;return this.commonObjs.resolve(b,structuredClone(c)),c.dataLen}break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(b,d);break;default:throw Error(`Got unknown common object type ${c}`)}return null}),a.on("obj",([a,b,c,d])=>{if(this.destroyed)return;let f=this.#Z.get(b);if(!f.objs.has(a)){if(0===f._intentStates.size)return void d?.bitmap?.close();switch(c){case"Image":f.objs.resolve(a,d),d?.dataLen>e.MAX_IMAGE_SIZE_TO_CACHE&&(f._maybeCleanupAfterRender=!0);break;case"Pattern":f.objs.resolve(a,d);break;default:throw Error(`Got unknown object type ${c}`)}}}),a.on("DocProgress",a=>{this.destroyed||b.onProgress?.({loaded:a.loaded,total:a.total})}),a.on("FetchBuiltInCMap",a=>this.destroyed?Promise.reject(Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(a):Promise.reject(Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),a.on("FetchStandardFontData",a=>this.destroyed?Promise.reject(Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(a):Promise.reject(Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&(0,e.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");let{map:a,transfer:b}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:a,filename:this._fullReader?.filename??null},b).finally(()=>{this.annotationStorage.resetModified()})}getPage(a){if(!Number.isInteger(a)||a<=0||a>this._numPages)return Promise.reject(Error("Invalid page request."));let b=a-1,c=this.#$.get(b);if(c)return c;let d=this.messageHandler.sendWithPromise("GetPage",{pageIndex:b}).then(a=>{if(this.destroyed)throw Error("Transport destroyed");let c=new D(b,a,this,this._params.pdfBug);return this.#Z.set(b,c),c});return this.#$.set(b,d),d}getPageIndex(a){return"object"!=typeof a||null===a||!Number.isInteger(a.num)||a.num<0||!Number.isInteger(a.gen)||a.gen<0?Promise.reject(Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:a.num,gen:a.gen})}getAnnotations(a,b){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:a,intent:b})}getFieldObjects(){return this.#aa("GetFieldObjects")}hasJSActions(){return this.#aa("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(a){return"string"!=typeof a?Promise.reject(Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:a})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return this.#aa("GetDocJSActions")}getPageJSActions(a){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:a})}getStructTree(a){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:a})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(a=>new n.OptionalContentConfig(a))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){let a="GetMetadata",b=this.#Y.get(a);if(b)return b;let c=this.messageHandler.sendWithPromise(a,null).then(a=>({info:a[0],metadata:a[1]?new m.Metadata(a[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#Y.set(a,c),c}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(a=!1){if(!this.destroyed){for(let a of(await this.messageHandler.sendWithPromise("Cleanup",null),this.#Z.values()))if(!a.cleanup())throw Error(`startCleanup: Page ${a.pageNumber} is currently rendering.`);this.commonObjs.clear(),a||this.fontLoader.clear(),this.#Y.clear(),this.filterFactory.destroy(!0)}}get loadingParams(){let{disableAutoFetch:a,enableXfa:b}=this._params;return(0,e.shadow)(this,"loadingParams",{disableAutoFetch:a,enableXfa:b})}}class I{#ab=Object.create(null);#ac(a){return this.#ab[a]||={capability:new e.PromiseCapability,data:null}}get(a,b=null){if(b){let c=this.#ac(a);return c.capability.promise.then(()=>b(c.data)),null}let c=this.#ab[a];if(!c?.capability.settled)throw Error(`Requesting object that isn't resolved yet ${a}.`);return c.data}has(a){let b=this.#ab[a];return b?.capability.settled??!1}resolve(a,b=null){let c=this.#ac(a);c.data=b,c.capability.resolve()}clear(){for(let a in this.#ab){let{data:b}=this.#ab[a];b?.bitmap?.close()}this.#ab=Object.create(null)}*[Symbol.iterator](){for(let a in this.#ab){let{capability:b,data:c}=this.#ab[a];b.settled&&(yield[a,c])}}}class J{#ad=null;constructor(a){this.#ad=a,this.onContinue=null}get promise(){return this.#ad.capability.promise}cancel(a=0){this.#ad.cancel(null,a)}get separateAnnots(){let{separateAnnots:a}=this.#ad.operatorList;if(!a)return!1;let{annotationCanvasMap:b}=this.#ad;return a.form||a.canvas&&b?.size>0}}class K{static #ae=new WeakSet;constructor({callback:a,params:b,objs:c,commonObjs:d,annotationCanvasMap:f,operatorList:g,pageIndex:h,canvasFactory:i,filterFactory:j,useRequestAnimationFrame:k=!1,pdfBug:l=!1,pageColors:m=null}){this.callback=a,this.params=b,this.objs=c,this.commonObjs=d,this.annotationCanvasMap=f,this.operatorListIdx=null,this.operatorList=g,this._pageIndex=h,this.canvasFactory=i,this.filterFactory=j,this._pdfBug=l,this.pageColors=m,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===k&&!1,this.cancelled=!1,this.capability=new e.PromiseCapability,this.task=new J(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=b.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:a=!1,optionalContentConfig:b}){if(this.cancelled)return;if(this._canvas){if(K.#ae.has(this._canvas))throw Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");K.#ae.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());let{canvasContext:c,viewport:d,transform:e,background:f}=this.params;this.gfx=new j.CanvasGraphics(c,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:b},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:e,viewport:d,transparency:a,background:f}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(a=null,b=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),K.#ae.delete(this._canvas),this.callback(a||new g.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,b))}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.stepper?.updateOperatorList(this.operatorList),this.running||this._continue()}_continue(){this.running=!0,this.cancelled||(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){!this.cancelled&&(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),K.#ae.delete(this._canvas),this.callback())))}}let L="4.0.379",M="9e14d04fd";d()}catch(a){d(a)}})},822:(a,b,c)=>{c.d(b,{BaseCMapReaderFactory:()=>g,BaseCanvasFactory:()=>f,BaseFilterFactory:()=>e,BaseSVGFactory:()=>i,BaseStandardFontDataFactory:()=>h});var d=c(266);class e{constructor(){this.constructor===e&&(0,d.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(a){return"none"}addHCMFilter(a,b){return"none"}addHighlightHCMFilter(a,b,c,d){return"none"}destroy(a=!1){}}class f{constructor(){this.constructor===f&&(0,d.unreachable)("Cannot initialize BaseCanvasFactory.")}create(a,b){if(a<=0||b<=0)throw Error("Invalid canvas size");let c=this._createCanvas(a,b);return{canvas:c,context:c.getContext("2d")}}reset(a,b,c){if(!a.canvas)throw Error("Canvas is not specified");if(b<=0||c<=0)throw Error("Invalid canvas size");a.canvas.width=b,a.canvas.height=c}destroy(a){if(!a.canvas)throw Error("Canvas is not specified");a.canvas.width=0,a.canvas.height=0,a.canvas=null,a.context=null}_createCanvas(a,b){(0,d.unreachable)("Abstract method `_createCanvas` called.")}}class g{constructor({baseUrl:a=null,isCompressed:b=!0}){this.constructor===g&&(0,d.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=a,this.isCompressed=b}async fetch({name:a}){if(!this.baseUrl)throw Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!a)throw Error("CMap name must be specified.");let b=this.baseUrl+a+(this.isCompressed?".bcmap":""),c=this.isCompressed?d.CMapCompressionType.BINARY:d.CMapCompressionType.NONE;return this._fetchData(b,c).catch(a=>{throw Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${b}`)})}_fetchData(a,b){(0,d.unreachable)("Abstract method `_fetchData` called.")}}class h{constructor({baseUrl:a=null}){this.constructor===h&&(0,d.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=a}async fetch({filename:a}){if(!this.baseUrl)throw Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!a)throw Error("Font filename must be specified.");let b=`${this.baseUrl}${a}`;return this._fetchData(b).catch(a=>{throw Error(`Unable to load font data at: ${b}`)})}_fetchData(a){(0,d.unreachable)("Abstract method `_fetchData` called.")}}class i{constructor(){this.constructor===i&&(0,d.unreachable)("Cannot initialize BaseSVGFactory.")}create(a,b,c=!1){if(a<=0||b<=0)throw Error("Invalid SVG dimensions");let d=this._createSVG("svg:svg");return d.setAttribute("version","1.1"),c||(d.setAttribute("width",`${a}px`),d.setAttribute("height",`${b}px`)),d.setAttribute("preserveAspectRatio","none"),d.setAttribute("viewBox",`0 0 ${a} ${b}`),d}createElement(a){if("string"!=typeof a)throw Error("Invalid SVG element type");return this._createSVG(a)}_createSVG(a){(0,d.unreachable)("Abstract method `_createSVG` called.")}}},250:(a,b,c)=>{c.d(b,{CanvasGraphics:()=>D});var d=c(266),e=c(473);let f="Fill",g="Stroke",h="Shading";function i(a,b){if(!b)return;let c=b[2]-b[0],d=b[3]-b[1],e=new Path2D;e.rect(b[0],b[1],c,d),a.clip(e)}class j{constructor(){this.constructor===j&&(0,d.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,d.unreachable)("Abstract method `getPattern` called.")}}class k extends j{constructor(a){super(),this._type=a[1],this._bbox=a[2],this._colorStops=a[3],this._p0=a[4],this._p1=a[5],this._r0=a[6],this._r1=a[7],this.matrix=null}_createGradient(a){let b;for(let c of("axial"===this._type?b=a.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):"radial"===this._type&&(b=a.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1)),this._colorStops))b.addColorStop(c[0],c[1]);return b}getPattern(a,b,c,h){let j;if(h===g||h===f){let f=b.current.getClippedPathBoundingBox(h,(0,e.getCurrentTransform)(a))||[0,0,0,0],g=Math.ceil(f[2]-f[0])||1,k=Math.ceil(f[3]-f[1])||1,l=b.cachedCanvases.getCanvas("pattern",g,k,!0),m=l.context;m.clearRect(0,0,m.canvas.width,m.canvas.height),m.beginPath(),m.rect(0,0,m.canvas.width,m.canvas.height),m.translate(-f[0],-f[1]),c=d.Util.transform(c,[1,0,0,1,f[0],f[1]]),m.transform(...b.baseTransform),this.matrix&&m.transform(...this.matrix),i(m,this._bbox),m.fillStyle=this._createGradient(m),m.fill(),j=a.createPattern(l.canvas,"no-repeat");let n=new DOMMatrix(c);j.setTransform(n)}else i(a,this._bbox),j=this._createGradient(a);return j}}function l(a,b,c,d,e,f,g,h){let i,j,k,l,m,n,o,p,q,r=b.coords,s=b.colors,t=a.data,u=4*a.width;r[c+1]>r[d+1]&&(i=c,c=d,d=i,i=f,f=g,g=i),r[d+1]>r[e+1]&&(i=d,d=e,e=i,i=g,g=h,h=i),r[c+1]>r[d+1]&&(i=c,c=d,d=i,i=f,f=g,g=i);let v=(r[c]+b.offsetX)*b.scaleX,w=(r[c+1]+b.offsetY)*b.scaleY,x=(r[d]+b.offsetX)*b.scaleX,y=(r[d+1]+b.offsetY)*b.scaleY,z=(r[e]+b.offsetX)*b.scaleX,A=(r[e+1]+b.offsetY)*b.scaleY;if(w>=A)return;let B=s[f],C=s[f+1],D=s[f+2],E=s[g],F=s[g+1],G=s[g+2],H=s[h],I=s[h+1],J=s[h+2],K=Math.round(w),L=Math.round(A);for(let a=K;a<=L;a++){let b;if(a<y){let b=a<w?0:(w-a)/(w-y);j=v-(v-x)*b,k=B-(B-E)*b,l=C-(C-F)*b,m=D-(D-G)*b}else{let b;b=a>A?1:y===A?0:(y-a)/(y-A),j=x-(x-z)*b,k=E-(E-H)*b,l=F-(F-I)*b,m=G-(G-J)*b}b=a<w?0:a>A?1:(w-a)/(w-A),n=v-(v-z)*b,o=B-(B-H)*b,p=C-(C-I)*b,q=D-(D-J)*b;let c=Math.round(Math.min(j,n)),d=Math.round(Math.max(j,n)),e=u*a+4*c;for(let a=c;a<=d;a++)(b=(j-a)/(j-n))<0?b=0:b>1&&(b=1),t[e++]=k-(k-o)*b|0,t[e++]=l-(l-p)*b|0,t[e++]=m-(m-q)*b|0,t[e++]=255}}class m extends j{constructor(a){super(),this._coords=a[2],this._colors=a[3],this._figures=a[4],this._bounds=a[5],this._bbox=a[7],this._background=a[8],this.matrix=null}_createMeshCanvas(a,b,c){let d=Math.floor(this._bounds[0]),e=Math.floor(this._bounds[1]),f=Math.ceil(this._bounds[2])-d,g=Math.ceil(this._bounds[3])-e,h=Math.min(Math.ceil(Math.abs(f*a[0]*1.1)),3e3),i=Math.min(Math.ceil(Math.abs(g*a[1]*1.1)),3e3),j=f/h,k=g/i,m={coords:this._coords,colors:this._colors,offsetX:-d,offsetY:-e,scaleX:1/j,scaleY:1/k},n=h+4,o=i+4,p=c.getCanvas("mesh",n,o,!1),q=p.context,r=q.createImageData(h,i);if(b){let a=r.data;for(let c=0,d=a.length;c<d;c+=4)a[c]=b[0],a[c+1]=b[1],a[c+2]=b[2],a[c+3]=255}for(let a of this._figures)!function(a,b,c){let d,e,f=b.coords,g=b.colors;switch(b.type){case"lattice":let h=b.verticesPerRow,i=Math.floor(f.length/h)-1,j=h-1;for(d=0;d<i;d++){let b=d*h;for(let d=0;d<j;d++,b++)l(a,c,f[b],f[b+1],f[b+h],g[b],g[b+1],g[b+h]),l(a,c,f[b+h+1],f[b+1],f[b+h],g[b+h+1],g[b+1],g[b+h])}break;case"triangles":for(d=0,e=f.length;d<e;d+=3)l(a,c,f[d],f[d+1],f[d+2],g[d],g[d+1],g[d+2]);break;default:throw Error("illegal figure")}}(r,a,m);return q.putImageData(r,2,2),{canvas:p.canvas,offsetX:d-2*j,offsetY:e-2*k,scaleX:j,scaleY:k}}getPattern(a,b,c,f){let g;if(i(a,this._bbox),f===h)g=d.Util.singularValueDecompose2dScale((0,e.getCurrentTransform)(a));else if(g=d.Util.singularValueDecompose2dScale(b.baseTransform),this.matrix){let a=d.Util.singularValueDecompose2dScale(this.matrix);g=[g[0]*a[0],g[1]*a[1]]}let j=this._createMeshCanvas(g,f===h?null:this._background,b.cachedCanvases);return f!==h&&(a.setTransform(...b.baseTransform),this.matrix&&a.transform(...this.matrix)),a.translate(j.offsetX,j.offsetY),a.scale(j.scaleX,j.scaleY),a.createPattern(j.canvas,"no-repeat")}}class n extends j{getPattern(){return"hotpink"}}class o{static MAX_PATTERN_SIZE=3e3;constructor(a,b,c,d,e){this.operatorList=a[2],this.matrix=a[3]||[1,0,0,1,0,0],this.bbox=a[4],this.xstep=a[5],this.ystep=a[6],this.paintType=a[7],this.tilingType=a[8],this.color=b,this.ctx=c,this.canvasGraphicsFactory=d,this.baseTransform=e}createPatternCanvas(a){let b=this.operatorList,c=this.bbox,f=this.xstep,g=this.ystep,h=this.paintType,i=this.tilingType,j=this.color,k=this.canvasGraphicsFactory;(0,d.info)("TilingType: "+i);let l=c[0],m=c[1],n=c[2],o=c[3],p=d.Util.singularValueDecompose2dScale(this.matrix),q=d.Util.singularValueDecompose2dScale(this.baseTransform),r=[p[0]*q[0],p[1]*q[1]],s=this.getSizeAndScale(f,this.ctx.canvas.width,r[0]),t=this.getSizeAndScale(g,this.ctx.canvas.height,r[1]),u=a.cachedCanvases.getCanvas("pattern",s.size,t.size,!0),v=u.context,w=k.createCanvasGraphics(v);w.groupLevel=a.groupLevel,this.setFillAndStrokeStyleToContext(w,h,j);let x=l,y=m,z=n,A=o;return l<0&&(x=0,z+=Math.abs(l)),m<0&&(y=0,A+=Math.abs(m)),v.translate(-(s.scale*x),-(t.scale*y)),w.transform(s.scale,0,0,t.scale,0,0),v.save(),this.clipBbox(w,x,y,z,A),w.baseTransform=(0,e.getCurrentTransform)(w.ctx),w.executeOperatorList(b),w.endDrawing(),{canvas:u.canvas,scaleX:s.scale,scaleY:t.scale,offsetX:x,offsetY:y}}getSizeAndScale(a,b,c){a=Math.abs(a);let d=Math.max(o.MAX_PATTERN_SIZE,b),e=Math.ceil(a*c);return e>=d?e=d:c=e/a,{scale:c,size:e}}clipBbox(a,b,c,d,f){let g=d-b,h=f-c;a.ctx.rect(b,c,g,h),a.current.updateRectMinMax((0,e.getCurrentTransform)(a.ctx),[b,c,d,f]),a.clip(),a.endPath()}setFillAndStrokeStyleToContext(a,b,c){let e=a.ctx,f=a.current;switch(b){case 1:let g=this.ctx;e.fillStyle=g.fillStyle,e.strokeStyle=g.strokeStyle,f.fillColor=g.fillStyle,f.strokeColor=g.strokeStyle;break;case 2:let h=d.Util.makeHexColor(c[0],c[1],c[2]);e.fillStyle=h,e.strokeStyle=h,f.fillColor=h,f.strokeColor=h;break;default:throw new d.FormatError(`Unsupported paint type: ${b}`)}}getPattern(a,b,c,e){let f=c;e!==h&&(f=d.Util.transform(f,b.baseTransform),this.matrix&&(f=d.Util.transform(f,this.matrix)));let g=this.createPatternCanvas(b),i=new DOMMatrix(f);i=(i=i.translate(g.offsetX,g.offsetY)).scale(1/g.scaleX,1/g.scaleY);let j=a.createPattern(g.canvas,"repeat");return j.setTransform(i),j}}class p{constructor(a){this.canvasFactory=a,this.cache=Object.create(null)}getCanvas(a,b,c){let d;return void 0!==this.cache[a]?(d=this.cache[a],this.canvasFactory.reset(d,b,c)):(d=this.canvasFactory.create(b,c),this.cache[a]=d),d}delete(a){delete this.cache[a]}clear(){for(let a in this.cache){let b=this.cache[a];this.canvasFactory.destroy(b),delete this.cache[a]}}}function q(a,b,c,d,f,g,h,i,j,k){let[l,m,n,o,p,q]=(0,e.getCurrentTransform)(a);if(0===m&&0===n){let e=Math.round(h*l+p),r=Math.round(i*o+q),s=Math.abs(Math.round((h+j)*l+p)-e)||1,t=Math.abs(Math.round((i+k)*o+q)-r)||1;return a.setTransform(Math.sign(l),0,0,Math.sign(o),e,r),a.drawImage(b,c,d,f,g,0,0,s,t),a.setTransform(l,m,n,o,p,q),[s,t]}if(0===l&&0===o){let e=Math.round(i*n+p),r=Math.round(h*m+q),s=Math.abs(Math.round((i+k)*n+p)-e)||1,t=Math.abs(Math.round((h+j)*m+q)-r)||1;return a.setTransform(0,Math.sign(m),Math.sign(n),0,e,r),a.drawImage(b,c,d,f,g,0,0,t,s),a.setTransform(l,m,n,o,p,q),[t,s]}a.drawImage(b,c,d,f,g,h,i,j,k);let r=Math.hypot(l,m),s=Math.hypot(n,o);return[r*j,s*k]}class r{constructor(a,b){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=d.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=d.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=d.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,a,b])}clone(){let a=Object.create(this);return a.clipBox=this.clipBox.slice(),a}setCurrentPoint(a,b){this.x=a,this.y=b}updatePathMinMax(a,b,c){[b,c]=d.Util.applyTransform([b,c],a),this.minX=Math.min(this.minX,b),this.minY=Math.min(this.minY,c),this.maxX=Math.max(this.maxX,b),this.maxY=Math.max(this.maxY,c)}updateRectMinMax(a,b){let c=d.Util.applyTransform(b,a),e=d.Util.applyTransform(b.slice(2),a),f=d.Util.applyTransform([b[0],b[3]],a),g=d.Util.applyTransform([b[2],b[1]],a);this.minX=Math.min(this.minX,c[0],e[0],f[0],g[0]),this.minY=Math.min(this.minY,c[1],e[1],f[1],g[1]),this.maxX=Math.max(this.maxX,c[0],e[0],f[0],g[0]),this.maxY=Math.max(this.maxY,c[1],e[1],f[1],g[1])}updateScalingPathMinMax(a,b){d.Util.scaleMinMax(a,b),this.minX=Math.min(this.minX,b[0]),this.maxX=Math.max(this.maxX,b[1]),this.minY=Math.min(this.minY,b[2]),this.maxY=Math.max(this.maxY,b[3])}updateCurvePathMinMax(a,b,c,e,f,g,h,i,j,k){let l=d.Util.bezierBoundingBox(b,c,e,f,g,h,i,j);if(k){k[0]=Math.min(k[0],l[0],l[2]),k[1]=Math.max(k[1],l[0],l[2]),k[2]=Math.min(k[2],l[1],l[3]),k[3]=Math.max(k[3],l[1],l[3]);return}this.updateRectMinMax(a,l)}getPathBoundingBox(a=f,b=null){let c=[this.minX,this.minY,this.maxX,this.maxY];if(a===g){b||(0,d.unreachable)("Stroke bounding box must include transform.");let a=d.Util.singularValueDecompose2dScale(b),e=a[0]*this.lineWidth/2,f=a[1]*this.lineWidth/2;c[0]-=e,c[1]-=f,c[2]+=e,c[3]+=f}return c}updateClipFromPath(){let a=d.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(a||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(a){this.clipBox=a,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(a=f,b=null){return d.Util.intersect(this.clipBox,this.getPathBoundingBox(a,b))}}function s(a,b){let c,e,f,g;if("undefined"!=typeof ImageData&&b instanceof ImageData)return void a.putImageData(b,0,0);let h=b.height,i=b.width,j=h%16,k=(h-j)/16,l=0===j?k:k+1,m=a.createImageData(i,16),n=0,o,p=b.data,q=m.data;if(b.kind===d.ImageKind.GRAYSCALE_1BPP){let b=p.byteLength,g=new Uint32Array(q.buffer,0,q.byteLength>>2),h=g.length,r=i+7>>3,s=d.FeatureTest.isLittleEndian?0xff000000:255;for(c=0;c<l;c++){for(e=0,f=c<k?16:j,o=0;e<f;e++){let a=b-n,c=0,d=a>r?i:8*a-7,e=-8&d,f=0,h=0;for(;c<e;c+=8)h=p[n++],g[o++]=128&h?0xffffffff:s,g[o++]=64&h?0xffffffff:s,g[o++]=32&h?0xffffffff:s,g[o++]=16&h?0xffffffff:s,g[o++]=8&h?0xffffffff:s,g[o++]=4&h?0xffffffff:s,g[o++]=2&h?0xffffffff:s,g[o++]=1&h?0xffffffff:s;for(;c<d;c++)0===f&&(h=p[n++],f=128),g[o++]=h&f?0xffffffff:s,f>>=1}for(;o<h;)g[o++]=0;a.putImageData(m,0,16*c)}}else if(b.kind===d.ImageKind.RGBA_32BPP){for(c=0,e=0,g=16*i*4;c<k;c++)q.set(p.subarray(n,n+g)),n+=g,a.putImageData(m,0,e),e+=16;c<l&&(g=i*j*4,q.set(p.subarray(n,n+g)),a.putImageData(m,0,e))}else if(b.kind===d.ImageKind.RGB_24BPP)for(c=0,f=16,g=i*f;c<l;c++){for(c>=k&&(f=j,g=i*f),o=0,e=g;e--;)q[o++]=p[n++],q[o++]=p[n++],q[o++]=p[n++],q[o++]=255;a.putImageData(m,0,16*c)}else throw Error(`bad image kind: ${b.kind}`)}function t(a,b){if(b.bitmap)return void a.drawImage(b.bitmap,0,0);let c=b.height,e=b.width,f=c%16,g=(c-f)/16,h=0===f?g:g+1,i=a.createImageData(e,16),j=0,k=b.data,l=i.data;for(let b=0;b<h;b++){let c=b<g?16:f;({srcPos:j}=function({src:a,srcPos:b=0,dest:c,width:e,height:f,nonBlackColor:g=0xffffffff,inverseDecode:h=!1}){let i=d.FeatureTest.isLittleEndian?0xff000000:255,[j,k]=h?[g,i]:[i,g],l=e>>3,m=7&e,n=a.length;c=new Uint32Array(c.buffer);let o=0;for(let d=0;d<f;d++){for(let d=b+l;b<d;b++){let d=b<n?a[b]:255;c[o++]=128&d?k:j,c[o++]=64&d?k:j,c[o++]=32&d?k:j,c[o++]=16&d?k:j,c[o++]=8&d?k:j,c[o++]=4&d?k:j,c[o++]=2&d?k:j,c[o++]=1&d?k:j}if(0===m)continue;let d=b<n?a[b++]:255;for(let a=0;a<m;a++)c[o++]=d&1<<7-a?k:j}return{srcPos:b,destPos:o}}({src:k,srcPos:j,dest:l,width:e,height:c,nonBlackColor:0})),a.putImageData(i,0,16*b)}}function u(a,b){for(let c of["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"])void 0!==a[c]&&(b[c]=a[c]);void 0!==a.setLineDash&&(b.setLineDash(a.getLineDash()),b.lineDashOffset=a.lineDashOffset)}function v(a){if(a.strokeStyle=a.fillStyle="#000000",a.fillRule="nonzero",a.globalAlpha=1,a.lineWidth=1,a.lineCap="butt",a.lineJoin="miter",a.miterLimit=10,a.globalCompositeOperation="source-over",a.font="10px sans-serif",void 0!==a.setLineDash&&(a.setLineDash([]),a.lineDashOffset=0),!d.isNodeJS){let{filter:b}=a;"none"!==b&&""!==b&&(a.filter="none")}}function w(a,b,c){let d=a.length,e=1/255;for(let f=3;f<d;f+=4){let d=c?c[a[f]]:a[f];b[f]=b[f]*d*e|0}}function x(a,b,c){let d=a.length;for(let e=3;e<d;e+=4){let d=77*a[e-3]+152*a[e-2]+28*a[e-1];b[e]=c?b[e]*c[d>>8]>>8:b[e]*d>>16}}function y(a,b){let c=d.Util.singularValueDecompose2dScale(a);c[0]=Math.fround(c[0]),c[1]=Math.fround(c[1]);let f=Math.fround((globalThis.devicePixelRatio||1)*e.PixelsPerInch.PDF_TO_CSS_UNITS);return void 0!==b?b:!!(c[0]<=f)||!!(c[1]<=f)}let z=["butt","round","square"],A=["miter","round","bevel"],B={},C={};class D{constructor(a,b,c,d,e,{optionalContentConfig:f,markedContentStack:g=null},h,i){this.ctx=a,this.current=new r(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=b,this.objs=c,this.canvasFactory=d,this.filterFactory=e,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=g||[],this.optionalContentConfig=f,this.cachedCanvases=new p(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=h,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=i,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(a,b=null){return"string"==typeof a?a.startsWith("g_")?this.commonObjs.get(a):this.objs.get(a):b}beginDrawing({transform:a,viewport:b,transparency:c=!1,background:d=null}){let f=this.ctx.canvas.width,g=this.ctx.canvas.height,h=this.ctx.fillStyle;if(this.ctx.fillStyle=d||"#ffffff",this.ctx.fillRect(0,0,f,g),this.ctx.fillStyle=h,c){let a=this.cachedCanvases.getCanvas("transparent",f,g);this.compositeCtx=this.ctx,this.transparentCanvas=a.canvas,this.ctx=a.context,this.ctx.save(),this.ctx.transform(...(0,e.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),v(this.ctx),a&&(this.ctx.transform(...a),this.outputScaleX=a[0],this.outputScaleY=a[0]),this.ctx.transform(...b.transform),this.viewportScale=b.scale,this.baseTransform=(0,e.getCurrentTransform)(this.ctx)}executeOperatorList(a,b,c,e){let f,g=a.argsArray,h=a.fnArray,i=b||0,j=g.length;if(j===i)return i;let k=j-i>10&&"function"==typeof c,l=k?Date.now()+15:0,m=0,n=this.commonObjs,o=this.objs;for(;;){if(void 0!==e&&i===e.nextBreakPoint)return e.breakIt(i,c),i;if((f=h[i])!==d.OPS.dependency)this[f].apply(this,g[i]);else for(let a of g[i]){let b=a.startsWith("g_")?n:o;if(!b.has(a))return b.get(a,c),i}if(++i===j)return i;if(k&&++m>10){if(Date.now()>l)return c(),i;m=0}}}#af(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){for(let a of(this.#af(),this.cachedCanvases.clear(),this.cachedPatterns.clear(),this._cachedBitmapsMap.values())){for(let b of a.values())"undefined"!=typeof HTMLCanvasElement&&b instanceof HTMLCanvasElement&&(b.width=b.height=0);a.clear()}this._cachedBitmapsMap.clear(),this.#ag()}#ag(){if(this.pageColors){let a=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if("none"!==a){let b=this.ctx.filter;this.ctx.filter=a,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=b}}}_scaleImage(a,b){let c,d,e=a.width,f=a.height,g=Math.max(Math.hypot(b[0],b[1]),1),h=Math.max(Math.hypot(b[2],b[3]),1),i=e,j=f,k="prescale1";for(;g>2&&i>1||h>2&&j>1;){let b=i,e=j;g>2&&i>1&&(b=i>=16384?Math.floor(i/2)-1||1:Math.ceil(i/2),g/=i/b),h>2&&j>1&&(e=j>=16384?Math.floor(j/2)-1||1:Math.ceil(j)/2,h/=j/e),(d=(c=this.cachedCanvases.getCanvas(k,b,e)).context).clearRect(0,0,b,e),d.drawImage(a,0,0,i,j,0,0,b,e),a=c.canvas,i=b,j=e,k="prescale1"===k?"prescale2":"prescale1"}return{img:a,paintWidth:i,paintHeight:j}}_createMaskCanvas(a){let b,c,g,h,i=this.ctx,{width:j,height:k}=a,l=this.current.fillColor,m=this.current.patternFill,n=(0,e.getCurrentTransform)(i);if((a.bitmap||a.data)&&a.count>1){let d=a.bitmap||a.data.buffer;c=JSON.stringify(m?n:[n.slice(0,4),l]),(b=this._cachedBitmapsMap.get(d))||(b=new Map,this._cachedBitmapsMap.set(d,b));let e=b.get(c);if(e&&!m){let a=Math.round(Math.min(n[0],n[2])+n[4]),b=Math.round(Math.min(n[1],n[3])+n[5]);return{canvas:e,offsetX:a,offsetY:b}}g=e}g||(h=this.cachedCanvases.getCanvas("maskCanvas",j,k),t(h.context,a));let o=d.Util.transform(n,[1/j,0,0,-1/k,0,0]);o=d.Util.transform(o,[1,0,0,1,0,-k]);let[p,r,s,u]=d.Util.getAxialAlignedBoundingBox([0,0,j,k],o),v=Math.round(s-p)||1,w=Math.round(u-r)||1,x=this.cachedCanvases.getCanvas("fillCanvas",v,w),z=x.context;z.translate(-p,-r),z.transform(...o),!g&&(g=(g=this._scaleImage(h.canvas,(0,e.getCurrentTransformInverse)(z))).img,b&&m&&b.set(c,g)),z.imageSmoothingEnabled=y((0,e.getCurrentTransform)(z),a.interpolate),q(z,g,0,0,g.width,g.height,0,0,j,k),z.globalCompositeOperation="source-in";let A=d.Util.transform((0,e.getCurrentTransformInverse)(z),[1,0,0,1,-p,-r]);return z.fillStyle=m?l.getPattern(i,this,A,f):l,z.fillRect(0,0,j,k),b&&!m&&(this.cachedCanvases.delete("fillCanvas"),b.set(c,x.canvas)),{canvas:x.canvas,offsetX:Math.round(p),offsetY:Math.round(r)}}setLineWidth(a){a!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=a,this.ctx.lineWidth=a}setLineCap(a){this.ctx.lineCap=z[a]}setLineJoin(a){this.ctx.lineJoin=A[a]}setMiterLimit(a){this.ctx.miterLimit=a}setDash(a,b){let c=this.ctx;void 0!==c.setLineDash&&(c.setLineDash(a),c.lineDashOffset=b)}setRenderingIntent(a){}setFlatness(a){}setGState(a){for(let[b,c]of a)switch(b){case"LW":this.setLineWidth(c);break;case"LC":this.setLineCap(c);break;case"LJ":this.setLineJoin(c);break;case"ML":this.setMiterLimit(c);break;case"D":this.setDash(c[0],c[1]);break;case"RI":this.setRenderingIntent(c);break;case"FL":this.setFlatness(c);break;case"Font":this.setFont(c[0],c[1]);break;case"CA":this.current.strokeAlpha=c;break;case"ca":this.current.fillAlpha=c,this.ctx.globalAlpha=c;break;case"BM":this.ctx.globalCompositeOperation=c;break;case"SMask":this.current.activeSMask=c?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(c)}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){let a=this.inSMaskMode;this.current.activeSMask&&!a?this.beginSMaskMode():!this.current.activeSMask&&a&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw Error("beginSMaskMode called while already in smask mode");let a=this.ctx.canvas.width,b=this.ctx.canvas.height,c="smaskGroupAt"+this.groupLevel,d=this.cachedCanvases.getCanvas(c,a,b);this.suspendedCtx=this.ctx,this.ctx=d.context;let f=this.ctx;f.setTransform(...(0,e.getCurrentTransform)(this.suspendedCtx)),u(this.suspendedCtx,f);var g=this.suspendedCtx;if(f._removeMirroring)throw Error("Context is already forwarding operations.");f.__originalSave=f.save,f.__originalRestore=f.restore,f.__originalRotate=f.rotate,f.__originalScale=f.scale,f.__originalTranslate=f.translate,f.__originalTransform=f.transform,f.__originalSetTransform=f.setTransform,f.__originalResetTransform=f.resetTransform,f.__originalClip=f.clip,f.__originalMoveTo=f.moveTo,f.__originalLineTo=f.lineTo,f.__originalBezierCurveTo=f.bezierCurveTo,f.__originalRect=f.rect,f.__originalClosePath=f.closePath,f.__originalBeginPath=f.beginPath,f._removeMirroring=()=>{f.save=f.__originalSave,f.restore=f.__originalRestore,f.rotate=f.__originalRotate,f.scale=f.__originalScale,f.translate=f.__originalTranslate,f.transform=f.__originalTransform,f.setTransform=f.__originalSetTransform,f.resetTransform=f.__originalResetTransform,f.clip=f.__originalClip,f.moveTo=f.__originalMoveTo,f.lineTo=f.__originalLineTo,f.bezierCurveTo=f.__originalBezierCurveTo,f.rect=f.__originalRect,f.closePath=f.__originalClosePath,f.beginPath=f.__originalBeginPath,delete f._removeMirroring},f.save=function(){g.save(),this.__originalSave()},f.restore=function(){g.restore(),this.__originalRestore()},f.translate=function(a,b){g.translate(a,b),this.__originalTranslate(a,b)},f.scale=function(a,b){g.scale(a,b),this.__originalScale(a,b)},f.transform=function(a,b,c,d,e,f){g.transform(a,b,c,d,e,f),this.__originalTransform(a,b,c,d,e,f)},f.setTransform=function(a,b,c,d,e,f){g.setTransform(a,b,c,d,e,f),this.__originalSetTransform(a,b,c,d,e,f)},f.resetTransform=function(){g.resetTransform(),this.__originalResetTransform()},f.rotate=function(a){g.rotate(a),this.__originalRotate(a)},f.clip=function(a){g.clip(a),this.__originalClip(a)},f.moveTo=function(a,b){g.moveTo(a,b),this.__originalMoveTo(a,b)},f.lineTo=function(a,b){g.lineTo(a,b),this.__originalLineTo(a,b)},f.bezierCurveTo=function(a,b,c,d,e,f){g.bezierCurveTo(a,b,c,d,e,f),this.__originalBezierCurveTo(a,b,c,d,e,f)},f.rect=function(a,b,c,d){g.rect(a,b,c,d),this.__originalRect(a,b,c,d)},f.closePath=function(){g.closePath(),this.__originalClosePath()},f.beginPath=function(){g.beginPath(),this.__originalBeginPath()},this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),u(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(a){var b,c,d;let e,f,g,h;if(!this.current.activeSMask)return;a?(a[0]=Math.floor(a[0]),a[1]=Math.floor(a[1]),a[2]=Math.ceil(a[2]),a[3]=Math.ceil(a[3])):a=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];let i=this.current.activeSMask;b=this.suspendedCtx,c=this.ctx,e=(d=a)[0],f=d[1],g=d[2]-e,h=d[3]-f,0!==g&&0!==h&&(!function(a,b,c,d,e,f,g,h,i,j,k){let l=!!f,m=l?f[0]:0,n=l?f[1]:0,o=l?f[2]:0,p="Luminosity"===e?x:w,q=Math.min(d,Math.ceil(1048576/c));for(let e=0;e<d;e+=q){let f=Math.min(q,d-e),r=a.getImageData(h-j,e+(i-k),c,f),s=b.getImageData(h,e+i,c,f);l&&function(a,b,c,d){let e=a.length;for(let f=3;f<e;f+=4){let e=a[f];if(0===e)a[f-3]=b,a[f-2]=c,a[f-1]=d;else if(e<255){let g=255-e;a[f-3]=a[f-3]*e+b*g>>8,a[f-2]=a[f-2]*e+c*g>>8,a[f-1]=a[f-1]*e+d*g>>8}}}(r.data,m,n,o),p(r.data,s.data,g),b.putImageData(s,h,e+i)}}(i.context,c,g,h,i.subtype,i.backdrop,i.transferMap,e,f,i.offsetX,i.offsetY),b.save(),b.globalAlpha=1,b.globalCompositeOperation="source-over",b.setTransform(1,0,0,1,0,0),b.drawImage(c.canvas,0,0),b.restore()),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(u(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();let a=this.current;this.stateStack.push(a),this.current=a.clone()}restore(){0===this.stateStack.length&&this.inSMaskMode&&this.endSMaskMode(),0!==this.stateStack.length&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),u(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(a,b,c,d,e,f){this.ctx.transform(a,b,c,d,e,f),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(a,b,c){let f,g,h=this.ctx,i=this.current,j=i.x,k=i.y,l=(0,e.getCurrentTransform)(h),m=0===l[0]&&0===l[3]||0===l[1]&&0===l[2],n=m?c.slice(0):null;for(let c=0,e=0,o=a.length;c<o;c++)switch(0|a[c]){case d.OPS.rectangle:j=b[e++],k=b[e++];let o=b[e++],p=b[e++],q=j+o,r=k+p;h.moveTo(j,k),0===o||0===p?h.lineTo(q,r):(h.lineTo(q,k),h.lineTo(q,r),h.lineTo(j,r)),m||i.updateRectMinMax(l,[j,k,q,r]),h.closePath();break;case d.OPS.moveTo:j=b[e++],k=b[e++],h.moveTo(j,k),m||i.updatePathMinMax(l,j,k);break;case d.OPS.lineTo:j=b[e++],k=b[e++],h.lineTo(j,k),m||i.updatePathMinMax(l,j,k);break;case d.OPS.curveTo:f=j,g=k,j=b[e+4],k=b[e+5],h.bezierCurveTo(b[e],b[e+1],b[e+2],b[e+3],j,k),i.updateCurvePathMinMax(l,f,g,b[e],b[e+1],b[e+2],b[e+3],j,k,n),e+=6;break;case d.OPS.curveTo2:f=j,g=k,h.bezierCurveTo(j,k,b[e],b[e+1],b[e+2],b[e+3]),i.updateCurvePathMinMax(l,f,g,j,k,b[e],b[e+1],b[e+2],b[e+3],n),j=b[e+2],k=b[e+3],e+=4;break;case d.OPS.curveTo3:f=j,g=k,j=b[e+2],k=b[e+3],h.bezierCurveTo(b[e],b[e+1],j,k,j,k),i.updateCurvePathMinMax(l,f,g,b[e],b[e+1],j,k,j,k,n),e+=4;break;case d.OPS.closePath:h.closePath()}m&&i.updateScalingPathMinMax(l,n),i.setCurrentPoint(j,k)}closePath(){this.ctx.closePath()}stroke(a=!0){let b=this.ctx,c=this.current.strokeColor;b.globalAlpha=this.current.strokeAlpha,this.contentVisible&&("object"==typeof c&&c?.getPattern?(b.save(),b.strokeStyle=c.getPattern(b,this,(0,e.getCurrentTransformInverse)(b),g),this.rescaleAndStroke(!1),b.restore()):this.rescaleAndStroke(!0)),a&&this.consumePath(this.current.getClippedPathBoundingBox()),b.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(a=!0){let b=this.ctx,c=this.current.fillColor,d=this.current.patternFill,g=!1;d&&(b.save(),b.fillStyle=c.getPattern(b,this,(0,e.getCurrentTransformInverse)(b),f),g=!0);let h=this.current.getClippedPathBoundingBox();this.contentVisible&&null!==h&&(this.pendingEOFill?(b.fill("evenodd"),this.pendingEOFill=!1):b.fill()),g&&b.restore(),a&&this.consumePath(h)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=B}eoClip(){this.pendingClip=C}beginText(){this.current.textMatrix=d.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){let a=this.pendingTextPaths,b=this.ctx;if(void 0===a)return void b.beginPath();for(let c of(b.save(),b.beginPath(),a))b.setTransform(...c.transform),b.translate(c.x,c.y),c.addToPath(b,c.fontSize);b.restore(),b.clip(),b.beginPath(),delete this.pendingTextPaths}setCharSpacing(a){this.current.charSpacing=a}setWordSpacing(a){this.current.wordSpacing=a}setHScale(a){this.current.textHScale=a/100}setLeading(a){this.current.leading=-a}setFont(a,b){let c=this.commonObjs.get(a),e=this.current;if(!c)throw Error(`Can't find font for ${a}`);if(e.fontMatrix=c.fontMatrix||d.FONT_IDENTITY_MATRIX,(0===e.fontMatrix[0]||0===e.fontMatrix[3])&&(0,d.warn)("Invalid font matrix for font "+a),b<0?(b=-b,e.fontDirection=-1):e.fontDirection=1,this.current.font=c,this.current.fontSize=b,c.isType3Font)return;let f=c.loadedName||"sans-serif",g=c.systemFontInfo?.css||`"${f}", ${c.fallbackName}`,h="normal";c.black?h="900":c.bold&&(h="bold");let i=c.italic?"italic":"normal",j=b;b<16?j=16:b>100&&(j=100),this.current.fontSizeScale=b/j,this.ctx.font=`${i} ${h} ${j}px ${g}`}setTextRenderingMode(a){this.current.textRenderingMode=a}setTextRise(a){this.current.textRise=a}moveText(a,b){this.current.x=this.current.lineX+=a,this.current.y=this.current.lineY+=b}setLeadingMoveText(a,b){this.setLeading(-b),this.moveText(a,b)}setTextMatrix(a,b,c,d,e,f){this.current.textMatrix=[a,b,c,d,e,f],this.current.textMatrixScale=Math.hypot(a,b),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(a,b,c,f){let g,h=this.ctx,i=this.current,j=i.font,k=i.textRenderingMode,l=i.fontSize/i.fontSizeScale,m=k&d.TextRenderingMode.FILL_STROKE_MASK,n=!!(k&d.TextRenderingMode.ADD_TO_PATH_FLAG),o=i.patternFill&&!j.missingFile;(j.disableFontFace||n||o)&&(g=j.getPathGenerator(this.commonObjs,a)),j.disableFontFace||o?(h.save(),h.translate(b,c),h.beginPath(),g(h,l),f&&h.setTransform(...f),(m===d.TextRenderingMode.FILL||m===d.TextRenderingMode.FILL_STROKE)&&h.fill(),(m===d.TextRenderingMode.STROKE||m===d.TextRenderingMode.FILL_STROKE)&&h.stroke(),h.restore()):((m===d.TextRenderingMode.FILL||m===d.TextRenderingMode.FILL_STROKE)&&h.fillText(a,b,c),(m===d.TextRenderingMode.STROKE||m===d.TextRenderingMode.FILL_STROKE)&&h.strokeText(a,b,c)),n&&(this.pendingTextPaths||=[]).push({transform:(0,e.getCurrentTransform)(h),x:b,y:c,fontSize:l,addToPath:g})}get isFontSubpixelAAEnabled(){let{context:a}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);a.scale(1.5,1),a.fillText("I",0,10);let b=a.getImageData(0,0,10,10).data,c=!1;for(let a=3;a<b.length;a+=4)if(b[a]>0&&b[a]<255){c=!0;break}return(0,d.shadow)(this,"isFontSubpixelAAEnabled",c)}showText(a){let b,c=this.current,g=c.font;if(g.isType3Font)return this.showType3Text(a);let h=c.fontSize;if(0===h)return;let i=this.ctx,j=c.fontSizeScale,k=c.charSpacing,l=c.wordSpacing,m=c.fontDirection,n=c.textHScale*m,o=a.length,p=g.vertical,q=p?1:-1,r=g.defaultVMetrics,s=h*c.fontMatrix[0],t=c.textRenderingMode===d.TextRenderingMode.FILL&&!g.disableFontFace&&!c.patternFill;if(i.save(),i.transform(...c.textMatrix),i.translate(c.x,c.y+c.textRise),m>0?i.scale(n,-1):i.scale(n,1),c.patternFill){i.save();let a=c.fillColor.getPattern(i,this,(0,e.getCurrentTransformInverse)(i),f);b=(0,e.getCurrentTransform)(i),i.restore(),i.fillStyle=a}let u=c.lineWidth,v=c.textMatrixScale;if(0===v||0===u){let a=c.textRenderingMode&d.TextRenderingMode.FILL_STROKE_MASK;(a===d.TextRenderingMode.STROKE||a===d.TextRenderingMode.FILL_STROKE)&&(u=this.getSinglePixelWidth())}else u/=v;if(1!==j&&(i.scale(j,j),u/=j),i.lineWidth=u,g.isInvalidPDFjsFont){let b=[],d=0;for(let c of a)b.push(c.unicode),d+=c.width;i.fillText(b.join(""),0,0),c.x+=d*s*n,i.restore(),this.compose();return}let w=0,x;for(x=0;x<o;++x){let c,d,e=a[x];if("number"==typeof e){w+=q*e*h/1e3;continue}let f=!1,n=(e.isSpace?l:0)+k,o=e.fontChar,u=e.accent,v=e.width;if(p){let a=e.vmetric||r,b=-(e.vmetric?a[1]:.5*v)*s,f=a[2]*s;v=a?-a[0]:v,c=b/j,d=(w+f)/j}else c=w/j,d=0;if(g.remeasure&&v>0){let a=1e3*i.measureText(o).width/h*j;if(v<a&&this.isFontSubpixelAAEnabled){let b=v/a;f=!0,i.save(),i.scale(b,1),c/=b}else v!==a&&(c+=(v-a)/2e3*h/j)}if(this.contentVisible&&(e.isInFont||g.missingFile)){if(t&&!u)i.fillText(o,c,d);else if(this.paintChar(o,c,d,b),u){let a=c+h*u.offset.x/j,e=d-h*u.offset.y/j;this.paintChar(u.fontChar,a,e,b)}}let y=p?v*s-n*m:v*s+n*m;w+=y,f&&i.restore()}p?c.y-=w:c.x+=w*n,i.restore(),this.compose()}showType3Text(a){let b,c,e,f,g=this.ctx,h=this.current,i=h.font,j=h.fontSize,k=h.fontDirection,l=i.vertical?1:-1,m=h.charSpacing,n=h.wordSpacing,o=h.textHScale*k,p=h.fontMatrix||d.FONT_IDENTITY_MATRIX,q=a.length;if(h.textRenderingMode!==d.TextRenderingMode.INVISIBLE&&0!==j){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,g.save(),g.transform(...h.textMatrix),g.translate(h.x,h.y),g.scale(o,k),b=0;b<q;++b){if(c=a[b],"number"==typeof c){f=l*c*j/1e3,this.ctx.translate(f,0),h.x+=f*o;continue}let k=(c.isSpace?n:0)+m,q=i.charProcOperatorList[c.operatorListId];if(!q){(0,d.warn)(`Type3 character "${c.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=c,this.save(),g.scale(j,j),g.transform(...p),this.executeOperatorList(q),this.restore()),e=d.Util.applyTransform([c.width,0],p)[0]*j+k,g.translate(e,0),h.x+=e*o}g.restore(),this.processingType3=null}}setCharWidth(a,b){}setCharWidthAndBounds(a,b,c,d,e,f){this.ctx.rect(c,d,e-c,f-d),this.ctx.clip(),this.endPath()}getColorN_Pattern(a){let b;if("TilingPattern"===a[0]){let c=a[1],d=this.baseTransform||(0,e.getCurrentTransform)(this.ctx);b=new o(a,c,this.ctx,{createCanvasGraphics:a=>new D(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})},d)}else b=this._getPattern(a[1],a[2]);return b}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(a,b,c){let e=d.Util.makeHexColor(a,b,c);this.ctx.strokeStyle=e,this.current.strokeColor=e}setFillRGBColor(a,b,c){let e=d.Util.makeHexColor(a,b,c);this.ctx.fillStyle=e,this.current.fillColor=e,this.current.patternFill=!1}_getPattern(a,b=null){let c;return this.cachedPatterns.has(a)?c=this.cachedPatterns.get(a):(c=function(a){switch(a[0]){case"RadialAxial":return new k(a);case"Mesh":return new m(a);case"Dummy":return new n}throw Error(`Unknown IR type: ${a[0]}`)}(this.getObject(a)),this.cachedPatterns.set(a,c)),b&&(c.matrix=b),c}shadingFill(a){if(!this.contentVisible)return;let b=this.ctx;this.save(),b.fillStyle=this._getPattern(a).getPattern(b,this,(0,e.getCurrentTransformInverse)(b),h);let c=(0,e.getCurrentTransformInverse)(b);if(c){let{width:a,height:e}=b.canvas,[f,g,h,i]=d.Util.getAxialAlignedBoundingBox([0,0,a,e],c);this.ctx.fillRect(f,g,h-f,i-g)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,d.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,d.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(a,b){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(a)&&6===a.length&&this.transform(...a),this.baseTransform=(0,e.getCurrentTransform)(this.ctx),b)){let a=b[2]-b[0],c=b[3]-b[1];this.ctx.rect(b[0],b[1],a,c),this.current.updateRectMinMax((0,e.getCurrentTransform)(this.ctx),b),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(a){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);let b=this.ctx;a.isolated||(0,d.info)("TODO: Support non-isolated groups."),a.knockout&&(0,d.warn)("Knockout groups not supported.");let c=(0,e.getCurrentTransform)(b);if(a.matrix&&b.transform(...a.matrix),!a.bbox)throw Error("Bounding box is required.");let f=d.Util.getAxialAlignedBoundingBox(a.bbox,(0,e.getCurrentTransform)(b)),g=[0,0,b.canvas.width,b.canvas.height];f=d.Util.intersect(f,g)||[0,0,0,0];let h=Math.floor(f[0]),i=Math.floor(f[1]),j=Math.max(Math.ceil(f[2])-h,1),k=Math.max(Math.ceil(f[3])-i,1),l=1,m=1;j>4096&&(l=j/4096,j=4096),k>4096&&(m=k/4096,k=4096),this.current.startNewPathAndClipBox([0,0,j,k]);let n="groupAt"+this.groupLevel;a.smask&&(n+="_smask_"+this.smaskCounter++%2);let o=this.cachedCanvases.getCanvas(n,j,k),p=o.context;p.scale(1/l,1/m),p.translate(-h,-i),p.transform(...c),a.smask?this.smaskStack.push({canvas:o.canvas,context:p,offsetX:h,offsetY:i,scaleX:l,scaleY:m,subtype:a.smask.subtype,backdrop:a.smask.backdrop,transferMap:a.smask.transferMap||null,startTransformInverse:null}):(b.setTransform(1,0,0,1,0,0),b.translate(h,i),b.scale(l,m),b.save()),u(b,p),this.ctx=p,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(b),this.groupLevel++}endGroup(a){if(!this.contentVisible)return;this.groupLevel--;let b=this.ctx,c=this.groupStack.pop();if(this.ctx=c,this.ctx.imageSmoothingEnabled=!1,a.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();let a=(0,e.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...a);let c=d.Util.getAxialAlignedBoundingBox([0,0,b.canvas.width,b.canvas.height],a);this.ctx.drawImage(b.canvas,0,0),this.ctx.restore(),this.compose(c)}}beginAnnotation(a,b,c,f,g){if(this.#af(),v(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(b)&&4===b.length){let f=b[2]-b[0],h=b[3]-b[1];if(g&&this.annotationCanvasMap){c=c.slice(),c[4]-=b[0],c[5]-=b[1],(b=b.slice())[0]=b[1]=0,b[2]=f,b[3]=h;let[g,i]=d.Util.singularValueDecompose2dScale((0,e.getCurrentTransform)(this.ctx)),{viewportScale:j}=this,k=Math.ceil(f*this.outputScaleX*j),l=Math.ceil(h*this.outputScaleY*j);this.annotationCanvas=this.canvasFactory.create(k,l);let{canvas:m,context:n}=this.annotationCanvas;this.annotationCanvasMap.set(a,m),this.annotationCanvas.savedCtx=this.ctx,this.ctx=n,this.ctx.save(),this.ctx.setTransform(g,0,0,-i,0,h*i),v(this.ctx)}else v(this.ctx),this.ctx.rect(b[0],b[1],f,h),this.ctx.clip(),this.endPath()}this.current=new r(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...c),this.transform(...f)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),this.#ag(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(a){if(!this.contentVisible)return;let b=a.count;(a=this.getObject(a.data,a)).count=b;let c=this.ctx,d=this.processingType3;if(d&&(void 0===d.compiled&&(d.compiled=function(a){let b,c,d,{width:e,height:f}=a;if(e>1e3||f>1e3)return null;let g=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),h=e+1,i=new Uint8Array(h*(f+1)),j=e+7&-8,k=new Uint8Array(j*f),l=0;for(let b of a.data){let a=128;for(;a>0;)k[l++]=b&a?0:255,a>>=1}let m=0;for(l=0,0!==k[l]&&(i[0]=1,++m),c=1;c<e;c++)k[l]!==k[l+1]&&(i[c]=k[l]?2:1,++m),l++;for(0!==k[l]&&(i[c]=2,++m),b=1;b<f;b++){l=b*j,d=b*h,k[l-j]!==k[l]&&(i[d]=k[l]?1:8,++m);let a=4*!!k[l]+8*!!k[l-j];for(c=1;c<e;c++)g[a=(a>>2)+4*!!k[l+1]+8*!!k[l-j+1]]&&(i[d+c]=g[a],++m),l++;if(k[l-j]!==k[l]&&(i[d+c]=k[l]?2:4,++m),m>1e3)return null}for(l=j*(f-1),d=b*h,0!==k[l]&&(i[d]=8,++m),c=1;c<e;c++)k[l]!==k[l+1]&&(i[d+c]=k[l]?4:8,++m),l++;if(0!==k[l]&&(i[d+c]=4,++m),m>1e3)return null;let n=new Int32Array([0,h,-1,0,-h,0,0,0,1]),o=new Path2D;for(b=0;m&&b<=f;b++){let a=b*h,c=a+e;for(;a<c&&!i[a];)a++;if(a===c)continue;o.moveTo(a%h,b);let d=a,f=i[a];do{let b=n[f];do a+=b;while(!i[a])let c=i[a];5!==c&&10!==c?(f=c,i[a]=0):(f=c&51*f>>4,i[a]&=f>>2|f<<2),o.lineTo(a%h,a/h|0),!i[a]&&--m}while(d!==a)--b}return k=null,i=null,function(a){a.save(),a.scale(1/e,-1/f),a.translate(0,-f),a.fill(o),a.beginPath(),a.restore()}}(a)),d.compiled))return void d.compiled(c);let e=this._createMaskCanvas(a),f=e.canvas;c.save(),c.setTransform(1,0,0,1,0,0),c.drawImage(f,e.offsetX,e.offsetY),c.restore(),this.compose()}paintImageMaskXObjectRepeat(a,b,c=0,f=0,g,h){if(!this.contentVisible)return;a=this.getObject(a.data,a);let i=this.ctx;i.save();let j=(0,e.getCurrentTransform)(i);i.transform(b,c,f,g,0,0);let k=this._createMaskCanvas(a);i.setTransform(1,0,0,1,k.offsetX-j[4],k.offsetY-j[5]);for(let a=0,e=h.length;a<e;a+=2){let e=d.Util.transform(j,[b,c,f,g,h[a],h[a+1]]),[l,m]=d.Util.applyTransform([0,0],e);i.drawImage(k.canvas,l,m)}i.restore(),this.compose()}paintImageMaskXObjectGroup(a){if(!this.contentVisible)return;let b=this.ctx,c=this.current.fillColor,d=this.current.patternFill;for(let g of a){let{data:a,width:h,height:i,transform:j}=g,k=this.cachedCanvases.getCanvas("maskCanvas",h,i),l=k.context;l.save();let m=this.getObject(a,g);t(l,m),l.globalCompositeOperation="source-in",l.fillStyle=d?c.getPattern(l,this,(0,e.getCurrentTransformInverse)(b),f):c,l.fillRect(0,0,h,i),l.restore(),b.save(),b.transform(...j),b.scale(1,-1),q(b,k.canvas,0,0,h,i,0,-1,1,1),b.restore()}this.compose()}paintImageXObject(a){if(!this.contentVisible)return;let b=this.getObject(a);b?this.paintInlineImageXObject(b):(0,d.warn)("Dependent image isn't ready yet")}paintImageXObjectRepeat(a,b,c,e){if(!this.contentVisible)return;let f=this.getObject(a);if(!f)return void(0,d.warn)("Dependent image isn't ready yet");let g=f.width,h=f.height,i=[];for(let a=0,d=e.length;a<d;a+=2)i.push({transform:[b,0,0,c,e[a],e[a+1]],x:0,y:0,w:g,h:h});this.paintInlineImageXObjectGroup(f,i)}applyTransferMapsToCanvas(a){return"none"!==this.current.transferMaps&&(a.filter=this.current.transferMaps,a.drawImage(a.canvas,0,0),a.filter="none"),a.canvas}applyTransferMapsToBitmap(a){if("none"===this.current.transferMaps)return a.bitmap;let{bitmap:b,width:c,height:d}=a,e=this.cachedCanvases.getCanvas("inlineImage",c,d),f=e.context;return f.filter=this.current.transferMaps,f.drawImage(b,0,0),f.filter="none",e.canvas}paintInlineImageXObject(a){let b;if(!this.contentVisible)return;let c=a.width,f=a.height,g=this.ctx;if(this.save(),!d.isNodeJS){let{filter:a}=g;"none"!==a&&""!==a&&(g.filter="none")}if(g.scale(1/c,-1/f),a.bitmap)b=this.applyTransferMapsToBitmap(a);else if("function"==typeof HTMLElement&&a instanceof HTMLElement||!a.data)b=a;else{let d=this.cachedCanvases.getCanvas("inlineImage",c,f).context;s(d,a),b=this.applyTransferMapsToCanvas(d)}let h=this._scaleImage(b,(0,e.getCurrentTransformInverse)(g));g.imageSmoothingEnabled=y((0,e.getCurrentTransform)(g),a.interpolate),q(g,h.img,0,0,h.paintWidth,h.paintHeight,0,-f,c,f),this.compose(),this.restore()}paintInlineImageXObjectGroup(a,b){let c;if(!this.contentVisible)return;let d=this.ctx;if(a.bitmap)c=a.bitmap;else{let b=a.width,d=a.height,e=this.cachedCanvases.getCanvas("inlineImage",b,d).context;s(e,a),c=this.applyTransferMapsToCanvas(e)}for(let a of b)d.save(),d.transform(...a.transform),d.scale(1,-1),q(d,c,a.x,a.y,a.w,a.h,0,-1,1,1),d.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(a){}markPointProps(a,b){}beginMarkedContent(a){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(a,b){"OC"===a?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(b)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(a){let b=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(a);let c=this.ctx;this.pendingClip&&(b||(this.pendingClip===C?c.clip("evenodd"):c.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),c.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){let a=(0,e.getCurrentTransform)(this.ctx);if(0===a[1]&&0===a[2])this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(a[0]),Math.abs(a[3]));else{let b=Math.abs(a[0]*a[3]-a[2]*a[1]),c=Math.hypot(a[0],a[2]),d=Math.hypot(a[1],a[3]);this._cachedGetSinglePixelWidth=Math.max(c,d)/b}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(-1===this._cachedScaleForStroking[0]){let a,b,{lineWidth:c}=this.current,{a:d,b:e,c:f,d:g}=this.ctx.getTransform();if(0===e&&0===f){let e=Math.abs(d),f=Math.abs(g);if(e===f)if(0===c)a=b=1/e;else{let d=e*c;a=b=d<1?1/d:1}else if(0===c)a=1/e,b=1/f;else{let d=e*c,g=f*c;a=d<1?1/d:1,b=g<1?1/g:1}}else{let h=Math.abs(d*g-e*f),i=Math.hypot(d,e),j=Math.hypot(f,g);if(0===c)a=j/h,b=i/h;else{let d=c*h;a=j>d?j/d:1,b=i>d?i/d:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=b}return this._cachedScaleForStroking}rescaleAndStroke(a){let{ctx:b}=this,{lineWidth:c}=this.current,[d,e]=this.getScaleForStroking();if(b.lineWidth=c||1,1===d&&1===e)return void b.stroke();let f=b.getLineDash();if(a&&b.save(),b.scale(d,e),f.length>0){let a=Math.max(d,e);b.setLineDash(f.map(b=>b/a)),b.lineDashOffset/=a}b.stroke(),a&&b.restore()}isContentVisible(){for(let a=this.markedContentStack.length-1;a>=0;a--)if(!this.markedContentStack[a].visible)return!1;return!0}}for(let a in d.OPS)void 0!==D.prototype[a]&&(D.prototype[d.OPS[a]]=D.prototype[a])},473:(a,b,c)=>{let d;c.d(b,{DOMCMapReaderFactory:()=>l,DOMCanvasFactory:()=>j,DOMFilterFactory:()=>i,DOMSVGFactory:()=>n,DOMStandardFontDataFactory:()=>m,PDFDateString:()=>x,PageViewport:()=>o,PixelsPerInch:()=>h,RenderingCancelledException:()=>p,StatTimer:()=>u,fetchData:()=>k,getColorValues:()=>A,getCurrentTransform:()=>B,getCurrentTransformInverse:()=>C,getFilenameFromUrl:()=>s,getPdfFilenameFromUrl:()=>t,getRGB:()=>z,getXfaPageViewport:()=>y,isDataScheme:()=>q,isPdfFile:()=>r,isValidFetchUrl:()=>v,noContextMenu:()=>w,setLayerDimensions:()=>D});var e=c(822),f=c(266);let g="http://www.w3.org/2000/svg";class h{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}class i extends e.BaseFilterFactory{#ah;#ai;#P;#aj;#ak;#al;#am;#an;#ao;#ap;#aq=0;constructor({docId:a,ownerDocument:b=globalThis.document}={}){super(),this.#P=a,this.#aj=b}get #ar(){return this.#ah||=new Map}get #as(){if(!this.#ai){let a=this.#aj.createElement("div"),{style:b}=a;b.visibility="hidden",b.contain="strict",b.width=b.height=0,b.position="absolute",b.top=b.left=0,b.zIndex=-1;let c=this.#aj.createElementNS(g,"svg");c.setAttribute("width",0),c.setAttribute("height",0),this.#ai=this.#aj.createElementNS(g,"defs"),a.append(c),c.append(this.#ai),this.#aj.body.append(a)}return this.#ai}addFilter(a){let b,c,d,e;if(!a)return"none";let f=this.#ar.get(a);if(f)return f;if(1===a.length){let f=a[0],g=Array(256);for(let a=0;a<256;a++)g[a]=f[a]/255;e=b=c=d=g.join(",")}else{let[f,g,h]=a,i=Array(256),j=Array(256),k=Array(256);for(let a=0;a<256;a++)i[a]=f[a]/255,j[a]=g[a]/255,k[a]=h[a]/255;b=i.join(","),c=j.join(","),d=k.join(","),e=`${b}${c}${d}`}if(f=this.#ar.get(e))return this.#ar.set(a,f),f;let g=`g_${this.#P}_transfer_map_${this.#aq++}`,h=`url(#${g})`;this.#ar.set(a,h),this.#ar.set(e,h);let i=this.#at(g);return this.#au(b,c,d,i),h}addHCMFilter(a,b){let c=`${a}-${b}`;if(this.#al===c||(this.#al=c,this.#am="none",this.#ak?.remove(),!a||!b))return this.#am;let d=this.#av(a);a=f.Util.makeHexColor(...d);let e=this.#av(b);if(b=f.Util.makeHexColor(...e),this.#as.style.color="","#000000"===a&&"#ffffff"===b||a===b)return this.#am;let g=Array(256);for(let a=0;a<=255;a++){let b=a/255;g[a]=b<=.03928?b/12.92:((b+.055)/1.055)**2.4}let h=g.join(","),i=`g_${this.#P}_hcm_filter`,j=this.#an=this.#at(i);this.#au(h,h,h,j),this.#aw(j);let k=(a,b)=>{let c=d[a]/255,f=e[a]/255,g=Array(b+1);for(let a=0;a<=b;a++)g[a]=c+a/b*(f-c);return g.join(",")};return this.#au(k(0,5),k(1,5),k(2,5),j),this.#am=`url(#${i})`,this.#am}addHighlightHCMFilter(a,b,c,d){let e=`${a}-${b}-${c}-${d}`;if(this.#ao===e||(this.#ao=e,this.#ap="none",this.#an?.remove(),!a||!b))return this.#ap;let[f,g]=[a,b].map(this.#av.bind(this)),h=Math.round(.2126*f[0]+.7152*f[1]+.0722*f[2]),i=Math.round(.2126*g[0]+.7152*g[1]+.0722*g[2]),[j,k]=[c,d].map(this.#av.bind(this));i<h&&([h,i,j,k]=[i,h,k,j]),this.#as.style.color="";let l=(a,b,c)=>{let d=Array(256),e=(i-h)/c,f=a/255,g=(b-a)/(255*c),j=0;for(let a=0;a<=c;a++){let b=Math.round(h+a*e),c=f+a*g;for(let a=j;a<=b;a++)d[a]=c;j=b+1}for(let a=j;a<256;a++)d[a]=d[j-1];return d.join(",")},m=`g_${this.#P}_hcm_highlight_filter`,n=this.#an=this.#at(m);return this.#aw(n),this.#au(l(j[0],k[0],5),l(j[1],k[1],5),l(j[2],k[2],5),n),this.#ap=`url(#${m})`,this.#ap}destroy(a=!1){a&&(this.#am||this.#ap)||(this.#ai&&(this.#ai.parentNode.parentNode.remove(),this.#ai=null),this.#ah&&(this.#ah.clear(),this.#ah=null),this.#aq=0)}#aw(a){let b=this.#aj.createElementNS(g,"feColorMatrix");b.setAttribute("type","matrix"),b.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),a.append(b)}#at(a){let b=this.#aj.createElementNS(g,"filter");return b.setAttribute("color-interpolation-filters","sRGB"),b.setAttribute("id",a),this.#as.append(b),b}#ax(a,b,c){let d=this.#aj.createElementNS(g,b);d.setAttribute("type","discrete"),d.setAttribute("tableValues",c),a.append(d)}#au(a,b,c,d){let e=this.#aj.createElementNS(g,"feComponentTransfer");d.append(e),this.#ax(e,"feFuncR",a),this.#ax(e,"feFuncG",b),this.#ax(e,"feFuncB",c)}#av(a){return this.#as.style.color=a,z(getComputedStyle(this.#as).getPropertyValue("color"))}}class j extends e.BaseCanvasFactory{constructor({ownerDocument:a=globalThis.document}={}){super(),this._document=a}_createCanvas(a,b){let c=this._document.createElement("canvas");return c.width=a,c.height=b,c}}async function k(a,b="text"){if(v(a,document.baseURI)){let c=await fetch(a);if(!c.ok)throw Error(c.statusText);switch(b){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"json":return c.json()}return c.text()}return new Promise((c,d)=>{let e=new XMLHttpRequest;e.open("GET",a,!0),e.responseType=b,e.onreadystatechange=()=>{if(e.readyState===XMLHttpRequest.DONE){if(200===e.status||0===e.status){let a;switch(b){case"arraybuffer":case"blob":case"json":a=e.response;break;default:a=e.responseText}if(a)return void c(a)}d(Error(e.statusText))}},e.send(null)})}class l extends e.BaseCMapReaderFactory{_fetchData(a,b){return k(a,this.isCompressed?"arraybuffer":"text").then(a=>({cMapData:a instanceof ArrayBuffer?new Uint8Array(a):(0,f.stringToBytes)(a),compressionType:b}))}}class m extends e.BaseStandardFontDataFactory{_fetchData(a){return k(a,"arraybuffer").then(a=>new Uint8Array(a))}}class n extends e.BaseSVGFactory{_createSVG(a){return document.createElementNS(g,a)}}class o{constructor({viewBox:a,scale:b,rotation:c,offsetX:d=0,offsetY:e=0,dontFlip:f=!1}){let g,h,i,j,k,l,m,n;this.viewBox=a,this.scale=b,this.rotation=c,this.offsetX=d,this.offsetY=e;const o=(a[2]+a[0])/2,p=(a[3]+a[1])/2;switch((c%=360)<0&&(c+=360),c){case 180:g=-1,h=0,i=0,j=1;break;case 90:g=0,h=1,i=1,j=0;break;case 270:g=0,h=-1,i=-1,j=0;break;case 0:g=1,h=0,i=0,j=-1;break;default:throw Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}f&&(i=-i,j=-j),0===g?(k=Math.abs(p-a[1])*b+d,l=Math.abs(o-a[0])*b+e,m=(a[3]-a[1])*b,n=(a[2]-a[0])*b):(k=Math.abs(o-a[0])*b+d,l=Math.abs(p-a[1])*b+e,m=(a[2]-a[0])*b,n=(a[3]-a[1])*b),this.transform=[g*b,h*b,i*b,j*b,k-g*b*o-i*b*p,l-h*b*o-j*b*p],this.width=m,this.height=n}get rawDims(){let{viewBox:a}=this;return(0,f.shadow)(this,"rawDims",{pageWidth:a[2]-a[0],pageHeight:a[3]-a[1],pageX:a[0],pageY:a[1]})}clone({scale:a=this.scale,rotation:b=this.rotation,offsetX:c=this.offsetX,offsetY:d=this.offsetY,dontFlip:e=!1}={}){return new o({viewBox:this.viewBox.slice(),scale:a,rotation:b,offsetX:c,offsetY:d,dontFlip:e})}convertToViewportPoint(a,b){return f.Util.applyTransform([a,b],this.transform)}convertToViewportRectangle(a){let b=f.Util.applyTransform([a[0],a[1]],this.transform),c=f.Util.applyTransform([a[2],a[3]],this.transform);return[b[0],b[1],c[0],c[1]]}convertToPdfPoint(a,b){return f.Util.applyInverseTransform([a,b],this.transform)}}class p extends f.BaseException{constructor(a,b=0){super(a,"RenderingCancelledException"),this.extraDelay=b}}function q(a){let b=a.length,c=0;for(;c<b&&""===a[c].trim();)c++;return"data:"===a.substring(c,c+5).toLowerCase()}function r(a){return"string"==typeof a&&/\.pdf$/i.test(a)}function s(a,b=!1){return b||([a]=a.split(/[#?]/,1)),a.substring(a.lastIndexOf("/")+1)}function t(a,b="document.pdf"){if("string"!=typeof a)return b;if(q(a))return(0,f.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),b;let c=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,d=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/.exec(a),e=c.exec(d[1])||c.exec(d[2])||c.exec(d[3]);if(e&&(e=e[0]).includes("%"))try{e=c.exec(decodeURIComponent(e))[0]}catch{}return e||b}class u{started=Object.create(null);times=[];time(a){a in this.started&&(0,f.warn)(`Timer is already running for ${a}`),this.started[a]=Date.now()}timeEnd(a){a in this.started||(0,f.warn)(`Timer has not been started for ${a}`),this.times.push({name:a,start:this.started[a],end:Date.now()}),delete this.started[a]}toString(){let a=[],b=0;for(let{name:a}of this.times)b=Math.max(a.length,b);for(let{name:c,start:d,end:e}of this.times)a.push(`${c.padEnd(b)} ${e-d}ms
`);return a.join("")}}function v(a,b){try{let{protocol:c}=b?new URL(a,b):new URL(a);return"http:"===c||"https:"===c}catch{return!1}}function w(a){a.preventDefault()}class x{static toDateObject(a){if(!a||"string"!=typeof a)return null;let b=(d||=RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?")).exec(a);if(!b)return null;let c=parseInt(b[1],10),e=parseInt(b[2],10);e=e>=1&&e<=12?e-1:0;let f=parseInt(b[3],10);f=f>=1&&f<=31?f:1;let g=parseInt(b[4],10);g=g>=0&&g<=23?g:0;let h=parseInt(b[5],10);h=h>=0&&h<=59?h:0;let i=parseInt(b[6],10);i=i>=0&&i<=59?i:0;let j=b[7]||"Z",k=parseInt(b[8],10);k=k>=0&&k<=23?k:0;let l=parseInt(b[9],10)||0;return l=l>=0&&l<=59?l:0,"-"===j?(g+=k,h+=l):"+"===j&&(g-=k,h-=l),new Date(Date.UTC(c,e,f,g,h,i))}}function y(a,{scale:b=1,rotation:c=0}){let{width:d,height:e}=a.attributes.style,f=[0,0,parseInt(d),parseInt(e)];return new o({viewBox:f,scale:b,rotation:c})}function z(a){if(a.startsWith("#")){let b=parseInt(a.slice(1),16);return[(0xff0000&b)>>16,(65280&b)>>8,255&b]}return a.startsWith("rgb(")?a.slice(4,-1).split(",").map(a=>parseInt(a)):a.startsWith("rgba(")?a.slice(5,-1).split(",").map(a=>parseInt(a)).slice(0,3):((0,f.warn)(`Not a valid color format: "${a}"`),[0,0,0])}function A(a){let b=document.createElement("span");for(let c of(b.style.visibility="hidden",document.body.append(b),a.keys())){b.style.color=c;let d=window.getComputedStyle(b).color;a.set(c,z(d))}b.remove()}function B(a){let{a:b,b:c,c:d,d:e,e:f,f:g}=a.getTransform();return[b,c,d,e,f,g]}function C(a){let{a:b,b:c,c:d,d:e,e:f,f:g}=a.getTransform().invertSelf();return[b,c,d,e,f,g]}function D(a,b,c=!1,d=!0){if(b instanceof o){let{pageWidth:d,pageHeight:e}=b.rawDims,{style:g}=a,h=f.FeatureTest.isCSSRoundSupported,i=`var(--scale-factor) * ${d}px`,j=`var(--scale-factor) * ${e}px`,k=h?`round(${i}, 1px)`:`calc(${i})`,l=h?`round(${j}, 1px)`:`calc(${j})`;c&&b.rotation%180!=0?(g.width=l,g.height=k):(g.width=k,g.height=l)}d&&a.setAttribute("data-main-rotation",b.rotation)}},423:(a,b,c)=>{c.d(b,{DrawLayer:()=>f});var d=c(473),e=c(266);class f{#r=null;#aq=0;#ay=new Map;constructor({pageIndex:a}){this.pageIndex=a}setParent(a){if(!this.#r){this.#r=a;return}if(this.#r!==a){if(this.#ay.size>0)for(let b of this.#ay.values())b.remove(),a.append(b);this.#r=a}}static get _svgFactory(){return(0,e.shadow)(this,"_svgFactory",new d.DOMSVGFactory)}static #az(a,{x:b,y:c,width:d,height:e}){let{style:f}=a;f.top=`${100*c}%`,f.left=`${100*b}%`,f.width=`${100*d}%`,f.height=`${100*e}%`}#aA(a){let b=f._svgFactory.create(1,1,!0);return this.#r.append(b),f.#az(b,a),b}highlight({outlines:a,box:b},c,d){let e=this.#aq++,g=this.#aA(b);g.classList.add("highlight");let h=f._svgFactory.createElement("defs");g.append(h);let i=f._svgFactory.createElement("path");h.append(i);let j=`path_p${this.pageIndex}_${e}`;i.setAttribute("id",j),i.setAttribute("d",f.#aB(a));let k=f._svgFactory.createElement("clipPath");h.append(k);let l=`clip_${j}`;k.setAttribute("id",l),k.setAttribute("clipPathUnits","objectBoundingBox");let m=f._svgFactory.createElement("use");k.append(m),m.setAttribute("href",`#${j}`),m.classList.add("clip");let n=f._svgFactory.createElement("use");return g.append(n),g.setAttribute("fill",c),g.setAttribute("fill-opacity",d),n.setAttribute("href",`#${j}`),this.#ay.set(e,g),{id:e,clipPathId:`url(#${l})`}}highlightOutline({outlines:a,box:b}){let c=this.#aq++,d=this.#aA(b);d.classList.add("highlightOutline");let e=f._svgFactory.createElement("defs");d.append(e);let g=f._svgFactory.createElement("path");e.append(g);let h=`path_p${this.pageIndex}_${c}`;g.setAttribute("id",h),g.setAttribute("d",f.#aB(a)),g.setAttribute("vector-effect","non-scaling-stroke");let i=f._svgFactory.createElement("use");d.append(i),i.setAttribute("href",`#${h}`);let j=i.cloneNode();return d.append(j),i.classList.add("mainOutline"),j.classList.add("secondaryOutline"),this.#ay.set(c,d),c}static #aB(a){let b=[];for(let c of a){let[a,d]=c;b.push(`M${a} ${d}`);for(let e=2;e<c.length;e+=2){let f=c[e],g=c[e+1];f===a?(b.push(`V${g}`),d=g):g===d&&(b.push(`H${f}`),a=f)}b.push("Z")}return b.join(" ")}updateBox(a,b){f.#az(this.#ay.get(a),b)}rotate(a,b){this.#ay.get(a).setAttribute("data-main-rotation",b)}changeColor(a,b){this.#ay.get(a).setAttribute("fill",b)}changeOpacity(a,b){this.#ay.get(a).setAttribute("fill-opacity",b)}addClass(a,b){this.#ay.get(a).classList.add(b)}removeClass(a,b){this.#ay.get(a).classList.remove(b)}remove(a){null!==this.#r&&(this.#ay.get(a).remove(),this.#ay.delete(a))}destroy(){for(let a of(this.#r=null,this.#ay.values()))a.remove();this.#ay.clear()}}},629:(a,b,c)=>{c.d(b,{AnnotationEditorLayer:()=>o});var d=c(266),e=c(115),f=c(812),g=c(640);class h extends e.AnnotationEditor{#aC=this.editorDivBlur.bind(this);#aD=this.editorDivFocus.bind(this);#aE=this.editorDivInput.bind(this);#aF=this.editorDivKeydown.bind(this);#m;#aG="";#aH=`${this.id}-editor`;#aI;#aJ=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){let a=h.prototype,b=a=>a.isEmpty(),c=f.AnnotationEditorUIManager.TRANSLATE_SMALL,e=f.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,d.shadow)(this,"_keyboardManager",new f.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],a.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],a.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],a._translateEmpty,{args:[-c,0],checker:b}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],a._translateEmpty,{args:[-e,0],checker:b}],[["ArrowRight","mac+ArrowRight"],a._translateEmpty,{args:[c,0],checker:b}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],a._translateEmpty,{args:[e,0],checker:b}],[["ArrowUp","mac+ArrowUp"],a._translateEmpty,{args:[0,-c],checker:b}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],a._translateEmpty,{args:[0,-e],checker:b}],[["ArrowDown","mac+ArrowDown"],a._translateEmpty,{args:[0,c],checker:b}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],a._translateEmpty,{args:[0,e],checker:b}]]))}static _type="freetext";static _editorType=d.AnnotationEditorType.FREETEXT;constructor(a){super({...a,name:"freeTextEditor"}),this.#m=a.color||h._defaultColor||e.AnnotationEditor._defaultLineColor,this.#aI=a.fontSize||h._defaultFontSize}static initialize(a){e.AnnotationEditor.initialize(a,{strings:["pdfjs-free-text-default-content"]});let b=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(b.getPropertyValue("--freetext-padding"))}static updateDefaultParams(a,b){switch(a){case d.AnnotationEditorParamsType.FREETEXT_SIZE:h._defaultFontSize=b;break;case d.AnnotationEditorParamsType.FREETEXT_COLOR:h._defaultColor=b}}updateParams(a,b){switch(a){case d.AnnotationEditorParamsType.FREETEXT_SIZE:this.#aK(b);break;case d.AnnotationEditorParamsType.FREETEXT_COLOR:this.#aL(b)}}static get defaultPropertiesToUpdate(){return[[d.AnnotationEditorParamsType.FREETEXT_SIZE,h._defaultFontSize],[d.AnnotationEditorParamsType.FREETEXT_COLOR,h._defaultColor||e.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[d.AnnotationEditorParamsType.FREETEXT_SIZE,this.#aI],[d.AnnotationEditorParamsType.FREETEXT_COLOR,this.#m]]}#aK(a){let b=a=>{this.editorDiv.style.fontSize=`calc(${a}px * var(--scale-factor))`,this.translate(0,-(a-this.#aI)*this.parentScale),this.#aI=a,this.#aM()},c=this.#aI;this.addCommands({cmd:()=>{b(a)},undo:()=>{b(c)},mustExec:!0,type:d.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}#aL(a){let b=this.#m;this.addCommands({cmd:()=>{this.#m=this.editorDiv.style.color=a},undo:()=>{this.#m=this.editorDiv.style.color=b},mustExec:!0,type:d.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(a,b){this._uiManager.translateSelectedEditors(a,b,!0)}getInitialTranslation(){let a=this.parentScale;return[-h._internalPadding*a,-(h._internalPadding+this.#aI)*a]}rebuild(){!this.parent||(super.rebuild(),null!==this.div&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(d.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",this.#aF),this.editorDiv.addEventListener("focus",this.#aD),this.editorDiv.addEventListener("blur",this.#aC),this.editorDiv.addEventListener("input",this.#aE))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#aH),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",this.#aF),this.editorDiv.removeEventListener("focus",this.#aD),this.editorDiv.removeEventListener("blur",this.#aC),this.editorDiv.removeEventListener("input",this.#aE),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(a){this._focusEventsAllowed&&(super.focusin(a),a.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){this.width?this.#aN():(this.enableEditMode(),this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||""===this.editorDiv.innerText.trim()}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#aO(){let a=this.editorDiv.getElementsByTagName("div");if(0===a.length)return this.editorDiv.innerText;let b=[];for(let c of a)b.push(c.innerText.replace(/\r\n?|\n/,""));return b.join("\n")}#aM(){let a,[b,c]=this.parentDimensions;if(this.isAttachedToDOM)a=this.div.getBoundingClientRect();else{let{currentLayer:b,div:c}=this,d=c.style.display;c.style.display="hidden",b.div.append(this.div),a=c.getBoundingClientRect(),c.remove(),c.style.display=d}this.rotation%180==this.parentRotation%180?(this.width=a.width/b,this.height=a.height/c):(this.width=a.height/b,this.height=a.width/c),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();let a=this.#aG,b=this.#aG=this.#aO().trimEnd();if(a===b)return;let c=a=>{(this.#aG=a,a)?(this.#aP(),this._uiManager.rebuild(this),this.#aM()):this.remove()};this.addCommands({cmd:()=>{c(b)},undo:()=>{c(a)},mustExec:!1}),this.#aM()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(a){this.enterInEditMode()}keydown(a){a.target===this.div&&"Enter"===a.key&&(this.enterInEditMode(),a.preventDefault())}editorDivKeydown(a){h._keyboardManager.exec(this,a)}editorDivFocus(a){this.isEditing=!0}editorDivBlur(a){this.isEditing=!1}editorDivInput(a){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){let a,b;if(this.div)return this.div;this.width&&(a=this.x,b=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#aH),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text"),this.enableEditing(),e.AnnotationEditor._l10nPromise.get("pdfjs-free-text-default-content").then(a=>this.editorDiv?.setAttribute("default-content",a)),this.editorDiv.contentEditable=!0;let{style:c}=this.editorDiv;if(c.fontSize=`calc(${this.#aI}px * var(--scale-factor))`,c.color=this.#m,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,f.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){let[c,d]=this.parentDimensions;if(this.annotationElementId){let e,f,{position:g}=this.#aJ,[h,i]=this.getInitialTranslation();[h,i]=this.pageTranslationToScreen(h,i);let[j,k]=this.pageDimensions,[l,m]=this.pageTranslation;switch(this.rotation){case 0:e=a+(g[0]-l)/j,f=b+this.height-(g[1]-m)/k;break;case 90:e=a+(g[0]-l)/j,f=b-(g[1]-m)/k,[h,i]=[i,-h];break;case 180:e=a-this.width+(g[0]-l)/j,f=b-(g[1]-m)/k,[h,i]=[-h,-i];break;case 270:e=a+(g[0]-l-this.height*k)/j,f=b+(g[1]-m-this.width*j)/k,[h,i]=[-i,h]}this.setAt(e*c,f*d,h,i)}else this.setAt(a*c,b*d,this.width*c,this.height*d);this.#aP(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}#aP(){if(this.editorDiv.replaceChildren(),this.#aG)for(let a of this.#aG.split("\n")){let b=document.createElement("div");b.append(a?document.createTextNode(a):document.createElement("br")),this.editorDiv.append(b)}}get contentDiv(){return this.editorDiv}static deserialize(a,b,c){let e=null;if(a instanceof g.FreeTextAnnotationElement){let{data:{defaultAppearanceData:{fontSize:b,fontColor:c},rect:f,rotation:g,id:h},textContent:i,textPosition:j,parent:{page:{pageNumber:k}}}=a;if(!i||0===i.length)return null;e=a={annotationType:d.AnnotationEditorType.FREETEXT,color:Array.from(c),fontSize:b,value:i.join("\n"),position:j,pageIndex:k-1,rect:f,rotation:g,id:h,deleted:!1}}let f=super.deserialize(a,b,c);return f.#aI=a.fontSize,f.#m=d.Util.makeHexColor(...a.color),f.#aG=a.value,f.annotationElementId=a.id||null,f.#aJ=e,f}serialize(a=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};let b=h._internalPadding*this.parentScale,c=this.getRect(b,b),f=e.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.#m),g={annotationType:d.AnnotationEditorType.FREETEXT,color:f,fontSize:this.#aI,value:this.#aG,pageIndex:this.pageIndex,rect:c,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return a?g:this.annotationElementId&&!this.#aQ(g)?null:(g.id=this.annotationElementId,g)}#aQ(a){let{value:b,fontSize:c,color:d,rect:e,pageIndex:f}=this.#aJ;return a.value!==b||a.fontSize!==c||a.rect.some((a,b)=>Math.abs(a-e[b])>=1)||a.color.some((a,b)=>a!==d[b])||a.pageIndex!==f}#aN(a=!1){if(!this.annotationElementId)return;if(this.#aM(),!a&&(0===this.width||0===this.height))return void setTimeout(()=>this.#aN(!0),0);let b=h._internalPadding*this.parentScale;this.#aJ.rect=this.getRect(b,b)}}var i=c(97),j=c(405);class k extends e.AnnotationEditor{#aR;#aS=null;#aT=null;#aU=null;#aV=null;#aW=null;#aq=null;#aX=null;#aY;#aZ=null;static _defaultColor=null;static _defaultOpacity=1;static _l10nPromise;static _type="highlight";static _editorType=d.AnnotationEditorType.HIGHLIGHT;constructor(a){super({...a,name:"highlightEditor"}),k._defaultColor||=this._uiManager.highlightColors?.values().next().value||"#fff066",this.color=a.color||k._defaultColor,this.#aY=a.opacity||k._defaultOpacity,this.#aR=a.boxes||null,this._isDraggable=!1,this.#a$(),this.#a_(),this.rotate(this.rotation)}#a$(){let a=new j.Outliner(this.#aR,.001);this.#aW=a.getOutlines(),{x:this.x,y:this.y,width:this.width,height:this.height}=this.#aW.box;let b=new j.Outliner(this.#aR,.0025,.001,"ltr"===this._uiManager.direction);this.#aU=b.getOutlines();let{lastPoint:c}=this.#aU.box;this.#aX=[(c[0]-this.x)/this.width,(c[1]-this.y)/this.height]}static initialize(a){e.AnnotationEditor.initialize(a)}static updateDefaultParams(a,b){a===d.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR&&(k._defaultColor=b)}get toolbarPosition(){return this.#aX}updateParams(a,b){a===d.AnnotationEditorParamsType.HIGHLIGHT_COLOR&&this.#aL(b)}static get defaultPropertiesToUpdate(){return[[d.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR,k._defaultColor]]}get propertiesToUpdate(){return[[d.AnnotationEditorParamsType.HIGHLIGHT_COLOR,this.color||k._defaultColor]]}#aL(a){let b=this.color;this.addCommands({cmd:()=>{this.color=a,this.parent.drawLayer.changeColor(this.#aq,a),this.#aT?.updateColor(a)},undo:()=>{this.color=b,this.parent.drawLayer.changeColor(this.#aq,b),this.#aT?.updateColor(b)},mustExec:!0,type:d.AnnotationEditorParamsType.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}async addEditToolbar(){let a=await super.addEditToolbar();return a?(this._uiManager.highlightColors&&(this.#aT=new i.ColorPicker({editor:this}),a.addColorPicker(this.#aT)),a):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(0)}getRect(a,b){return super.getRect(a,b,0)}onceAdded(){this.parent.addUndoableEditor(this),this.div.focus()}remove(){super.remove(),this.#a0()}rebuild(){!this.parent||(super.rebuild(),null!==this.div&&(this.#a_(),this.isAttachedToDOM||this.parent.add(this)))}setParent(a){let b=!1;this.parent&&!a?this.#a0():a&&(this.#a_(a),b=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(a),b&&this.select()}#a0(){null!==this.#aq&&this.parent&&(this.parent.drawLayer.remove(this.#aq),this.#aq=null,this.parent.drawLayer.remove(this.#aZ),this.#aZ=null)}#a_(a=this.parent){null===this.#aq&&({id:this.#aq,clipPathId:this.#aS}=a.drawLayer.highlight(this.#aW,this.color,this.#aY),this.#aV&&(this.#aV.style.clipPath=this.#aS),this.#aZ=a.drawLayer.highlightOutline(this.#aU))}static #a1({x:a,y:b,width:c,height:d},e){switch(e){case 90:return{x:1-b-d,y:a,width:d,height:c};case 180:return{x:1-a-c,y:1-b-d,width:c,height:d};case 270:return{x:b,y:1-a-c,width:d,height:c}}return{x:a,y:b,width:c,height:d}}rotate(a){let{drawLayer:b}=this.parent;b.rotate(this.#aq,a),b.rotate(this.#aZ,a),b.updateBox(this.#aq,k.#a1(this,a)),b.updateBox(this.#aZ,k.#a1(this.#aU.box,a))}render(){if(this.div)return this.div;let a=super.render(),b=this.#aV=document.createElement("div");a.append(b),b.className="internal",b.style.clipPath=this.#aS;let[c,d]=this.parentDimensions;return this.setDims(this.width*c,this.height*d),(0,f.bindEvents)(this,this.#aV,["pointerover","pointerleave"]),this.enableEditing(),a}pointerover(){this.parent.drawLayer.addClass(this.#aZ,"hovered")}pointerleave(){this.parent.drawLayer.removeClass(this.#aZ,"hovered")}select(){super.select(),this.parent?.drawLayer.removeClass(this.#aZ,"hovered"),this.parent?.drawLayer.addClass(this.#aZ,"selected")}unselect(){super.unselect(),this.parent?.drawLayer.removeClass(this.#aZ,"selected")}#a2(){let[a,b]=this.pageDimensions,c=this.#aR,d=Array(8*c.length),e=0;for(let{x:f,y:g,width:h,height:i}of c){let c=f*a,j=(1-g-i)*b;d[e]=d[e+4]=c,d[e+1]=d[e+3]=j,d[e+2]=d[e+6]=c+h*a,d[e+5]=d[e+7]=j+i*b,e+=8}return d}#a3(){let[a,b]=this.pageDimensions,c=this.width*a,d=this.height*b,e=this.x*a,f=(1-this.y-this.height)*b,g=[];for(let a of this.#aW.outlines){let b=Array(a.length);for(let g=0;g<a.length;g+=2)b[g]=e+a[g]*c,b[g+1]=f+(1-a[g+1])*d;g.push(b)}return g}static deserialize(a,b,c){let e=super.deserialize(a,b,c),{rect:f,color:g,quadPoints:h}=a;e.color=d.Util.makeHexColor(...g),e.#aY=a.opacity;let[i,j]=e.pageDimensions;e.width=(f[2]-f[0])/i,e.height=(f[3]-f[1])/j;let k=e.#aR=[];for(let a=0;a<h.length;a+=8)k.push({x:h[4]/i,y:1-h[a+5]/j,width:(h[a+2]-h[a])/i,height:(h[a+5]-h[a+1])/j});return e.#a$(),e}serialize(a=!1){if(this.isEmpty()||a)return null;let b=this.getRect(0,0),c=e.AnnotationEditor._colorManager.convert(this.color);return{annotationType:d.AnnotationEditorType.HIGHLIGHT,color:c,opacity:this.#aY,quadPoints:this.#a2(),outlines:this.#a3(),pageIndex:this.pageIndex,rect:b,rotation:0,structTreeParentId:this._structTreeParentId}}static canCreateNewEmptyEditor(){return!1}}var l=c(473);class m extends e.AnnotationEditor{#a4=0;#a5=0;#a6=this.canvasPointermove.bind(this);#a7=this.canvasPointerleave.bind(this);#a8=this.canvasPointerup.bind(this);#a9=this.canvasPointerdown.bind(this);#ba=null;#bb=new Path2D;#bc=!1;#bd=!1;#be=!1;#bf=null;#bg=0;#bh=0;#bi=null;static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=1;static _type="ink";static _editorType=d.AnnotationEditorType.INK;constructor(a){super({...a,name:"inkEditor"}),this.color=a.color||null,this.thickness=a.thickness||null,this.opacity=a.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(a){e.AnnotationEditor.initialize(a)}static updateDefaultParams(a,b){switch(a){case d.AnnotationEditorParamsType.INK_THICKNESS:m._defaultThickness=b;break;case d.AnnotationEditorParamsType.INK_COLOR:m._defaultColor=b;break;case d.AnnotationEditorParamsType.INK_OPACITY:m._defaultOpacity=b/100}}updateParams(a,b){switch(a){case d.AnnotationEditorParamsType.INK_THICKNESS:this.#bj(b);break;case d.AnnotationEditorParamsType.INK_COLOR:this.#aL(b);break;case d.AnnotationEditorParamsType.INK_OPACITY:this.#bk(b)}}static get defaultPropertiesToUpdate(){return[[d.AnnotationEditorParamsType.INK_THICKNESS,m._defaultThickness],[d.AnnotationEditorParamsType.INK_COLOR,m._defaultColor||e.AnnotationEditor._defaultLineColor],[d.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*m._defaultOpacity)]]}get propertiesToUpdate(){return[[d.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||m._defaultThickness],[d.AnnotationEditorParamsType.INK_COLOR,this.color||m._defaultColor||e.AnnotationEditor._defaultLineColor],[d.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??m._defaultOpacity))]]}#bj(a){let b=this.thickness;this.addCommands({cmd:()=>{this.thickness=a,this.#bl()},undo:()=>{this.thickness=b,this.#bl()},mustExec:!0,type:d.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})}#aL(a){let b=this.color;this.addCommands({cmd:()=>{this.color=a,this.#bm()},undo:()=>{this.color=b,this.#bm()},mustExec:!0,type:d.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})}#bk(a){a/=100;let b=this.opacity;this.addCommands({cmd:()=>{this.opacity=a,this.#bm()},undo:()=>{this.opacity=b,this.#bm()},mustExec:!0,type:d.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})}rebuild(){this.parent&&(super.rebuild(),null!==this.div&&(this.canvas||(this.#bn(),this.#bo()),this.isAttachedToDOM||(this.parent.add(this),this.#bp()),this.#bl()))}remove(){null!==this.canvas&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,this.#ba&&(clearTimeout(this.#ba),this.#ba=null),this.#bf.disconnect(),this.#bf=null,super.remove())}setParent(a){!this.parent&&a?this._uiManager.removeShouldRescale(this):this.parent&&null===a&&this._uiManager.addShouldRescale(this),super.setParent(a)}onScaleChanging(){let[a,b]=this.parentDimensions,c=this.width*a,d=this.height*b;this.setDimensions(c,d)}enableEditMode(){this.#bc||null===this.canvas||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",this.#a9))}disableEditMode(){this.isInEditMode()&&null!==this.canvas&&(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",this.#a9))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return 0===this.paths.length||1===this.paths.length&&0===this.paths[0].length}#bq(){let{parentRotation:a,parentDimensions:[b,c]}=this;switch(a){case 90:return[0,c,c,b];case 180:return[b,c,b,c];case 270:return[b,0,c,b];default:return[0,0,b,c]}}#br(){let{ctx:a,color:b,opacity:c,thickness:d,parentScale:e,scaleFactor:g}=this;a.lineWidth=d*e/g,a.lineCap="round",a.lineJoin="round",a.miterLimit=10,a.strokeStyle=`${b}${(0,f.opacityToHex)(c)}`}#bs(a,b){this.canvas.addEventListener("contextmenu",l.noContextMenu),this.canvas.addEventListener("pointerleave",this.#a7),this.canvas.addEventListener("pointermove",this.#a6),this.canvas.addEventListener("pointerup",this.#a8),this.canvas.removeEventListener("pointerdown",this.#a9),this.isEditing=!0,this.#be||(this.#be=!0,this.#bp(),this.thickness||=m._defaultThickness,this.color||=m._defaultColor||e.AnnotationEditor._defaultLineColor,this.opacity??=m._defaultOpacity),this.currentPath.push([a,b]),this.#bd=!1,this.#br(),this.#bi=()=>{this.#bt(),this.#bi&&window.requestAnimationFrame(this.#bi)},window.requestAnimationFrame(this.#bi)}#bu(a,b){let[c,d]=this.currentPath.at(-1);if(this.currentPath.length>1&&a===c&&b===d)return;let e=this.currentPath,f=this.#bb;if(e.push([a,b]),this.#bd=!0,e.length<=2){f.moveTo(...e[0]),f.lineTo(a,b);return}3===e.length&&(this.#bb=f=new Path2D,f.moveTo(...e[0])),this.#bv(f,...e.at(-3),...e.at(-2),a,b)}#bw(){if(0===this.currentPath.length)return;let a=this.currentPath.at(-1);this.#bb.lineTo(...a)}#bx(a,b){let c;if(this.#bi=null,a=Math.min(Math.max(a,0),this.canvas.width),b=Math.min(Math.max(b,0),this.canvas.height),this.#bu(a,b),this.#bw(),1!==this.currentPath.length)c=this.#by();else{let d=[a,b];c=[[d,d.slice(),d.slice(),d]]}let d=this.#bb,e=this.currentPath;this.currentPath=[],this.#bb=new Path2D;let f=()=>{this.allRawPaths.push(e),this.paths.push(c),this.bezierPath2D.push(d),this.rebuild()},g=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),0===this.paths.length?this.remove():(this.canvas||(this.#bn(),this.#bo()),this.#bl())};this.addCommands({cmd:f,undo:g,mustExec:!0})}#bt(){if(!this.#bd)return;this.#bd=!1,this.thickness,this.parentScale;let a=this.currentPath.slice(-3);a.map(a=>a[0]),a.map(a=>a[1]);let{ctx:b}=this;for(let a of(b.save(),b.clearRect(0,0,this.canvas.width,this.canvas.height),this.bezierPath2D))b.stroke(a);b.stroke(this.#bb),b.restore()}#bv(a,b,c,d,e,f,g){let h=(b+d)/2,i=(c+e)/2,j=(d+f)/2,k=(e+g)/2;a.bezierCurveTo(h+2*(d-h)/3,i+2*(e-i)/3,j+2*(d-j)/3,k+2*(e-k)/3,j,k)}#by(){let a,b=this.currentPath;if(b.length<=2)return[[b[0],b[0],b.at(-1),b.at(-1)]];let c=[],[d,e]=b[0];for(a=1;a<b.length-2;a++){let[f,g]=b[a],[h,i]=b[a+1],j=(f+h)/2,k=(g+i)/2,l=[d+2*(f-d)/3,e+2*(g-e)/3],m=[j+2*(f-j)/3,k+2*(g-k)/3];c.push([[d,e],l,m,[j,k]]),[d,e]=[j,k]}let[f,g]=b[a],[h,i]=b[a+1],j=[d+2*(f-d)/3,e+2*(g-e)/3];return c.push([[d,e],j,[h+2*(f-h)/3,i+2*(g-i)/3],[h,i]]),c}#bm(){if(this.isEmpty())return void this.#bz();this.#br();let{canvas:a,ctx:b}=this;for(let c of(b.setTransform(1,0,0,1,0,0),b.clearRect(0,0,a.width,a.height),this.#bz(),this.bezierPath2D))b.stroke(c)}commit(){this.#bc||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),this.#bc=!0,this.div.classList.add("disabled"),this.#bl(!0),this.select(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(a){this._focusEventsAllowed&&(super.focusin(a),this.enableEditMode())}canvasPointerdown(a){0===a.button&&this.isInEditMode()&&!this.#bc&&(this.setInForeground(),a.preventDefault(),this.div.contains(document.activeElement)||this.div.focus({preventScroll:!0}),this.#bs(a.offsetX,a.offsetY))}canvasPointermove(a){a.preventDefault(),this.#bu(a.offsetX,a.offsetY)}canvasPointerup(a){a.preventDefault(),this.#bA(a)}canvasPointerleave(a){this.#bA(a)}#bA(a){this.canvas.removeEventListener("pointerleave",this.#a7),this.canvas.removeEventListener("pointermove",this.#a6),this.canvas.removeEventListener("pointerup",this.#a8),this.canvas.addEventListener("pointerdown",this.#a9),this.#ba&&clearTimeout(this.#ba),this.#ba=setTimeout(()=>{this.#ba=null,this.canvas.removeEventListener("contextmenu",l.noContextMenu)},10),this.#bx(a.offsetX,a.offsetY),this.addToAnnotationStorage(),this.setInBackground()}#bn(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",this.canvas.setAttribute("data-l10n-id","pdfjs-ink-canvas"),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")}#bo(){this.#bf=new ResizeObserver(a=>{let b=a[0].contentRect;b.width&&b.height&&this.setDimensions(b.width,b.height)}),this.#bf.observe(this.div)}get isResizable(){return!this.isEmpty()&&this.#bc}render(){let a,b;if(this.div)return this.div;this.width&&(a=this.x,b=this.y),super.render(),this.div.setAttribute("data-l10n-id","pdfjs-ink");let[c,d,e,f]=this.#bq();if(this.setAt(c,d,0,0),this.setDims(e,f),this.#bn(),this.width){let[c,d]=this.parentDimensions;this.setAspectRatio(this.width*c,this.height*d),this.setAt(a*c,b*d,this.width*c,this.height*d),this.#be=!0,this.#bp(),this.setDims(this.width*c,this.height*d),this.#bm(),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return this.#bo(),this.div}#bp(){if(!this.#be)return;let[a,b]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*a),this.canvas.height=Math.ceil(this.height*b),this.#bz()}setDimensions(a,b){let c=Math.round(a),d=Math.round(b);if(this.#bg===c&&this.#bh===d)return;this.#bg=c,this.#bh=d,this.canvas.style.visibility="hidden";let[e,f]=this.parentDimensions;this.width=a/e,this.height=b/f,this.fixAndSetPosition(),this.#bc&&this.#bB(a,b),this.#bp(),this.#bm(),this.canvas.style.visibility="visible",this.fixDims()}#bB(a,b){let c=this.#bC(),d=(a-c)/this.#a5,e=(b-c)/this.#a4;this.scaleFactor=Math.min(d,e)}#bz(){let a=this.#bC()/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+a,this.translationY*this.scaleFactor+a)}static #bD(a){let b=new Path2D;for(let c=0,d=a.length;c<d;c++){let[d,e,f,g]=a[c];0===c&&b.moveTo(...d),b.bezierCurveTo(e[0],e[1],f[0],f[1],g[0],g[1])}return b}static #bE(a,b,c){let[d,e,f,g]=b;switch(c){case 0:for(let b=0,c=a.length;b<c;b+=2)a[b]+=d,a[b+1]=g-a[b+1];break;case 90:for(let b=0,c=a.length;b<c;b+=2){let c=a[b];a[b]=a[b+1]+d,a[b+1]=c+e}break;case 180:for(let b=0,c=a.length;b<c;b+=2)a[b]=f-a[b],a[b+1]+=e;break;case 270:for(let b=0,c=a.length;b<c;b+=2){let c=a[b];a[b]=f-a[b+1],a[b+1]=g-c}break;default:throw Error("Invalid rotation")}return a}static #bF(a,b,c){let[d,e,f,g]=b;switch(c){case 0:for(let b=0,c=a.length;b<c;b+=2)a[b]-=d,a[b+1]=g-a[b+1];break;case 90:for(let b=0,c=a.length;b<c;b+=2){let c=a[b];a[b]=a[b+1]-e,a[b+1]=c-d}break;case 180:for(let b=0,c=a.length;b<c;b+=2)a[b]=f-a[b],a[b+1]-=e;break;case 270:for(let b=0,c=a.length;b<c;b+=2){let c=a[b];a[b]=g-a[b+1],a[b+1]=f-c}break;default:throw Error("Invalid rotation")}return a}#bG(a,b,c,d){let e=[],f=this.thickness/2,g=a*b+f,h=a*c+f;for(let b of this.paths){let c=[],f=[];for(let d=0,e=b.length;d<e;d++){let[i,j,k,l]=b[d],m=a*i[0]+g,n=a*i[1]+h,o=a*j[0]+g,p=a*j[1]+h,q=a*k[0]+g,r=a*k[1]+h,s=a*l[0]+g,t=a*l[1]+h;0===d&&(c.push(m,n),f.push(m,n)),c.push(o,p,q,r,s,t),f.push(o,p),d===e-1&&f.push(s,t)}e.push({bezier:m.#bE(c,d,this.rotation),points:m.#bE(f,d,this.rotation)})}return e}#bH(){let a=1/0,b=-1/0,c=1/0,e=-1/0;for(let f of this.paths)for(let[g,h,i,j]of f){let f=d.Util.bezierBoundingBox(...g,...h,...i,...j);a=Math.min(a,f[0]),c=Math.min(c,f[1]),b=Math.max(b,f[2]),e=Math.max(e,f[3])}return[a,c,b,e]}#bC(){return this.#bc?Math.ceil(this.thickness*this.parentScale):0}#bl(a=!1){if(this.isEmpty())return;if(!this.#bc)return void this.#bm();let b=this.#bH(),c=this.#bC();this.#a5=Math.max(e.AnnotationEditor.MIN_SIZE,b[2]-b[0]),this.#a4=Math.max(e.AnnotationEditor.MIN_SIZE,b[3]-b[1]);let d=Math.ceil(c+this.#a5*this.scaleFactor),f=Math.ceil(c+this.#a4*this.scaleFactor),[g,h]=this.parentDimensions;this.width=d/g,this.height=f/h,this.setAspectRatio(d,f);let i=this.translationX,j=this.translationY;this.translationX=-b[0],this.translationY=-b[1],this.#bp(),this.#bm(),this.#bg=d,this.#bh=f,this.setDims(d,f);let k=a?c/this.scaleFactor/2:0;this.translate(i-this.translationX-k,j-this.translationY-k)}static deserialize(a,b,c){if(a instanceof g.InkAnnotationElement)return null;let f=super.deserialize(a,b,c);f.thickness=a.thickness,f.color=d.Util.makeHexColor(...a.color),f.opacity=a.opacity;let[h,i]=f.pageDimensions,j=f.width*h,k=f.height*i,l=f.parentScale,n=a.thickness/2;f.#bc=!0,f.#bg=Math.round(j),f.#bh=Math.round(k);let{paths:o,rect:p,rotation:q}=a;for(let{bezier:a}of o){a=m.#bF(a,p,q);let b=[];f.paths.push(b);let c=l*(a[0]-n),d=l*(a[1]-n);for(let e=2,f=a.length;e<f;e+=6){let f=l*(a[e]-n),g=l*(a[e+1]-n),h=l*(a[e+2]-n),i=l*(a[e+3]-n),j=l*(a[e+4]-n),k=l*(a[e+5]-n);b.push([[c,d],[f,g],[h,i],[j,k]]),c=j,d=k}let e=this.#bD(b);f.bezierPath2D.push(e)}let r=f.#bH();return f.#a5=Math.max(e.AnnotationEditor.MIN_SIZE,r[2]-r[0]),f.#a4=Math.max(e.AnnotationEditor.MIN_SIZE,r[3]-r[1]),f.#bB(j,k),f}serialize(){if(this.isEmpty())return null;let a=this.getRect(0,0),b=e.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:d.AnnotationEditorType.INK,color:b,thickness:this.thickness,opacity:this.opacity,paths:this.#bG(this.scaleFactor/this.parentScale,this.translationX,this.translationY,a),pageIndex:this.pageIndex,rect:a,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}}class n extends e.AnnotationEditor{#bI=null;#bJ=null;#bK=null;#bL=null;#bM=null;#bN="";#bO=null;#bf=null;#bP=null;#bQ=!1;#bR=!1;static _type="stamp";static _editorType=d.AnnotationEditorType.STAMP;constructor(a){super({...a,name:"stampEditor"}),this.#bL=a.bitmapUrl,this.#bM=a.bitmapFile}static initialize(a){e.AnnotationEditor.initialize(a)}static get supportedTypes(){return(0,d.shadow)(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(a=>`image/${a}`))}static get supportedTypesStr(){return(0,d.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(a){return this.supportedTypes.includes(a)}static paste(a,b){b.pasteEditor(d.AnnotationEditorType.STAMP,{bitmapFile:a.getAsFile()})}#bS(a,b=!1){a?(this.#bI=a.bitmap,b||(this.#bJ=a.id,this.#bQ=a.isSvg),a.file&&(this.#bN=a.file.name),this.#bn()):this.remove()}#bT(){this.#bK=null,this._uiManager.enableWaiting(!1),this.#bO&&this.div.focus()}#bU(){if(this.#bJ){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#bJ).then(a=>this.#bS(a,!0)).finally(()=>this.#bT());return}if(this.#bL){let a=this.#bL;this.#bL=null,this._uiManager.enableWaiting(!0),this.#bK=this._uiManager.imageManager.getFromUrl(a).then(a=>this.#bS(a)).finally(()=>this.#bT());return}if(this.#bM){let a=this.#bM;this.#bM=null,this._uiManager.enableWaiting(!0),this.#bK=this._uiManager.imageManager.getFromFile(a).then(a=>this.#bS(a)).finally(()=>this.#bT());return}let a=document.createElement("input");a.type="file",a.accept=n.supportedTypesStr,this.#bK=new Promise(b=>{a.addEventListener("change",async()=>{if(a.files&&0!==a.files.length){this._uiManager.enableWaiting(!0);let b=await this._uiManager.imageManager.getFromFile(a.files[0]);this.#bS(b)}else this.remove();b()}),a.addEventListener("cancel",()=>{this.remove(),b()})}).finally(()=>this.#bT()),a.click()}remove(){this.#bJ&&(this.#bI=null,this._uiManager.imageManager.deleteId(this.#bJ),this.#bO?.remove(),this.#bO=null,this.#bf?.disconnect(),this.#bf=null,this.#bP&&(clearTimeout(this.#bP),this.#bP=null)),super.remove()}rebuild(){if(!this.parent){this.#bJ&&this.#bU();return}super.rebuild(),null!==this.div&&(this.#bJ&&this.#bU(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(this.#bK||this.#bI||this.#bL||this.#bM)}get isResizable(){return!0}render(){let a,b;if(this.div)return this.div;if(this.width&&(a=this.x,b=this.y),super.render(),this.div.hidden=!0,this.#bI?this.#bn():this.#bU(),this.width){let[c,d]=this.parentDimensions;this.setAt(a*c,b*d,this.width*c,this.height*d)}return this.div}#bn(){let{div:a}=this,{width:b,height:c}=this.#bI,[d,e]=this.pageDimensions;if(this.width)b=this.width*d,c=this.height*e;else if(b>.75*d||c>.75*e){let a=Math.min(.75*d/b,.75*e/c);b*=a,c*=a}let[f,g]=this.parentDimensions;this.setDims(b*f/d,c*g/e),this._uiManager.enableWaiting(!1);let h=this.#bO=document.createElement("canvas");a.append(h),a.hidden=!1,this.#bV(b,c),this.#bo(),this.#bR||(this.parent.addUndoableEditor(this),this.#bR=!0),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton(),this.#bN&&h.setAttribute("aria-label",this.#bN)}#bW(a,b){let[c,d]=this.parentDimensions;this.width=a/c,this.height=b/d,this.setDims(a,b),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,null!==this.#bP&&clearTimeout(this.#bP),this.#bP=setTimeout(()=>{this.#bP=null,this.#bV(a,b)},200)}#bX(a,b){let{width:c,height:d}=this.#bI,e=c,f=d,g=this.#bI;for(;e>2*a||f>2*b;){let c=e,d=f;e>2*a&&(e=e>=16384?Math.floor(e/2)-1:Math.ceil(e/2)),f>2*b&&(f=f>=16384?Math.floor(f/2)-1:Math.ceil(f/2));let h=new OffscreenCanvas(e,f);h.getContext("2d").drawImage(g,0,0,c,d,0,0,e,f),g=h.transferToImageBitmap()}return g}#bV(a,b){a=Math.ceil(a),b=Math.ceil(b);let c=this.#bO;if(!c||c.width===a&&c.height===b)return;c.width=a,c.height=b;let d=this.#bQ?this.#bI:this.#bX(a,b),e=c.getContext("2d");e.filter=this._uiManager.hcmFilter,e.drawImage(d,0,0,d.width,d.height,0,0,a,b)}getImageForAltText(){return this.#bO}#bY(a){if(a){if(this.#bQ){let a=this._uiManager.imageManager.getSvgUrl(this.#bJ);if(a)return a}let a=document.createElement("canvas");return{width:a.width,height:a.height}=this.#bI,a.getContext("2d").drawImage(this.#bI,0,0),a.toDataURL()}if(this.#bQ){let[a,b]=this.pageDimensions,c=Math.round(this.width*a*l.PixelsPerInch.PDF_TO_CSS_UNITS),d=Math.round(this.height*b*l.PixelsPerInch.PDF_TO_CSS_UNITS),e=new OffscreenCanvas(c,d);return e.getContext("2d").drawImage(this.#bI,0,0,this.#bI.width,this.#bI.height,0,0,c,d),e.transferToImageBitmap()}return structuredClone(this.#bI)}#bo(){this.#bf=new ResizeObserver(a=>{let b=a[0].contentRect;b.width&&b.height&&this.#bW(b.width,b.height)}),this.#bf.observe(this.div)}static deserialize(a,b,c){if(a instanceof g.StampAnnotationElement)return null;let d=super.deserialize(a,b,c),{rect:e,bitmapUrl:f,bitmapId:h,isSvg:i,accessibilityData:j}=a;h&&c.imageManager.isValidId(h)?d.#bJ=h:d.#bL=f,d.#bQ=i;let[k,l]=d.pageDimensions;return d.width=(e[2]-e[0])/k,d.height=(e[3]-e[1])/l,j&&(d.altTextData=j),d}serialize(a=!1,b=null){if(this.isEmpty())return null;let c={annotationType:d.AnnotationEditorType.STAMP,bitmapId:this.#bJ,pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:this.#bQ,structTreeParentId:this._structTreeParentId};if(a)return c.bitmapUrl=this.#bY(!0),c.accessibilityData=this.altTextData,c;let{decorative:e,altText:f}=this.altTextData;if(!e&&f&&(c.accessibilityData={type:"Figure",alt:f}),null===b)return c;b.stamps||=new Map;let g=this.#bQ?(c.rect[2]-c.rect[0])*(c.rect[3]-c.rect[1]):null;if(b.stamps.has(this.#bJ)){if(this.#bQ){let a=b.stamps.get(this.#bJ);g>a.area&&(a.area=g,a.serialized.bitmap.close(),a.serialized.bitmap=this.#bY(!1))}}else b.stamps.set(this.#bJ,{area:g,serialized:c}),c.bitmap=this.#bY(!1);return c}}class o{#G;#bZ=!1;#b$=null;#b_=this.pointerup.bind(this);#b0=this.pointerUpAfterSelection.bind(this);#b1=this.pointerdown.bind(this);#b2=null;#b3=this.selectionStart.bind(this);#b4=new Map;#b5=!1;#b6=!1;#b7=!1;#b8=null;#b9;static _initialized=!1;static #ca=new Map([h,m,n,k].map(a=>[a._editorType,a]));constructor({uiManager:a,pageIndex:b,div:c,accessibilityManager:d,annotationLayer:e,drawLayer:f,textLayer:g,viewport:h,l10n:i}){const j=[...o.#ca.values()];if(!o._initialized)for(const a of(o._initialized=!0,j))a.initialize(i);a.registerEditorTypes(j),this.#b9=a,this.pageIndex=b,this.div=c,this.#G=d,this.#b$=e,this.viewport=h,this.#b8=g,this.drawLayer=f,this.#b9.addLayer(this)}get isEmpty(){return 0===this.#b4.size}updateToolbar(a){this.#b9.updateToolbar(a)}updateMode(a=this.#b9.getMode()){switch(this.#cb(),a){case d.AnnotationEditorType.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;case d.AnnotationEditorType.INK:this.addInkEditorIfNeeded(!1),this.disableTextSelection(),this.togglePointerEvents(!0),this.disableClick();break;case d.AnnotationEditorType.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}if(a!==d.AnnotationEditorType.NONE){let{classList:b}=this.div;for(let c of o.#ca.values())b.toggle(`${c._type}Editing`,a===c._editorType);this.div.hidden=!1}}addInkEditorIfNeeded(a){if(this.#b9.getMode()===d.AnnotationEditorType.INK){if(!a){for(let a of this.#b4.values())if(a.isEmpty())return void a.setInBackground()}this.#cc({offsetX:0,offsetY:0},!1).setInBackground()}}setEditingState(a){this.#b9.setEditingState(a)}addCommands(a){this.#b9.addCommands(a)}togglePointerEvents(a=!1){this.div.classList.toggle("disabled",!a)}enable(){this.togglePointerEvents(!0);let a=new Set;for(let b of this.#b4.values())b.enableEditing(),b.annotationElementId&&a.add(b.annotationElementId);if(this.#b$)for(let b of this.#b$.getEditableAnnotations()){if(b.hide(),this.#b9.isDeletedAnnotationElement(b.data.id)||a.has(b.data.id))continue;let c=this.deserialize(b);c&&(this.addOrRebuild(c),c.enableEditing())}}disable(){this.#b7=!0,this.togglePointerEvents(!1);let a=new Set;for(let b of this.#b4.values()){if(b.disableEditing(),!b.annotationElementId||null!==b.serialize()){a.add(b.annotationElementId);continue}this.getEditableAnnotation(b.annotationElementId)?.show(),b.remove()}if(this.#b$)for(let b of this.#b$.getEditableAnnotations()){let{id:c}=b.data;a.has(c)||this.#b9.isDeletedAnnotationElement(c)||b.show()}this.#cb(),this.isEmpty&&(this.div.hidden=!0);let{classList:b}=this.div;for(let a of o.#ca.values())b.remove(`${a._type}Editing`);this.disableTextSelection(),this.#b7=!1}getEditableAnnotation(a){return this.#b$?.getEditableAnnotation(a)||null}setActiveEditor(a){this.#b9.getActive()!==a&&this.#b9.setActiveEditor(a)}enableTextSelection(){this.#b8?.div&&document.addEventListener("selectstart",this.#b3)}disableTextSelection(){this.#b8?.div&&document.removeEventListener("selectstart",this.#b3)}enableClick(){this.div.addEventListener("pointerdown",this.#b1),this.div.addEventListener("pointerup",this.#b_)}disableClick(){this.div.removeEventListener("pointerdown",this.#b1),this.div.removeEventListener("pointerup",this.#b_)}attach(a){this.#b4.set(a.id,a);let{annotationElementId:b}=a;b&&this.#b9.isDeletedAnnotationElement(b)&&this.#b9.removeDeletedAnnotationElement(a)}detach(a){this.#b4.delete(a.id),this.#G?.removePointerInTextLayer(a.contentDiv),!this.#b7&&a.annotationElementId&&this.#b9.addDeletedAnnotationElement(a)}remove(a){this.detach(a),this.#b9.removeEditor(a),a.div.remove(),a.isAttachedToDOM=!1,this.#b6||this.addInkEditorIfNeeded(!1)}changeParent(a){a.parent!==this&&(a.annotationElementId&&(this.#b9.addDeletedAnnotationElement(a.annotationElementId),e.AnnotationEditor.deleteAnnotationElement(a),a.annotationElementId=null),this.attach(a),a.parent?.detach(a),a.setParent(this),a.div&&a.isAttachedToDOM&&(a.div.remove(),this.div.append(a.div)))}add(a){if(this.changeParent(a),this.#b9.addEditor(a),this.attach(a),!a.isAttachedToDOM){let b=a.render();this.div.append(b),a.isAttachedToDOM=!0}a.fixAndSetPosition(),a.onceAdded(),this.#b9.addToAnnotationStorage(a)}moveEditorInDOM(a){if(!a.isAttachedToDOM)return;let{activeElement:b}=document;a.div.contains(b)&&!this.#b2&&(a._focusEventsAllowed=!1,this.#b2=setTimeout(()=>{this.#b2=null,a.div.contains(document.activeElement)?a._focusEventsAllowed=!0:(a.div.addEventListener("focusin",()=>{a._focusEventsAllowed=!0},{once:!0}),b.focus())},0)),a._structTreeParentId=this.#G?.moveElementInDOM(this.div,a.div,a.contentDiv,!0)}addOrRebuild(a){a.needsToBeRebuilt()?(a.parent||=this,a.rebuild()):this.add(a)}addUndoableEditor(a){this.addCommands({cmd:()=>a._uiManager.rebuild(a),undo:()=>{a.remove()},mustExec:!1})}getNextId(){return this.#b9.getId()}get #cd(){return o.#ca.get(this.#b9.getMode())}#ce(a){let b=this.#cd;return b?new b.prototype.constructor(a):null}canCreateNewEmptyEditor(){return this.#cd?.canCreateNewEmptyEditor()}pasteEditor(a,b){this.#b9.updateToolbar(a),this.#b9.updateMode(a);let{offsetX:c,offsetY:d}=this.#cf(),e=this.getNextId(),f=this.#ce({parent:this,id:e,x:c,y:d,uiManager:this.#b9,isCentered:!0,...b});f&&this.add(f)}deserialize(a){return o.#ca.get(a.annotationType??a.annotationEditorType)?.deserialize(a,this,this.#b9)||null}#cc(a,b,c={}){let d=this.getNextId(),e=this.#ce({parent:this,id:d,x:a.offsetX,y:a.offsetY,uiManager:this.#b9,isCentered:b,...c});return e&&this.add(e),e}#cf(){let{x:a,y:b,width:c,height:d}=this.div.getBoundingClientRect(),e=Math.max(0,a),f=Math.max(0,b),g=Math.min(window.innerWidth,a+c),h=Math.min(window.innerHeight,b+d),i=(e+g)/2-a,j=(f+h)/2-b,[k,l]=this.viewport.rotation%180==0?[i,j]:[j,i];return{offsetX:k,offsetY:l}}addNewEditor(){this.#cc(this.#cf(),!0)}setSelected(a){this.#b9.setSelected(a)}toggleSelected(a){this.#b9.toggleSelected(a)}isSelected(a){return this.#b9.isSelected(a)}unselect(a){this.#b9.unselect(a)}selectionStart(a){this.#b8?.div.addEventListener("pointerup",this.#b0,{once:!0})}pointerUpAfterSelection(a){let b,c=document.getSelection();if(0===c.rangeCount)return;let d=c.getRangeAt(0);if(d.collapsed||!this.#b8?.div.contains(d.commonAncestorContainer))return;let{x:e,y:f,width:g,height:h}=this.#b8.div.getBoundingClientRect(),i=d.getClientRects();switch(this.viewport.rotation){case 90:b=(a,b,c,d)=>({x:(b-f)/h,y:1-(a+c-e)/g,width:d/h,height:c/g});break;case 180:b=(a,b,c,d)=>({x:1-(a+c-e)/g,y:1-(b+d-f)/h,width:c/g,height:d/h});break;case 270:b=(a,b,c,d)=>({x:1-(b+d-f)/h,y:(a-e)/g,width:d/h,height:c/g});break;default:b=(a,b,c,d)=>({x:(a-e)/g,y:(b-f)/h,width:c/g,height:d/h})}let j=[];for(let{x:a,y:c,width:d,height:e}of i)0!==d&&0!==e&&j.push(b(a,c,d,e));0!==j.length&&this.#cc(a,!1,{boxes:j}),c.empty()}pointerup(a){let{isMac:b}=d.FeatureTest.platform;if(0===a.button&&(!a.ctrlKey||!b)&&a.target===this.div&&this.#b5){if(this.#b5=!1,!this.#bZ){this.#bZ=!0;return}if(this.#b9.getMode()===d.AnnotationEditorType.STAMP)return void this.#b9.unselectAll();this.#cc(a,!1)}}pointerdown(a){if(this.#b9.getMode()===d.AnnotationEditorType.HIGHLIGHT&&this.enableTextSelection(),this.#b5){this.#b5=!1;return}let{isMac:b}=d.FeatureTest.platform;if(0!==a.button||a.ctrlKey&&b||a.target!==this.div)return;this.#b5=!0;let c=this.#b9.getActive();this.#bZ=!c||c.isEmpty()}findNewParent(a,b,c){let d=this.#b9.findParent(b,c);return null!==d&&d!==this&&(d.changeParent(a),!0)}destroy(){for(let a of(this.#b9.getActive()?.parent===this&&(this.#b9.commitOrRemove(),this.#b9.setActiveEditor(null)),this.#b2&&(clearTimeout(this.#b2),this.#b2=null),this.#b4.values()))this.#G?.removePointerInTextLayer(a.contentDiv),a.setParent(null),a.isAttachedToDOM=!1,a.div.remove();this.div=null,this.#b4.clear(),this.#b9.removeLayer(this)}#cb(){for(let a of(this.#b6=!0,this.#b4.values()))a.isEmpty()&&a.remove();this.#b6=!1}render({viewport:a}){for(let b of(this.viewport=a,(0,l.setLayerDimensions)(this.div,a),this.#b9.getEditors(this.pageIndex)))this.add(b);this.updateMode()}update({viewport:a}){this.#b9.commitOrRemove();let b=this.viewport.rotation,c=a.rotation;if(this.viewport=a,(0,l.setLayerDimensions)(this.div,{rotation:c}),b!==c)for(let a of this.#b4.values())a.rotate(c);this.updateMode()}get pageDimensions(){let{pageWidth:a,pageHeight:b}=this.viewport.rawDims;return[a,b]}}},97:(a,b,c)=>{c.d(b,{ColorPicker:()=>g});var d=c(266),e=c(812),f=c(473);class g{#e=this.#f.bind(this);#cg=null;#ch=null;#ci;#cj=null;#ck=!1;#cl=!1;#cm;#b9=null;static get _keyboardManager(){return(0,d.shadow)(this,"_keyboardManager",new e.KeyboardManager([[["Escape","mac+Escape"],g.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],g.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],g.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],g.prototype._moveToPrevious],[["Home","mac+Home"],g.prototype._moveToBeginning],[["End","mac+End"],g.prototype._moveToEnd]]))}constructor({editor:a=null,uiManager:b=null}){this.#cl=!a,this.#b9=a?._uiManager||b,this.#cm=this.#b9._eventBus,this.#ci=a?.color||this.#b9?.highlightColors.values().next().value||"#FFFF98"}renderButton(){let a=this.#cg=document.createElement("button");a.className="colorPicker",a.tabIndex="0",a.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),a.setAttribute("aria-haspopup",!0),a.addEventListener("click",this.#cn.bind(this));let b=this.#ch=document.createElement("span");return b.className="swatch",b.style.backgroundColor=this.#ci,a.append(b),a}renderMainDropdown(){let a=this.#cj=this.#co(d.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR);return a.setAttribute("aria-orientation","horizontal"),a.setAttribute("aria-labelledby","highlightColorPickerLabel"),a}#co(a){let b=document.createElement("div");for(let[c,d]of(b.addEventListener("contextmenu",f.noContextMenu),b.className="dropdown",b.role="listbox",b.setAttribute("aria-multiselectable",!1),b.setAttribute("aria-orientation","vertical"),b.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#b9.highlightColors)){let e=document.createElement("button");e.tabIndex="0",e.role="option",e.setAttribute("data-color",d),e.title=c,e.setAttribute("data-l10n-id",`pdfjs-editor-colorpicker-${c}`);let f=document.createElement("span");e.append(f),f.className="swatch",f.style.backgroundColor=d,e.setAttribute("aria-selected",d===this.#ci),e.addEventListener("click",this.#cp.bind(this,a,d)),b.append(e)}return b.addEventListener("keydown",this.#e),b}#cp(a,b,c){c.stopPropagation(),this.#cm.dispatch("switchannotationeditorparams",{source:this,type:a,value:b})}_colorSelectFromKeyboard(a){let b=a.target.getAttribute("data-color");b&&this.#cp(b,a)}_moveToNext(a){a.target===this.#cg?this.#cj.firstChild?.focus():a.target.nextSibling?.focus()}_moveToPrevious(a){a.target.previousSibling?.focus()}_moveToBeginning(){this.#cj.firstChild?.focus()}_moveToEnd(){this.#cj.lastChild?.focus()}#f(a){g._keyboardManager.exec(this,a)}#cn(a){if(this.#cj&&!this.#cj.classList.contains("hidden"))return void this.hideDropdown();if(this.#cg.addEventListener("keydown",this.#e),this.#ck=0===a.detail,this.#cj)return void this.#cj.classList.remove("hidden");let b=this.#cj=this.#co(d.AnnotationEditorParamsType.HIGHLIGHT_COLOR);this.#cg.append(b)}hideDropdown(){this.#cj?.classList.add("hidden")}_hideDropdownFromKeyboard(){this.#cl||!this.#cj||this.#cj.classList.contains("hidden")||(this.hideDropdown(),this.#cg.removeEventListener("keydown",this.#e),this.#cg.focus({preventScroll:!0,focusVisible:this.#ck}))}updateColor(a){if(this.#ch&&(this.#ch.style.backgroundColor=a),!this.#cj)return;let b=this.#b9.highlightColors.values();for(let c of this.#cj.children)c.setAttribute("aria-selected",b.next().value===a)}destroy(){this.#cg?.remove(),this.#cg=null,this.#ch=null,this.#cj?.remove(),this.#cj=null}}},115:(a,b,c)=>{c.d(b,{AnnotationEditor:()=>i});var d=c(812),e=c(266),f=c(473);class g{#cq="";#cr=!1;#cs=null;#ct=null;#cu=null;#cv=!1;#cw=null;static _l10nPromise=null;constructor(a){this.#cw=a}static initialize(a){g._l10nPromise||=a}async render(){let a=this.#cs=document.createElement("button");a.className="altText";let b=await g._l10nPromise.get("pdfjs-editor-alt-text-button-label");a.textContent=b,a.setAttribute("aria-label",b),a.tabIndex="0",a.addEventListener("contextmenu",f.noContextMenu),a.addEventListener("pointerdown",a=>a.stopPropagation());let c=a=>{a.preventDefault(),this.#cw._uiManager.editAltText(this.#cw)};return a.addEventListener("click",c,{capture:!0}),a.addEventListener("keydown",b=>{b.target===a&&"Enter"===b.key&&(this.#cv=!0,c(b))}),await this.#cx(),a}finish(){this.#cs&&(this.#cs.focus({focusVisible:this.#cv}),this.#cv=!1)}get data(){return{altText:this.#cq,decorative:this.#cr}}set data({altText:a,decorative:b}){(this.#cq!==a||this.#cr!==b)&&(this.#cq=a,this.#cr=b,this.#cx())}toggle(a=!1){this.#cs&&(!a&&this.#cu&&(clearTimeout(this.#cu),this.#cu=null),this.#cs.disabled=!a)}destroy(){this.#cs?.remove(),this.#cs=null,this.#ct=null}async #cx(){let a=this.#cs;if(!a)return;if(!this.#cq&&!this.#cr){a.classList.remove("done"),this.#ct?.remove();return}a.classList.add("done"),g._l10nPromise.get("pdfjs-editor-alt-text-edit-button-label").then(b=>{a.setAttribute("aria-label",b)});let b=this.#ct;if(!b){this.#ct=b=document.createElement("span"),b.className="tooltip",b.setAttribute("role","tooltip");let c=b.id=`alt-text-tooltip-${this.#cw.id}`;a.setAttribute("aria-describedby",c),a.addEventListener("mouseenter",()=>{this.#cu=setTimeout(()=>{this.#cu=null,this.#ct.classList.add("show"),this.#cw._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.#cw.editorType,data:{action:"alt_text_tooltip"}}})},100)}),a.addEventListener("mouseleave",()=>{this.#cu&&(clearTimeout(this.#cu),this.#cu=null),this.#ct?.classList.remove("show")})}b.innerText=this.#cr?await g._l10nPromise.get("pdfjs-editor-alt-text-decorative-tooltip"):this.#cq,b.parentNode||a.append(b);let c=this.#cw.getImageForAltText();c?.setAttribute("aria-describedby",b.id)}}class h{#cy=null;#aT=null;#cw;#cz=null;constructor(a){this.#cw=a}render(){let a=this.#cy=document.createElement("div");a.className="editToolbar",a.addEventListener("contextmenu",f.noContextMenu),a.addEventListener("pointerdown",h.#cA);let b=this.#cz=document.createElement("div");b.className="buttons",a.append(b);let c=this.#cw.toolbarPosition;if(c){let{style:b}=a,d="ltr"===this.#cw._uiManager.direction?1-c[0]:c[0];b.insetInlineEnd=`${100*d}%`,b.top=`calc(${100*c[1]}% + var(--editor-toolbar-vert-offset))`}return this.#cB(),a}static #cA(a){a.stopPropagation()}#cC(a){this.#cw._focusEventsAllowed=!1,a.preventDefault(),a.stopPropagation()}#cD(a){this.#cw._focusEventsAllowed=!0,a.preventDefault(),a.stopPropagation()}#cE(a){a.addEventListener("focusin",this.#cC.bind(this),{capture:!0}),a.addEventListener("focusout",this.#cD.bind(this),{capture:!0}),a.addEventListener("contextmenu",f.noContextMenu)}hide(){this.#cy.classList.add("hidden"),this.#aT?.hideDropdown()}show(){this.#cy.classList.remove("hidden")}#cB(){let a=document.createElement("button");a.className="delete",a.tabIndex=0,a.setAttribute("data-l10n-id",`pdfjs-editor-remove-${this.#cw.editorType}-button`),this.#cE(a),a.addEventListener("click",a=>{this.#cw._uiManager.delete()}),this.#cz.append(a)}get #cF(){let a=document.createElement("div");return a.className="divider",a}addAltTextButton(a){this.#cE(a),this.#cz.prepend(a,this.#cF)}addColorPicker(a){this.#aT=a;let b=a.renderButton();this.#cE(b),this.#cz.prepend(b,this.#cF)}remove(){this.#cy.remove(),this.#aT?.destroy(),this.#aT=null}}class i{#cG=null;#cq=null;#cH=!1;#cI=null;#cJ=null;#cK=this.focusin.bind(this);#cL=this.focusout.bind(this);#cM=null;#cN="";#cO=!1;#cP=!1;#cQ=!1;#cR=!1;#cS=null;_initialOptions=Object.create(null);_uiManager=null;_focusEventsAllowed=!0;_l10nPromise=null;#cT=!1;#cU=i._zIndex++;static _borderLineWidth=-1;static _colorManager=new d.ColorManager;static _zIndex=1;static get _resizerKeyboardManager(){let a=i.prototype._resizeWithKeyboard,b=d.AnnotationEditorUIManager.TRANSLATE_SMALL,c=d.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,e.shadow)(this,"_resizerKeyboardManager",new d.KeyboardManager([[["ArrowLeft","mac+ArrowLeft"],a,{args:[-b,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],a,{args:[-c,0]}],[["ArrowRight","mac+ArrowRight"],a,{args:[b,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],a,{args:[c,0]}],[["ArrowUp","mac+ArrowUp"],a,{args:[0,-b]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],a,{args:[0,-c]}],[["ArrowDown","mac+ArrowDown"],a,{args:[0,b]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],a,{args:[0,c]}],[["Escape","mac+Escape"],i.prototype._stopResizingWithKeyboard]]))}constructor(a){this.constructor===i&&(0,e.unreachable)("Cannot initialize AnnotationEditor."),this.parent=a.parent,this.id=a.id,this.width=this.height=null,this.pageIndex=a.parent.pageIndex,this.name=a.name,this.div=null,this._uiManager=a.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=a.isCentered,this._structTreeParentId=null;const{rotation:b,rawDims:{pageWidth:c,pageHeight:d,pageX:f,pageY:g}}=this.parent.viewport;this.rotation=b,this.pageRotation=(360+b-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[c,d],this.pageTranslation=[f,g];const[h,j]=this.parentDimensions;this.x=a.x/h,this.y=a.y/j,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,e.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(a){let b=new j({id:a.parent.getNextId(),parent:a.parent,uiManager:a._uiManager});b.annotationElementId=a.annotationElementId,b.deleted=!0,b._uiManager.addToAnnotationStorage(b)}static initialize(a,b=null){if(i._l10nPromise||=new Map(["pdfjs-editor-alt-text-button-label","pdfjs-editor-alt-text-edit-button-label","pdfjs-editor-alt-text-decorative-tooltip","pdfjs-editor-resizer-label-topLeft","pdfjs-editor-resizer-label-topMiddle","pdfjs-editor-resizer-label-topRight","pdfjs-editor-resizer-label-middleRight","pdfjs-editor-resizer-label-bottomRight","pdfjs-editor-resizer-label-bottomMiddle","pdfjs-editor-resizer-label-bottomLeft","pdfjs-editor-resizer-label-middleLeft"].map(b=>[b,a.get(b.replaceAll(/([A-Z])/g,a=>`-${a.toLowerCase()}`))])),b?.strings)for(let c of b.strings)i._l10nPromise.set(c,a.get(c));if(-1!==i._borderLineWidth)return;let c=getComputedStyle(document.documentElement);i._borderLineWidth=parseFloat(c.getPropertyValue("--outline-width"))||0}static updateDefaultParams(a,b){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(a){return!1}static paste(a,b){(0,e.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#cT}set _isDraggable(a){this.#cT=a,this.div?.classList.toggle("draggable",a)}get isEnterHandled(){return!0}center(){let[a,b]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*b/(2*a),this.y+=this.width*a/(2*b);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*b/(2*a),this.y-=this.width*a/(2*b);break;default:this.x-=this.width/2,this.y-=this.height/2}this.fixAndSetPosition()}addCommands(a){this._uiManager.addCommands(a)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#cU}setParent(a){null!==a?(this.pageIndex=a.pageIndex,this.pageDimensions=a.pageDimensions):this.#cV(),this.parent=a}focusin(a){this._focusEventsAllowed&&(this.#cO?this.#cO=!1:this.parent.setSelected(this))}focusout(a){if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;let b=a.relatedTarget;!b?.closest(`#${this.id}`)&&(a.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(a,b,c,d){let[e,f]=this.parentDimensions;[c,d]=this.screenToPageTranslation(c,d),this.x=(a+c)/e,this.y=(b+d)/f,this.fixAndSetPosition()}#cW([a,b],c,d){[c,d]=this.screenToPageTranslation(c,d),this.x+=c/a,this.y+=d/b,this.fixAndSetPosition()}translate(a,b){this.#cW(this.parentDimensions,a,b)}translateInPage(a,b){this.#cW(this.pageDimensions,a,b),this.div.scrollIntoView({block:"nearest"})}drag(a,b){let[c,d]=this.parentDimensions;if(this.x+=a/c,this.y+=b/d,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){let{x:a,y:b}=this.div.getBoundingClientRect();this.parent.findNewParent(this,a,b)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:e,y:f}=this,[g,h]=this.#cX();e+=g,f+=h,this.div.style.left=`${(100*e).toFixed(2)}%`,this.div.style.top=`${(100*f).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}#cX(){let[a,b]=this.parentDimensions,{_borderLineWidth:c}=i,d=c/a,e=c/b;switch(this.rotation){case 90:return[-d,e];case 180:return[d,e];case 270:return[d,-e];default:return[-d,-e]}}fixAndSetPosition(a=this.rotation){let[b,c]=this.pageDimensions,{x:d,y:e,width:f,height:g}=this;switch(f*=b,g*=c,d*=b,e*=c,a){case 0:d=Math.max(0,Math.min(b-f,d)),e=Math.max(0,Math.min(c-g,e));break;case 90:d=Math.max(0,Math.min(b-g,d)),e=Math.min(c,Math.max(f,e));break;case 180:d=Math.min(b,Math.max(f,d)),e=Math.min(c,Math.max(g,e));break;case 270:d=Math.min(b,Math.max(g,d)),e=Math.max(0,Math.min(c-f,e))}this.x=d/=b,this.y=e/=c;let[h,i]=this.#cX();d+=h,e+=i;let{style:j}=this.div;j.left=`${(100*d).toFixed(2)}%`,j.top=`${(100*e).toFixed(2)}%`,this.moveInDOM()}static #cY(a,b,c){switch(c){case 90:return[b,-a];case 180:return[-a,-b];case 270:return[-b,a];default:return[a,b]}}screenToPageTranslation(a,b){return i.#cY(a,b,this.parentRotation)}pageTranslationToScreen(a,b){return i.#cY(a,b,360-this.parentRotation)}#cZ(a){switch(a){case 90:{let[a,b]=this.pageDimensions;return[0,-a/b,b/a,0]}case 180:return[-1,0,0,-1];case 270:{let[a,b]=this.pageDimensions;return[0,a/b,-b/a,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){let{parentScale:a,pageDimensions:[b,c]}=this,d=b*a,f=c*a;return e.FeatureTest.isCSSRoundSupported?[Math.round(d),Math.round(f)]:[d,f]}setDims(a,b){let[c,d]=this.parentDimensions;this.div.style.width=`${(100*a/c).toFixed(2)}%`,this.#cH||(this.div.style.height=`${(100*b/d).toFixed(2)}%`)}fixDims(){let{style:a}=this.div,{height:b,width:c}=a,d=c.endsWith("%"),e=!this.#cH&&b.endsWith("%");if(d&&e)return;let[f,g]=this.parentDimensions;d||(a.width=`${(100*parseFloat(c)/f).toFixed(2)}%`),this.#cH||e||(a.height=`${(100*parseFloat(b)/g).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}#c$(){if(!this.#cI){for(let a of(this.#cI=document.createElement("div"),this.#cI.classList.add("resizers"),this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"])){let b=document.createElement("div");this.#cI.append(b),b.classList.add("resizer",a),b.setAttribute("data-resizer-name",a),b.addEventListener("pointerdown",this.#c_.bind(this,a)),b.addEventListener("contextmenu",f.noContextMenu),b.tabIndex=-1}this.div.prepend(this.#cI)}}#c_(a,b){b.preventDefault();let{isMac:c}=e.FeatureTest.platform;if(0!==b.button||b.ctrlKey&&c)return;this.#cq?.toggle(!1);let d=this.#c0.bind(this,a),f=this._isDraggable;this._isDraggable=!1;let g={passive:!0,capture:!0};this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",d,g);let h=this.x,i=this.y,j=this.width,k=this.height,l=this.parent.div.style.cursor,m=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(b.target).cursor;let n=()=>{this.parent.togglePointerEvents(!0),this.#cq?.toggle(!0),this._isDraggable=f,window.removeEventListener("pointerup",n),window.removeEventListener("blur",n),window.removeEventListener("pointermove",d,g),this.parent.div.style.cursor=l,this.div.style.cursor=m,this.#c1(h,i,j,k)};window.addEventListener("pointerup",n),window.addEventListener("blur",n)}#c1(a,b,c,d){let e=this.x,f=this.y,g=this.width,h=this.height;(e!==a||f!==b||g!==c||h!==d)&&this.addCommands({cmd:()=>{this.width=g,this.height=h,this.x=e,this.y=f;let[a,b]=this.parentDimensions;this.setDims(a*g,b*h),this.fixAndSetPosition()},undo:()=>{this.width=c,this.height=d,this.x=a,this.y=b;let[e,f]=this.parentDimensions;this.setDims(e*c,f*d),this.fixAndSetPosition()},mustExec:!0})}#c0(a,b){let c,d,e,f,[g,h]=this.parentDimensions,j=this.x,k=this.y,l=this.width,m=this.height,n=i.MIN_SIZE/g,o=i.MIN_SIZE/h,p=a=>Math.round(1e4*a)/1e4,q=this.#cZ(this.rotation),r=(a,b)=>[q[0]*a+q[2]*b,q[1]*a+q[3]*b],s=this.#cZ(360-this.rotation),t=!1,u=!1;switch(a){case"topLeft":t=!0,c=(a,b)=>[0,0],d=(a,b)=>[a,b];break;case"topMiddle":c=(a,b)=>[a/2,0],d=(a,b)=>[a/2,b];break;case"topRight":t=!0,c=(a,b)=>[a,0],d=(a,b)=>[0,b];break;case"middleRight":u=!0,c=(a,b)=>[a,b/2],d=(a,b)=>[0,b/2];break;case"bottomRight":t=!0,c=(a,b)=>[a,b],d=(a,b)=>[0,0];break;case"bottomMiddle":c=(a,b)=>[a/2,b],d=(a,b)=>[a/2,0];break;case"bottomLeft":t=!0,c=(a,b)=>[0,b],d=(a,b)=>[a,0];break;case"middleLeft":u=!0,c=(a,b)=>[0,b/2],d=(a,b)=>[a,b/2]}let v=c(l,m),w=d(l,m),x=r(...w),y=p(j+x[0]),z=p(k+x[1]),A=1,B=1,[C,D]=this.screenToPageTranslation(b.movementX,b.movementY);if([C,D]=(e=C/g,f=D/h,[s[0]*e+s[2]*f,s[1]*e+s[3]*f]),t){let a=Math.hypot(l,m);A=B=Math.max(Math.min(Math.hypot(w[0]-v[0]-C,w[1]-v[1]-D)/a,1/l,1/m),n/l,o/m)}else u?A=Math.max(n,Math.min(1,Math.abs(w[0]-v[0]-C)))/l:B=Math.max(o,Math.min(1,Math.abs(w[1]-v[1]-D)))/m;let E=p(l*A),F=p(m*B);x=r(...d(E,F));let G=y-x[0],H=z-x[1];this.width=E,this.height=F,this.x=G,this.y=H,this.setDims(g*E,h*F),this.fixAndSetPosition()}altTextFinish(){this.#cq?.finish()}async addEditToolbar(){return this.#cM||this.#cQ||(this.#cM=new h(this),this.div.append(this.#cM.render()),this.#cq&&this.#cM.addAltTextButton(await this.#cq.render())),this.#cM}removeEditToolbar(){this.#cM&&(this.#cM.remove(),this.#cM=null,this.#cq?.destroy())}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){this.#cq||(g.initialize(i._l10nPromise),this.#cq=new g(this),await this.addEditToolbar())}get altTextData(){return this.#cq?.data}set altTextData(a){this.#cq&&(this.#cq.data=a)}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",this.#cK),this.div.addEventListener("focusout",this.#cL);let[a,b]=this.parentDimensions;this.parentRotation%180!=0&&(this.div.style.maxWidth=`${(100*b/a).toFixed(2)}%`,this.div.style.maxHeight=`${(100*a/b).toFixed(2)}%`);let[c,e]=this.getInitialTranslation();return this.translate(c,e),(0,d.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(a){let{isMac:b}=e.FeatureTest.platform;0!==a.button||a.ctrlKey&&b?a.preventDefault():(this.#cO=!0,this._isDraggable)?this.#c2(a):this.#c3(a)}#c3(a){let{isMac:b}=e.FeatureTest.platform;a.ctrlKey&&!b||a.shiftKey||a.metaKey&&b?this.parent.toggleSelected(this):this.parent.setSelected(this)}#c2(a){let b,c,d=this._uiManager.isSelected(this);this._uiManager.setUpDragSession(),d&&(b={passive:!0,capture:!0},c=a=>{let[b,c]=this.screenToPageTranslation(a.movementX,a.movementY);this._uiManager.dragSelectedEditors(b,c)},window.addEventListener("pointermove",c,b));let e=()=>{window.removeEventListener("pointerup",e),window.removeEventListener("blur",e),d&&window.removeEventListener("pointermove",c,b),this.#cO=!1,this._uiManager.endDragSession()||this.#c3(a)};window.addEventListener("pointerup",e),window.addEventListener("blur",e)}moveInDOM(){this.#cS&&clearTimeout(this.#cS),this.#cS=setTimeout(()=>{this.#cS=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(a,b,c){a.changeParent(this),this.x=b,this.y=c,this.fixAndSetPosition()}getRect(a,b,c=this.rotation){let d=this.parentScale,[e,f]=this.pageDimensions,[g,h]=this.pageTranslation,i=a/d,j=b/d,k=this.x*e,l=this.y*f,m=this.width*e,n=this.height*f;switch(c){case 0:return[k+i+g,f-l-j-n+h,k+i+m+g,f-l-j+h];case 90:return[k+j+g,f-l+i+h,k+j+n+g,f-l+i+m+h];case 180:return[k-i-m+g,f-l+j+h,k-i+g,f-l+j+n+h];case 270:return[k-j-n+g,f-l-i-m+h,k-j+g,f-l-i+h];default:throw Error("Invalid rotation")}}getRectInCurrentCoords(a,b){let[c,d,e,f]=a,g=e-c,h=f-d;switch(this.rotation){case 0:return[c,b-f,g,h];case 90:return[c,b-d,h,g];case 180:return[e,b-d,g,h];case 270:return[e,b-f,h,g];default:throw Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){this.#cQ=!0}disableEditMode(){this.#cQ=!1}isInEditMode(){return this.#cQ}shouldGetKeyboardEvents(){return this.#cR}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){this.div?.addEventListener("focusin",this.#cK),this.div?.addEventListener("focusout",this.#cL)}rotate(a){}serialize(a=!1,b=null){(0,e.unreachable)("An editor must be serializable")}static deserialize(a,b,c){let d=new this.prototype.constructor({parent:b,id:b.getNextId(),uiManager:c});d.rotation=a.rotation;let[e,f]=d.pageDimensions,[g,h,i,j]=d.getRectInCurrentCoords(a.rect,f);return d.x=g/e,d.y=h/f,d.width=i/e,d.height=j/f,d}remove(){this.div.removeEventListener("focusin",this.#cK),this.div.removeEventListener("focusout",this.#cL),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#cS&&(clearTimeout(this.#cS),this.#cS=null),this.#cV(),this.removeEditToolbar()}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#c$(),this.#cI.classList.remove("hidden"),(0,d.bindEvents)(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(a){if(!this.isResizable||a.target!==this.div||"Enter"!==a.key)return;this._uiManager.setSelected(this),this.#cJ={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};let b=this.#cI.children;if(!this.#cG){this.#cG=Array.from(b);let a=this.#c4.bind(this),c=this.#c5.bind(this);for(let b of this.#cG){let d=b.getAttribute("data-resizer-name");b.setAttribute("role","spinbutton"),b.addEventListener("keydown",a),b.addEventListener("blur",c),b.addEventListener("focus",this.#c6.bind(this,d)),i._l10nPromise.get(`pdfjs-editor-resizer-label-${d}`).then(a=>b.setAttribute("aria-label",a))}}let c=this.#cG[0],d=0;for(let a of b){if(a===c)break;d++}let e=(360-this.rotation+this.parentRotation)%360/90*(this.#cG.length/4);if(e!==d){if(e<d)for(let a=0;a<d-e;a++)this.#cI.append(this.#cI.firstChild);else if(e>d)for(let a=0;a<e-d;a++)this.#cI.firstChild.before(this.#cI.lastChild);let a=0;for(let c of b){let b=this.#cG[a++].getAttribute("data-resizer-name");i._l10nPromise.get(`pdfjs-editor-resizer-label-${b}`).then(a=>c.setAttribute("aria-label",a))}}this.#c7(0),this.#cR=!0,this.#cI.firstChild.focus({focusVisible:!0}),a.preventDefault(),a.stopImmediatePropagation()}#c4(a){i._resizerKeyboardManager.exec(this,a)}#c5(a){this.#cR&&a.relatedTarget?.parentNode!==this.#cI&&this.#cV()}#c6(a){this.#cN=this.#cR?a:""}#c7(a){if(this.#cG)for(let b of this.#cG)b.tabIndex=a}_resizeWithKeyboard(a,b){this.#cR&&this.#c0(this.#cN,{movementX:a,movementY:b})}#cV(){if(this.#cR=!1,this.#c7(-1),this.#cJ){let{savedX:a,savedY:b,savedWidth:c,savedHeight:d}=this.#cJ;this.#c1(a,b,c,d),this.#cJ=null}}_stopResizingWithKeyboard(){this.#cV(),this.div.focus()}select(){(this.makeResizable(),this.div?.classList.add("selectedEditor"),this.#cM)?this.#cM?.show():this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this.#cM?.show()})}unselect(){this.#cI?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus(),this.#cM?.hide()}updateParams(a,b){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return this.#cP}set isEditing(a){this.#cP=a,this.parent&&(a?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(a,b){this.#cH=!0;let{style:c}=this.div;c.aspectRatio=a/b,c.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}}class j extends i{constructor(a){super(a),this.annotationElementId=a.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},405:(a,b,c)=>{c.d(b,{Outliner:()=>d});class d{#c8;#c9=[];#da=[];constructor(a,b=0,c=0,d=!0){let e=1/0,f=-1/0,g=1/0,h=-1/0;for(const{x:c,y:d,width:i,height:j}of a){const a=1e-4*Math.floor((c-b)/1e-4),k=1e-4*Math.ceil((c+i+b)/1e-4),l=1e-4*Math.floor((d-b)/1e-4),m=1e-4*Math.ceil((d+j+b)/1e-4),n=[a,l,m,!0],o=[k,l,m,!1];this.#c9.push(n,o),e=Math.min(e,a),f=Math.max(f,k),g=Math.min(g,l),h=Math.max(h,m)}const i=f-e+2*c,j=h-g+2*c,k=e-c,l=g-c,m=this.#c9.at(d?-1:-2),n=[m[0],m[2]];for(const a of this.#c9){const[b,c,d]=a;a[0]=(b-k)/i,a[1]=(c-l)/j,a[2]=(d-l)/j}this.#c8={x:k,y:l,width:i,height:j,lastPoint:n}}getOutlines(){this.#c9.sort((a,b)=>a[0]-b[0]||a[1]-b[1]||a[2]-b[2]);let a=[];for(let b of this.#c9)b[3]?(a.push(...this.#db(b)),this.#dc(b)):(this.#dd(b),a.push(...this.#db(b)));return this.#de(a)}#de(a){let b,c=[],d=new Set;for(let b of a){let[a,d,e]=b;c.push([a,d,b],[a,e,b])}c.sort((a,b)=>a[1]-b[1]||a[0]-b[0]);for(let a=0,b=c.length;a<b;a+=2){let b=c[a][2],e=c[a+1][2];b.push(e),e.push(b),d.add(b),d.add(e)}let e=[];for(;d.size>0;){let a=d.values().next().value,[c,f,g,h,i]=a;d.delete(a);let j=c,k=f;for(b=[c,g],e.push(b);;){let a;if(d.has(h))a=h;else if(d.has(i))a=i;else break;d.delete(a),[c,f,g,h,i]=a,j!==c&&(b.push(j,k,c,k===f?f:g),j=c),k=k===f?g:f}b.push(j,k)}return{outlines:e,box:this.#c8}}#df(a){let b=this.#da,c=0,d=b.length-1;for(;c<=d;){let e=c+d>>1,f=b[e][0];if(f===a)return e;f<a?c=e+1:d=e-1}return d+1}#dc([,a,b]){let c=this.#df(a);this.#da.splice(c,0,[a,b])}#dd([,a,b]){let c=this.#df(a);for(let d=c;d<this.#da.length;d++){let[c,e]=this.#da[d];if(c!==a)break;if(c===a&&e===b)return void this.#da.splice(d,1)}for(let d=c-1;d>=0;d--){let[c,e]=this.#da[d];if(c!==a)break;if(c===a&&e===b)return void this.#da.splice(d,1)}}#db(a){let[b,c,d]=a,e=[[b,c,d]],f=this.#df(d);for(let a=0;a<f;a++){let[c,d]=this.#da[a];for(let a=0,f=e.length;a<f;a++){let[,g,h]=e[a];if(!(d<=g)&&!(h<=c)){if(g>=c){if(h>d)e[a][1]=d;else{if(1===f)return[];e.splice(a,1),a--,f--}continue}e[a][2]=c,h>d&&e.push([b,d,h])}}}return e}}},812:(a,b,c)=>{c.d(b,{AnnotationEditorUIManager:()=>m,ColorManager:()=>l,KeyboardManager:()=>k,bindEvents:()=>f,opacityToHex:()=>g});var d=c(266),e=c(473);function f(a,b,c){for(let d of c)b.addEventListener(d,a[d].bind(a))}function g(a){return Math.round(Math.min(255,Math.max(1,255*a))).toString(16).padStart(2,"0")}class h{#aq=0;getId(){return`${d.AnnotationEditorPrefix}${this.#aq++}`}}class i{#dg=(0,d.getUuid)();#aq=0;#ar=null;static get _isSVGFittingCanvas(){let a=new OffscreenCanvas(1,3).getContext("2d"),b=new Image;b.src='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>';let c=b.decode().then(()=>(a.drawImage(b,0,0,1,1,0,0,1,3),0===new Uint32Array(a.getImageData(0,0,1,1).data.buffer)[0]));return(0,d.shadow)(this,"_isSVGFittingCanvas",c)}async #dh(a,b){this.#ar||=new Map;let c=this.#ar.get(a);if(null===c)return null;if(c?.bitmap)return c.refCounter+=1,c;try{let a;if(c||={bitmap:null,id:`image_${this.#dg}_${this.#aq++}`,refCounter:0,isSvg:!1},"string"==typeof b?(c.url=b,a=await (0,e.fetchData)(b,"blob")):a=c.file=b,"image/svg+xml"===a.type){let b=i._isSVGFittingCanvas,d=new FileReader,e=new Image,f=new Promise((a,f)=>{e.onload=()=>{c.bitmap=e,c.isSvg=!0,a()},d.onload=async()=>{let a=c.svgUrl=d.result;e.src=await b?`${a}#svgView(preserveAspectRatio(none))`:a},e.onerror=d.onerror=f});d.readAsDataURL(a),await f}else c.bitmap=await createImageBitmap(a);c.refCounter=1}catch(a){console.error(a),c=null}return this.#ar.set(a,c),c&&this.#ar.set(c.id,c),c}async getFromFile(a){let{lastModified:b,name:c,size:d,type:e}=a;return this.#dh(`${b}_${c}_${d}_${e}`,a)}async getFromUrl(a){return this.#dh(a,a)}async getFromId(a){this.#ar||=new Map;let b=this.#ar.get(a);return b?b.bitmap?(b.refCounter+=1,b):b.file?this.getFromFile(b.file):this.getFromUrl(b.url):null}getSvgUrl(a){let b=this.#ar.get(a);return b?.isSvg?b.svgUrl:null}deleteId(a){this.#ar||=new Map;let b=this.#ar.get(a);b&&(b.refCounter-=1,0===b.refCounter&&(b.bitmap=null))}isValidId(a){return a.startsWith(`image_${this.#dg}_`)}}class j{#di=[];#dj=!1;#dk;#dl=-1;constructor(a=128){this.#dk=a}add({cmd:a,undo:b,mustExec:c,type:d=NaN,overwriteIfSameType:e=!1,keepUndo:f=!1}){if(c&&a(),this.#dj)return;let g={cmd:a,undo:b,type:d};if(-1===this.#dl){this.#di.length>0&&(this.#di.length=0),this.#dl=0,this.#di.push(g);return}if(e&&this.#di[this.#dl].type===d){f&&(g.undo=this.#di[this.#dl].undo),this.#di[this.#dl]=g;return}let h=this.#dl+1;h===this.#dk?this.#di.splice(0,1):(this.#dl=h,h<this.#di.length&&this.#di.splice(h)),this.#di.push(g)}undo(){-1!==this.#dl&&(this.#dj=!0,this.#di[this.#dl].undo(),this.#dj=!1,this.#dl-=1)}redo(){this.#dl<this.#di.length-1&&(this.#dl+=1,this.#dj=!0,this.#di[this.#dl].cmd(),this.#dj=!1)}hasSomethingToUndo(){return -1!==this.#dl}hasSomethingToRedo(){return this.#dl<this.#di.length-1}destroy(){this.#di=null}}class k{constructor(a){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:b}=d.FeatureTest.platform;for(const[c,d,e={}]of a)for(const a of c){const c=a.startsWith("mac+");b&&c?(this.callbacks.set(a.slice(4),{callback:d,options:e}),this.allKeys.add(a.split("+").at(-1))):b||c||(this.callbacks.set(a,{callback:d,options:e}),this.allKeys.add(a.split("+").at(-1)))}}#dm(a){a.altKey&&this.buffer.push("alt"),a.ctrlKey&&this.buffer.push("ctrl"),a.metaKey&&this.buffer.push("meta"),a.shiftKey&&this.buffer.push("shift"),this.buffer.push(a.key);let b=this.buffer.join("+");return this.buffer.length=0,b}exec(a,b){if(!this.allKeys.has(b.key))return;let c=this.callbacks.get(this.#dm(b));if(!c)return;let{callback:d,options:{bubbles:e=!1,args:f=[],checker:g=null}}=c;(!g||g(a,b))&&(d.bind(a,...f,b)(),e||(b.stopPropagation(),b.preventDefault()))}}class l{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){let a=new Map([["CanvasText",null],["Canvas",null]]);return(0,e.getColorValues)(a),(0,d.shadow)(this,"_colors",a)}convert(a){let b=(0,e.getRGB)(a);if(!window.matchMedia("(forced-colors: active)").matches)return b;for(let[a,c]of this._colors)if(c.every((a,c)=>a===b[c]))return l._colorsMapping.get(a);return b}getHexCode(a){let b=this._colors.get(a);return b?d.Util.makeHexColor(...b):a}}class m{#dn=null;#dp=new Map;#dq=new Map;#dr=null;#ds=null;#dt=new j;#du=0;#dv=new Set;#dw=null;#ca=null;#dx=new Set;#dy=null;#dz=null;#dA=null;#dB=new h;#dC=!1;#dD=!1;#dE=null;#dF=null;#dG=d.AnnotationEditorType.NONE;#dH=new Set;#dI=null;#dJ=this.blur.bind(this);#dK=this.focus.bind(this);#dL=this.copy.bind(this);#dM=this.cut.bind(this);#dN=this.paste.bind(this);#dO=this.keydown.bind(this);#dP=this.onEditingAction.bind(this);#dQ=this.onPageChanging.bind(this);#dR=this.onScaleChanging.bind(this);#dS=this.onRotationChanging.bind(this);#dT={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1};#dU=[0,0];#dV=null;#n=null;#dW=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){let a=m.prototype,b=a=>a.#n.contains(document.activeElement)&&"BUTTON"!==document.activeElement.tagName&&a.hasSomethingToControl(),c=(a,{target:b})=>{if(b instanceof HTMLInputElement){let{type:a}=b;return"text"!==a&&"number"!==a}return!0},e=this.TRANSLATE_SMALL,f=this.TRANSLATE_BIG;return(0,d.shadow)(this,"_keyboardManager",new k([[["ctrl+a","mac+meta+a"],a.selectAll,{checker:c}],[["ctrl+z","mac+meta+z"],a.undo,{checker:c}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],a.redo,{checker:c}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],a.delete,{checker:c}],[["Enter","mac+Enter"],a.addNewEditorFromKeyboard,{checker:(a,{target:b})=>!(b instanceof HTMLButtonElement)&&a.#n.contains(b)&&!a.isEnterHandled}],[[" ","mac+ "],a.addNewEditorFromKeyboard,{checker:a=>a.#n.contains(document.activeElement)}],[["Escape","mac+Escape"],a.unselectAll],[["ArrowLeft","mac+ArrowLeft"],a.translateSelectedEditors,{args:[-e,0],checker:b}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],a.translateSelectedEditors,{args:[-f,0],checker:b}],[["ArrowRight","mac+ArrowRight"],a.translateSelectedEditors,{args:[e,0],checker:b}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],a.translateSelectedEditors,{args:[f,0],checker:b}],[["ArrowUp","mac+ArrowUp"],a.translateSelectedEditors,{args:[0,-e],checker:b}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],a.translateSelectedEditors,{args:[0,-f],checker:b}],[["ArrowDown","mac+ArrowDown"],a.translateSelectedEditors,{args:[0,e],checker:b}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],a.translateSelectedEditors,{args:[0,f],checker:b}]]))}constructor(a,b,c,d,f,g,h){this.#n=a,this.#dW=b,this.#dr=c,this._eventBus=d,this._eventBus._on("editingaction",this.#dP),this._eventBus._on("pagechanging",this.#dQ),this._eventBus._on("scalechanging",this.#dR),this._eventBus._on("rotationchanging",this.#dS),this.#ds=f.annotationStorage,this.#dy=f.filterFactory,this.#dI=g,this.#dA=h||null,this.viewParameters={realScale:e.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}destroy(){for(let a of(this.#dX(),this.#dY(),this._eventBus._off("editingaction",this.#dP),this._eventBus._off("pagechanging",this.#dQ),this._eventBus._off("scalechanging",this.#dR),this._eventBus._off("rotationchanging",this.#dS),this.#dq.values()))a.destroy();this.#dq.clear(),this.#dp.clear(),this.#dx.clear(),this.#dn=null,this.#dH.clear(),this.#dt.destroy(),this.#dr?.destroy(),this.#dz&&(clearTimeout(this.#dz),this.#dz=null),this.#dV&&(clearTimeout(this.#dV),this.#dV=null)}get hcmFilter(){return(0,d.shadow)(this,"hcmFilter",this.#dI?this.#dy.addHCMFilter(this.#dI.foreground,this.#dI.background):"none")}get direction(){return(0,d.shadow)(this,"direction",getComputedStyle(this.#n).direction)}get highlightColors(){return(0,d.shadow)(this,"highlightColors",this.#dA?new Map(this.#dA.split(",").map(a=>a.split("=").map(a=>a.trim()))):null)}setMainHighlightColorPicker(a){this.#dF=a}editAltText(a){this.#dr?.editAltText(this,a)}onPageChanging({pageNumber:a}){this.#du=a-1}focusMainContainer(){this.#n.focus()}findParent(a,b){for(let c of this.#dq.values()){let{x:d,y:e,width:f,height:g}=c.div.getBoundingClientRect();if(a>=d&&a<=d+f&&b>=e&&b<=e+g)return c}return null}disableUserSelect(a=!1){this.#dW.classList.toggle("noUserSelect",a)}addShouldRescale(a){this.#dx.add(a)}removeShouldRescale(a){this.#dx.delete(a)}onScaleChanging({scale:a}){for(let b of(this.commitOrRemove(),this.viewParameters.realScale=a*e.PixelsPerInch.PDF_TO_CSS_UNITS,this.#dx))b.onScaleChanging()}onRotationChanging({pagesRotation:a}){this.commitOrRemove(),this.viewParameters.rotation=a}addToAnnotationStorage(a){a.isEmpty()||!this.#ds||this.#ds.has(a.id)||this.#ds.setValue(a.id,a)}#dZ(){window.addEventListener("focus",this.#dK),window.addEventListener("blur",this.#dJ)}#dY(){window.removeEventListener("focus",this.#dK),window.removeEventListener("blur",this.#dJ)}blur(){if(!this.hasSelection)return;let{activeElement:a}=document;for(let b of this.#dH)if(b.div.contains(a)){this.#dE=[b,a],b._focusEventsAllowed=!1;break}}focus(){if(!this.#dE)return;let[a,b]=this.#dE;this.#dE=null,b.addEventListener("focusin",()=>{a._focusEventsAllowed=!0},{once:!0}),b.focus()}#d$(){window.addEventListener("keydown",this.#dO)}#dX(){window.removeEventListener("keydown",this.#dO)}#d_(){document.addEventListener("copy",this.#dL),document.addEventListener("cut",this.#dM),document.addEventListener("paste",this.#dN)}#d0(){document.removeEventListener("copy",this.#dL),document.removeEventListener("cut",this.#dM),document.removeEventListener("paste",this.#dN)}addEditListeners(){this.#d$(),this.#d_()}removeEditListeners(){this.#dX(),this.#d0()}copy(a){if(a.preventDefault(),this.#dn?.commitOrRemove(),!this.hasSelection)return;let b=[];for(let a of this.#dH){let c=a.serialize(!0);c&&b.push(c)}0!==b.length&&a.clipboardData.setData("application/pdfjs",JSON.stringify(b))}cut(a){this.copy(a),this.delete()}paste(a){a.preventDefault();let{clipboardData:b}=a;for(let a of b.items)for(let b of this.#ca)if(b.isHandlingMimeForPasting(a.type))return void b.paste(a,this.currentLayer);let c=b.getData("application/pdfjs");if(!c)return;try{c=JSON.parse(c)}catch(a){(0,d.warn)(`paste: "${a.message}".`);return}if(!Array.isArray(c))return;this.unselectAll();let e=this.currentLayer;try{let a=[];for(let b of c){let c=e.deserialize(b);if(!c)return;a.push(c)}let b=()=>{for(let b of a)this.#d1(b);this.#d2(a)};this.addCommands({cmd:b,undo:()=>{for(let b of a)b.remove()},mustExec:!0})}catch(a){(0,d.warn)(`paste: "${a.message}".`)}}keydown(a){this.isEditorHandlingKeyboard||m._keyboardManager.exec(this,a)}onEditingAction(a){["undo","redo","delete","selectAll"].includes(a.name)&&this[a.name]()}#d3(a){Object.entries(a).some(([a,b])=>this.#dT[a]!==b)&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#dT,a)})}#d4(a){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:a})}setEditingState(a){a?(this.#dZ(),this.#d$(),this.#d_(),this.#d3({isEditing:this.#dG!==d.AnnotationEditorType.NONE,isEmpty:this.#d5(),hasSomethingToUndo:this.#dt.hasSomethingToUndo(),hasSomethingToRedo:this.#dt.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#dY(),this.#dX(),this.#d0(),this.#d3({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(a){if(!this.#ca)for(let b of(this.#ca=a,this.#ca))this.#d4(b.defaultPropertiesToUpdate)}getId(){return this.#dB.getId()}get currentLayer(){return this.#dq.get(this.#du)}getLayer(a){return this.#dq.get(a)}get currentPageIndex(){return this.#du}addLayer(a){this.#dq.set(a.pageIndex,a),this.#dC?a.enable():a.disable()}removeLayer(a){this.#dq.delete(a.pageIndex)}updateMode(a,b=null,c=!1){if(this.#dG!==a){if(this.#dG=a,a===d.AnnotationEditorType.NONE){this.setEditingState(!1),this.#d6();return}for(let b of(this.setEditingState(!0),this.#d7(),this.unselectAll(),this.#dq.values()))b.updateMode(a);if(!b&&c)return void this.addNewEditorFromKeyboard();if(b){for(let a of this.#dp.values())if(a.annotationElementId===b){this.setSelected(a),a.enterInEditMode();break}}}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(a){a!==this.#dG&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:a})}updateParams(a,b){if(this.#ca){switch(a){case d.AnnotationEditorParamsType.CREATE:this.currentLayer.addNewEditor();return;case d.AnnotationEditorParamsType.HIGHLIGHT_DEFAULT_COLOR:this.#dF?.updateColor(b)}for(let c of this.#dH)c.updateParams(a,b);for(let c of this.#ca)c.updateDefaultParams(a,b)}}enableWaiting(a=!1){if(this.#dD!==a)for(let b of(this.#dD=a,this.#dq.values()))a?b.disableClick():b.enableClick(),b.div.classList.toggle("waiting",a)}#d7(){if(!this.#dC)for(let a of(this.#dC=!0,this.#dq.values()))a.enable()}#d6(){if(this.unselectAll(),this.#dC)for(let a of(this.#dC=!1,this.#dq.values()))a.disable()}getEditors(a){let b=[];for(let c of this.#dp.values())c.pageIndex===a&&b.push(c);return b}getEditor(a){return this.#dp.get(a)}addEditor(a){this.#dp.set(a.id,a)}removeEditor(a){a.div.contains(document.activeElement)&&(this.#dz&&clearTimeout(this.#dz),this.#dz=setTimeout(()=>{this.focusMainContainer(),this.#dz=null},0)),this.#dp.delete(a.id),this.unselect(a),a.annotationElementId&&this.#dv.has(a.annotationElementId)||this.#ds?.remove(a.id)}addDeletedAnnotationElement(a){this.#dv.add(a.annotationElementId),a.deleted=!0}isDeletedAnnotationElement(a){return this.#dv.has(a)}removeDeletedAnnotationElement(a){this.#dv.delete(a.annotationElementId),a.deleted=!1}#d1(a){let b=this.#dq.get(a.pageIndex);b?b.addOrRebuild(a):this.addEditor(a)}setActiveEditor(a){this.#dn!==a&&(this.#dn=a,a&&this.#d4(a.propertiesToUpdate))}toggleSelected(a){if(this.#dH.has(a)){this.#dH.delete(a),a.unselect(),this.#d3({hasSelectedEditor:this.hasSelection});return}this.#dH.add(a),a.select(),this.#d4(a.propertiesToUpdate),this.#d3({hasSelectedEditor:!0})}setSelected(a){for(let b of this.#dH)b!==a&&b.unselect();this.#dH.clear(),this.#dH.add(a),a.select(),this.#d4(a.propertiesToUpdate),this.#d3({hasSelectedEditor:!0})}isSelected(a){return this.#dH.has(a)}get firstSelectedEditor(){return this.#dH.values().next().value}unselect(a){a.unselect(),this.#dH.delete(a),this.#d3({hasSelectedEditor:this.hasSelection})}get hasSelection(){return 0!==this.#dH.size}get isEnterHandled(){return 1===this.#dH.size&&this.firstSelectedEditor.isEnterHandled}undo(){this.#dt.undo(),this.#d3({hasSomethingToUndo:this.#dt.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#d5()})}redo(){this.#dt.redo(),this.#d3({hasSomethingToUndo:!0,hasSomethingToRedo:this.#dt.hasSomethingToRedo(),isEmpty:this.#d5()})}addCommands(a){this.#dt.add(a),this.#d3({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#d5()})}#d5(){if(0===this.#dp.size)return!0;if(1===this.#dp.size)for(let a of this.#dp.values())return a.isEmpty();return!1}delete(){if(this.commitOrRemove(),!this.hasSelection)return;let a=[...this.#dH],b=()=>{for(let b of a)this.#d1(b)};this.addCommands({cmd:()=>{for(let b of a)b.remove()},undo:b,mustExec:!0})}commitOrRemove(){this.#dn?.commitOrRemove()}hasSomethingToControl(){return this.#dn||this.hasSelection}#d2(a){for(let b of(this.#dH.clear(),a))b.isEmpty()||(this.#dH.add(b),b.select());this.#d3({hasSelectedEditor:!0})}selectAll(){for(let a of this.#dH)a.commit();this.#d2(this.#dp.values())}unselectAll(){if((!this.#dn||(this.#dn.commitOrRemove(),this.#dG===d.AnnotationEditorType.NONE))&&this.hasSelection){for(let a of this.#dH)a.unselect();this.#dH.clear(),this.#d3({hasSelectedEditor:!1})}}translateSelectedEditors(a,b,c=!1){if(c||this.commitOrRemove(),!this.hasSelection)return;this.#dU[0]+=a,this.#dU[1]+=b;let[d,e]=this.#dU,f=[...this.#dH];for(let c of(this.#dV&&clearTimeout(this.#dV),this.#dV=setTimeout(()=>{this.#dV=null,this.#dU[0]=this.#dU[1]=0,this.addCommands({cmd:()=>{for(let a of f)this.#dp.has(a.id)&&a.translateInPage(d,e)},undo:()=>{for(let a of f)this.#dp.has(a.id)&&a.translateInPage(-d,-e)},mustExec:!1})},1e3),f))c.translateInPage(a,b)}setUpDragSession(){if(this.hasSelection)for(let a of(this.disableUserSelect(!0),this.#dw=new Map,this.#dH))this.#dw.set(a,{savedX:a.x,savedY:a.y,savedPageIndex:a.pageIndex,newX:0,newY:0,newPageIndex:-1})}endDragSession(){if(!this.#dw)return!1;this.disableUserSelect(!1);let a=this.#dw;this.#dw=null;let b=!1;for(let[{x:c,y:d,pageIndex:e},f]of a)f.newX=c,f.newY=d,f.newPageIndex=e,b||=c!==f.savedX||d!==f.savedY||e!==f.savedPageIndex;if(!b)return!1;let c=(a,b,c,d)=>{if(this.#dp.has(a.id)){let e=this.#dq.get(d);e?a._setParentAndPosition(e,b,c):(a.pageIndex=d,a.x=b,a.y=c)}};return this.addCommands({cmd:()=>{for(let[b,{newX:d,newY:e,newPageIndex:f}]of a)c(b,d,e,f)},undo:()=>{for(let[b,{savedX:d,savedY:e,savedPageIndex:f}]of a)c(b,d,e,f)},mustExec:!0}),!0}dragSelectedEditors(a,b){if(this.#dw)for(let c of this.#dw.keys())c.drag(a,b)}rebuild(a){if(null===a.parent){let b=this.getLayer(a.pageIndex);b?(b.changeParent(a),b.addOrRebuild(a)):(this.addEditor(a),this.addToAnnotationStorage(a),a.rebuild())}else a.parent.addOrRebuild(a)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||1===this.#dH.size&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(a){return this.#dn===a}getActive(){return this.#dn}getMode(){return this.#dG}get imageManager(){return(0,d.shadow)(this,"imageManager",new i)}}},171:(a,b,c)=>{c.d(b,{PDFFetchStream:()=>i});var d=c(266),e=c(253);function f(a,b,c){return{method:"GET",headers:a,signal:c.signal,mode:"cors",credentials:b?"include":"same-origin",redirect:"follow"}}function g(a){let b=new Headers;for(let c in a){let d=a[c];void 0!==d&&b.append(c,d)}return b}function h(a){return a instanceof Uint8Array?a.buffer:a instanceof ArrayBuffer?a:((0,d.warn)(`getArrayBuffer - unexpected data format: ${a}`),new Uint8Array(a).buffer)}class i{constructor(a){this.source=a,this.isHttp=/^https?:/i.test(a.url),this.httpHeaders=this.isHttp&&a.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,d.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new j(this),this._fullRequestReader}getRangeReader(a,b){if(b<=this._progressiveDataLength)return null;let c=new k(this,a,b);return this._rangeRequestReaders.push(c),c}cancelAllRequests(a){for(let b of(this._fullRequestReader?.cancel(a),this._rangeRequestReaders.slice(0)))b.cancel(a)}}class j{constructor(a){this._stream=a,this._reader=null,this._loaded=0,this._filename=null;const b=a.source;this._withCredentials=b.withCredentials||!1,this._contentLength=b.length,this._headersCapability=new d.PromiseCapability,this._disableRange=b.disableRange||!1,this._rangeChunkSize=b.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!b.disableStream,this._isRangeSupported=!b.disableRange,this._headers=g(this._stream.httpHeaders);const c=b.url;fetch(c,f(this._headers,this._withCredentials,this._abortController)).then(a=>{if(!(0,e.validateResponseStatus)(a.status))throw(0,e.createResponseStatusError)(a.status,c);this._reader=a.body.getReader(),this._headersCapability.resolve();let b=b=>a.headers.get(b),{allowRangeRequests:f,suggestedLength:g}=(0,e.validateRangeRequestCapabilities)({getResponseHeader:b,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=f,this._contentLength=g||this._contentLength,this._filename=(0,e.extractFilenameFromHeader)(b),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new d.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;let{value:a,done:b}=await this._reader.read();return b?{value:a,done:b}:(this._loaded+=a.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:h(a),done:!1})}cancel(a){this._reader?.cancel(a),this._abortController.abort()}}class k{constructor(a,b,c){this._stream=a,this._reader=null,this._loaded=0;const h=a.source;this._withCredentials=h.withCredentials||!1,this._readCapability=new d.PromiseCapability,this._isStreamingSupported=!h.disableStream,this._abortController=new AbortController,this._headers=g(this._stream.httpHeaders),this._headers.append("Range",`bytes=${b}-${c-1}`);const i=h.url;fetch(i,f(this._headers,this._withCredentials,this._abortController)).then(a=>{if(!(0,e.validateResponseStatus)(a.status))throw(0,e.createResponseStatusError)(a.status,i);this._readCapability.resolve(),this._reader=a.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;let{value:a,done:b}=await this._reader.read();return b?{value:a,done:b}:(this._loaded+=a.byteLength,this.onProgress?.({loaded:this._loaded}),{value:h(a),done:!1})}cancel(a){this._reader?.cancel(a),this._abortController.abort()}}},742:(a,b,c)=>{c.d(b,{FontFaceObject:()=>f,FontLoader:()=>e});var d=c(266);class e{#d8=new Set;constructor({ownerDocument:a=globalThis.document,styleElement:b=null}){this._document=a,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(a){this.nativeFontFaces.add(a),this._document.fonts.add(a)}removeNativeFontFace(a){this.nativeFontFaces.delete(a),this._document.fonts.delete(a)}insertRule(a){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));let b=this.styleElement.sheet;b.insertRule(a,b.cssRules.length)}clear(){for(let a of this.nativeFontFaces)this._document.fonts.delete(a);this.nativeFontFaces.clear(),this.#d8.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:a,_inspectFont:b}){if(!(!a||this.#d8.has(a.loadedName))){if((0,d.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){let{loadedName:c,src:e,style:f}=a,g=new FontFace(c,e,f);this.addNativeFontFace(g);try{await g.load(),this.#d8.add(c),b?.(a)}catch{(0,d.warn)(`Cannot load system font: ${a.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(g)}return}(0,d.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(a){if(a.attached||a.missingFile&&!a.systemFontInfo)return;if(a.attached=!0,a.systemFontInfo)return void await this.loadSystemFont(a);if(this.isFontLoadingAPISupported){let b=a.createNativeFontFace();if(b){this.addNativeFontFace(b);try{await b.loaded}catch(c){throw(0,d.warn)(`Failed to load font '${b.family}': '${c}'.`),a.disableFontFace=!0,c}}return}let b=a.createFontFaceRule();if(b){if(this.insertRule(b),this.isSyncFontLoadingSupported)return;await new Promise(b=>{let c=this._queueLoadingCallback(b);this._prepareFontLoadEvent(a,c)})}}get isFontLoadingAPISupported(){let a=!!this._document?.fonts;return(0,d.shadow)(this,"isFontLoadingAPISupported",a)}get isSyncFontLoadingSupported(){let a=!1;return d.isNodeJS?a=!0:"undefined"!=typeof navigator&&"string"==typeof navigator?.userAgent&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent)&&(a=!0),(0,d.shadow)(this,"isSyncFontLoadingSupported",a)}_queueLoadingCallback(a){let{loadingRequests:b}=this,c={done:!1,complete:function(){for((0,d.assert)(!c.done,"completeRequest() cannot be called twice."),c.done=!0;b.length>0&&b[0].done;){let a=b.shift();setTimeout(a.callback,0)}},callback:a};return b.push(c),c}get _loadTestFont(){let a=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,d.shadow)(this,"_loadTestFont",a)}_prepareFontLoadEvent(a,b){let c,e;function f(a,b){return a.charCodeAt(b)<<24|a.charCodeAt(b+1)<<16|a.charCodeAt(b+2)<<8|255&a.charCodeAt(b+3)}function g(a,b,c,d){let e=a.substring(0,b),f=a.substring(b+c);return e+d+f}let h=this._document.createElement("canvas");h.width=1,h.height=1;let i=h.getContext("2d"),j=0,k=`lt${Date.now()}${this.loadTestFontId++}`,l=this._loadTestFont;l=g(l,976,k.length,k);let m=f(l,16);for(c=0,e=k.length-3;c<e;c+=4)m=m-0x58585858+f(k,c)|0;c<k.length&&(m=m-0x58585858+f(k+"XXX",c)|0),l=g(l,16,4,(0,d.string32)(m));let n=`url(data:font/opentype;base64,${btoa(l)});`,o=`@font-face {font-family:"${k}";src:${n}}`;this.insertRule(o);let p=this._document.createElement("div");for(let b of(p.style.visibility="hidden",p.style.width=p.style.height="10px",p.style.position="absolute",p.style.top=p.style.left="0px",[a.loadedName,k])){let a=this._document.createElement("span");a.textContent="Hi",a.style.fontFamily=b,p.append(a)}this._document.body.append(p),function a(b,c){if(++j>30){(0,d.warn)("Load test font never loaded."),c();return}(i.font="30px "+b,i.fillText(".",0,20),i.getImageData(0,0,1,1).data[3]>0)?c():setTimeout(a.bind(null,b,c))}(k,()=>{p.remove(),b.complete()})}}class f{constructor(a,{isEvalSupported:b=!0,disableFontFace:c=!1,ignoreErrors:d=!1,inspectFont:e=null}){for(const b in this.compiledGlyphs=Object.create(null),a)this[b]=a[b];this.isEvalSupported=!1!==b,this.disableFontFace=!0===c,this.ignoreErrors=!0===d,this._inspectFont=e}createNativeFontFace(){let a;if(!this.data||this.disableFontFace)return null;if(this.cssFontInfo){let b={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(b.style=`oblique ${this.cssFontInfo.italicAngle}deg`),a=new FontFace(this.cssFontInfo.fontFamily,this.data,b)}else a=new FontFace(this.loadedName,this.data,{});return this._inspectFont?.(this),a}createFontFaceRule(){let a;if(!this.data||this.disableFontFace)return null;let b=(0,d.bytesToString)(this.data),c=`url(data:${this.mimetype};base64,${btoa(b)});`;if(this.cssFontInfo){let b=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(b+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),a=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${b}src:${c}}`}else a=`@font-face {font-family:"${this.loadedName}";src:${c}}`;return this._inspectFont?.(this,c),a}getPathGenerator(a,b){let c;if(void 0!==this.compiledGlyphs[b])return this.compiledGlyphs[b];try{c=a.get(this.loadedName+"_path_"+b)}catch(a){if(!this.ignoreErrors)throw a;return(0,d.warn)(`getPathGenerator - ignoring character: "${a}".`),this.compiledGlyphs[b]=function(a,b){}}if(this.isEvalSupported&&d.FeatureTest.isEvalSupported){let a=[];for(let b of c){let c=void 0!==b.args?b.args.join(","):"";a.push("c.",b.cmd,"(",c,");\n")}return this.compiledGlyphs[b]=Function("c","size",a.join(""))}return this.compiledGlyphs[b]=function(a,b){for(let d of c)"scale"===d.cmd&&(d.args=[b,-b]),a[d.cmd].apply(a,d.args)}}}},472:(a,b,c)=>{c.d(b,{Metadata:()=>e});var d=c(266);class e{#d9;#ea;constructor({parsedData:a,rawData:b}){this.#d9=a,this.#ea=b}getRaw(){return this.#ea}get(a){return this.#d9.get(a)??null}getAll(){return(0,d.objectFromMap)(this.#d9)}has(a){return this.#d9.has(a)}}},474:(a,b,c)=>{c.d(b,{PDFNetworkStream:()=>g});var d=c(266),e=c(253);class f{constructor(a,b={}){this.url=a,this.isHttp=/^https?:/i.test(a),this.httpHeaders=this.isHttp&&b.httpHeaders||Object.create(null),this.withCredentials=b.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(a,b,c){let d={begin:a,end:b};for(let a in c)d[a]=c[a];return this.request(d)}requestFull(a){return this.request(a)}request(a){let b=new XMLHttpRequest,c=this.currXhrId++,d=this.pendingRequests[c]={xhr:b};for(let a in b.open("GET",this.url),b.withCredentials=this.withCredentials,this.httpHeaders){let c=this.httpHeaders[a];void 0!==c&&b.setRequestHeader(a,c)}return this.isHttp&&"begin"in a&&"end"in a?(b.setRequestHeader("Range",`bytes=${a.begin}-${a.end-1}`),d.expectedStatus=206):d.expectedStatus=200,b.responseType="arraybuffer",a.onError&&(b.onerror=function(c){a.onError(b.status)}),b.onreadystatechange=this.onStateChange.bind(this,c),b.onprogress=this.onProgress.bind(this,c),d.onHeadersReceived=a.onHeadersReceived,d.onDone=a.onDone,d.onError=a.onError,d.onProgress=a.onProgress,b.send(null),c}onProgress(a,b){let c=this.pendingRequests[a];c&&c.onProgress?.(b)}onStateChange(a,b){let c,e=this.pendingRequests[a];if(!e)return;let f=e.xhr;if(f.readyState>=2&&e.onHeadersReceived&&(e.onHeadersReceived(),delete e.onHeadersReceived),4!==f.readyState||!(a in this.pendingRequests))return;if(delete this.pendingRequests[a],0===f.status&&this.isHttp)return void e.onError?.(f.status);let g=f.status||200;if((200!==g||206!==e.expectedStatus)&&g!==e.expectedStatus)return void e.onError?.(f.status);let h=(c=f.response,"string"!=typeof c?c:(0,d.stringToBytes)(c).buffer);if(206===g){let a=f.getResponseHeader("Content-Range"),b=/bytes (\d+)-(\d+)\/(\d+)/.exec(a);e.onDone({begin:parseInt(b[1],10),chunk:h})}else h?e.onDone({begin:0,chunk:h}):e.onError?.(f.status)}getRequestXhr(a){return this.pendingRequests[a].xhr}isPendingRequest(a){return a in this.pendingRequests}abortRequest(a){let b=this.pendingRequests[a].xhr;delete this.pendingRequests[a],b.abort()}}class g{constructor(a){this._source=a,this._manager=new f(a.url,{httpHeaders:a.httpHeaders,withCredentials:a.withCredentials}),this._rangeChunkSize=a.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(a){let b=this._rangeRequestReaders.indexOf(a);b>=0&&this._rangeRequestReaders.splice(b,1)}getFullReader(){return(0,d.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new h(this._manager,this._source),this._fullRequestReader}getRangeReader(a,b){let c=new i(this._manager,a,b);return c.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(c),c}cancelAllRequests(a){for(let b of(this._fullRequestReader?.cancel(a),this._rangeRequestReaders.slice(0)))b.cancel(a)}}class h{constructor(a,b){this._manager=a;const c={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=b.url,this._fullRequestId=a.requestFull(c),this._headersReceivedCapability=new d.PromiseCapability,this._disableRange=b.disableRange||!1,this._contentLength=b.length,this._rangeChunkSize=b.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){let a=this._fullRequestId,b=this._manager.getRequestXhr(a),c=a=>b.getResponseHeader(a),{allowRangeRequests:d,suggestedLength:f}=(0,e.validateRangeRequestCapabilities)({getResponseHeader:c,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});d&&(this._isRangeSupported=!0),this._contentLength=f||this._contentLength,this._filename=(0,e.extractFilenameFromHeader)(c),this._isRangeSupported&&this._manager.abortRequest(a),this._headersReceivedCapability.resolve()}_onDone(a){if(a&&(this._requests.length>0?this._requests.shift().resolve({value:a.chunk,done:!1}):this._cachedChunks.push(a.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(let a of this._requests)a.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(a){for(let b of(this._storedError=(0,e.createResponseStatusError)(a,this._url),this._headersReceivedCapability.reject(this._storedError),this._requests))b.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(a){this.onProgress?.({loaded:a.loaded,total:a.lengthComputable?a.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let a=new d.PromiseCapability;return this._requests.push(a),a.promise}cancel(a){for(let b of(this._done=!0,this._headersReceivedCapability.reject(a),this._requests))b.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class i{constructor(a,b,c){this._manager=a;const d={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=a.url,this._requestId=a.requestRange(b,c,d),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){this.onClosed?.(this)}_onDone(a){let b=a.chunk;for(let a of(this._requests.length>0?this._requests.shift().resolve({value:b,done:!1}):this._queuedChunk=b,this._done=!0,this._requests))a.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(a){for(let b of(this._storedError=(0,e.createResponseStatusError)(a,this._url),this._requests))b.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(a){this.isStreamingSupported||this.onProgress?.({loaded:a.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(null!==this._queuedChunk){let a=this._queuedChunk;return this._queuedChunk=null,{value:a,done:!1}}if(this._done)return{value:void 0,done:!0};let a=new d.PromiseCapability;return this._requests.push(a),a.promise}cancel(a){for(let a of(this._done=!0,this._requests))a.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},253:(a,b,c)=>{c.d(b,{createResponseStatusError:()=>h,extractFilenameFromHeader:()=>g,validateRangeRequestCapabilities:()=>f,validateResponseStatus:()=>i});var d=c(266),e=c(473);function f({getResponseHeader:a,isHttp:b,rangeChunkSize:c,disableRange:d}){let e={allowRangeRequests:!1,suggestedLength:void 0},f=parseInt(a("Content-Length"),10);if(!Number.isInteger(f)||(e.suggestedLength=f,f<=2*c||d||!b||"bytes"!==a("Accept-Ranges")))return e;let g=a("Content-Encoding")||"identity";return"identity"!==g||(e.allowRangeRequests=!0),e}function g(a){let b=a("Content-Disposition");if(b){let a=function(a){let b=!0,c=e("filename\\*","i").exec(a);if(c){c=c[1];let a=h(c);return a=unescape(a),a=i(a),a=j(a),g(a)}if(c=function(a){let b,c=[],d=e("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;null!==(b=d.exec(a));){let[,a,d,e]=b;if((a=parseInt(a,10))in c){if(0===a)break;continue}c[a]=[d,e]}let f=[];for(let a=0;a<c.length&&a in c;++a){let[b,d]=c[a];d=h(d),b&&(d=unescape(d),0===a&&(d=i(d))),f.push(d)}return f.join("")}(a)){let a=j(c);return g(a)}if(c=e("filename","i").exec(a)){c=c[1];let a=h(c);return a=j(a),g(a)}function e(a,b){return RegExp("(?:^|;)\\s*"+a+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',b)}function f(a,c){if(a){if(!/^[\x00-\xFF]+$/.test(c))return c;try{let e=new TextDecoder(a,{fatal:!0}),f=(0,d.stringToBytes)(c);c=e.decode(f),b=!1}catch{}}return c}function g(a){return b&&/[\x80-\xff]/.test(a)&&(a=f("utf-8",a),b&&(a=f("iso-8859-1",a))),a}function h(a){if(a.startsWith('"')){let b=a.slice(1).split('\\"');for(let a=0;a<b.length;++a){let c=b[a].indexOf('"');-1!==c&&(b[a]=b[a].slice(0,c),b.length=a+1),b[a]=b[a].replaceAll(/\\(.)/g,"$1")}a=b.join('"')}return a}function i(a){let b=a.indexOf("'");if(-1===b)return a;let c=a.slice(0,b),d=a.slice(b+1).replace(/^[^']*'/,"");return f(c,d)}function j(a){return!a.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(a)?a:a.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(a,b,c,d){if("q"===c||"Q"===c)return d=(d=d.replaceAll("_"," ")).replaceAll(/=([0-9a-fA-F]{2})/g,function(a,b){return String.fromCharCode(parseInt(b,16))}),f(b,d);try{d=atob(d)}catch{}return f(b,d)})}return""}(b);if(a.includes("%"))try{a=decodeURIComponent(a)}catch{}if((0,e.isPdfFile)(a))return a}return null}function h(a,b){return 404===a||0===a&&b.startsWith("file:")?new d.MissingPDFException('Missing PDF "'+b+'".'):new d.UnexpectedResponseException(`Unexpected server response (${a}) while retrieving PDF "${b}".`,a)}function i(a){return 200===a||206===a}},498:(a,b,c)=>{c.a(a,async(a,d)=>{try{let a,h,i,j;c.d(b,{PDFNodeStream:()=>l});var e=c(266),f=c(253);e.isNodeJS&&(a=await import("fs"),h=await import("http"),i=await import("https"),j=await import("url"));let k=/^file:\/\/\/[a-zA-Z]:\//;class l{constructor(a){this.source=a,this.url=function(a){let b=j.parse(a);return"file:"===b.protocol||b.host?b:/^[a-z]:[/\\]/i.test(a)?j.parse(`file:///${a}`):(b.host||(b.protocol="file:"),b)}(a.url),this.isHttp="http:"===this.url.protocol||"https:"===this.url.protocol,this.isFsUrl="file:"===this.url.protocol,this.httpHeaders=this.isHttp&&a.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return(0,e.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new q(this):new o(this),this._fullRequestReader}getRangeReader(a,b){if(b<=this._progressiveDataLength)return null;let c=this.isFsUrl?new r(this,a,b):new p(this,a,b);return this._rangeRequestReaders.push(c),c}cancelAllRequests(a){for(let b of(this._fullRequestReader?.cancel(a),this._rangeRequestReaders.slice(0)))b.cancel(a)}}class m{constructor(a){this._url=a.url,this._done=!1,this._storedError=null,this.onProgress=null;const b=a.source;this._contentLength=b.length,this._loaded=0,this._filename=null,this._disableRange=b.disableRange||!1,this._rangeChunkSize=b.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!b.disableStream,this._isRangeSupported=!b.disableRange,this._readableStream=null,this._readCapability=new e.PromiseCapability,this._headersCapability=new e.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let a=this._readableStream.read();return null===a?(this._readCapability=new e.PromiseCapability,this.read()):(this._loaded+=a.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(a).buffer,done:!1})}cancel(a){this._readableStream?this._readableStream.destroy(a):this._error(a)}_error(a){this._storedError=a,this._readCapability.resolve()}_setReadableStream(a){this._readableStream=a,a.on("readable",()=>{this._readCapability.resolve()}),a.on("end",()=>{a.destroy(),this._done=!0,this._readCapability.resolve()}),a.on("error",a=>{this._error(a)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new e.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class n{constructor(a){this._url=a.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new e.PromiseCapability;const b=a.source;this._isStreamingSupported=!b.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;let a=this._readableStream.read();return null===a?(this._readCapability=new e.PromiseCapability,this.read()):(this._loaded+=a.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(a).buffer,done:!1})}cancel(a){this._readableStream?this._readableStream.destroy(a):this._error(a)}_error(a){this._storedError=a,this._readCapability.resolve()}_setReadableStream(a){this._readableStream=a,a.on("readable",()=>{this._readCapability.resolve()}),a.on("end",()=>{a.destroy(),this._done=!0,this._readCapability.resolve()}),a.on("error",a=>{this._error(a)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function g(a,b){return{protocol:a.protocol,auth:a.auth,host:a.hostname,port:a.port,path:a.path,method:"GET",headers:b}}class o extends m{constructor(a){super(a);const b=b=>{if(404===b.statusCode){let a=new e.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=a,this._headersCapability.reject(a);return}this._headersCapability.resolve(),this._setReadableStream(b);let c=a=>this._readableStream.headers[a.toLowerCase()],{allowRangeRequests:d,suggestedLength:g}=(0,f.validateRangeRequestCapabilities)({getResponseHeader:c,isHttp:a.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=d,this._contentLength=g||this._contentLength,this._filename=(0,f.extractFilenameFromHeader)(c)};this._request=null,"http:"===this._url.protocol?this._request=h.request(g(this._url,a.httpHeaders),b):this._request=i.request(g(this._url,a.httpHeaders),b),this._request.on("error",a=>{this._storedError=a,this._headersCapability.reject(a)}),this._request.end()}}class p extends n{constructor(a,b,c){for(const b in super(a),this._httpHeaders={},a.httpHeaders){const c=a.httpHeaders[b];void 0!==c&&(this._httpHeaders[b]=c)}this._httpHeaders.Range=`bytes=${b}-${c-1}`;const d=a=>{if(404===a.statusCode){let a=new e.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=a;return}this._setReadableStream(a)};this._request=null,"http:"===this._url.protocol?this._request=h.request(g(this._url,this._httpHeaders),d):this._request=i.request(g(this._url,this._httpHeaders),d),this._request.on("error",a=>{this._storedError=a}),this._request.end()}}class q extends m{constructor(b){super(b);let c=decodeURIComponent(this._url.path);k.test(this._url.href)&&(c=c.replace(/^\//,"")),a.lstat(c,(b,d)=>{if(b){"ENOENT"===b.code&&(b=new e.MissingPDFException(`Missing PDF "${c}".`)),this._storedError=b,this._headersCapability.reject(b);return}this._contentLength=d.size,this._setReadableStream(a.createReadStream(c)),this._headersCapability.resolve()})}}class r extends n{constructor(b,c,d){super(b);let e=decodeURIComponent(this._url.path);k.test(this._url.href)&&(e=e.replace(/^\//,"")),this._setReadableStream(a.createReadStream(e,{start:c,end:d-1}))}}d()}catch(a){d(a)}},1)},738:(a,b,c)=>{c.a(a,async(a,d)=>{try{let a,f;c.d(b,{NodeCMapReaderFactory:()=>j,NodeCanvasFactory:()=>i,NodeFilterFactory:()=>h,NodeStandardFontDataFactory:()=>k});var e=c(822);if(c(266).isNodeJS){a=await import("fs");try{f=await import("canvas")}catch{}try{await import("path2d-polyfill")}catch{}}let g=function(b){return new Promise((c,d)=>{a.readFile(b,(a,b)=>{a||!b?d(Error(a)):c(new Uint8Array(b))})})};class h extends e.BaseFilterFactory{}class i extends e.BaseCanvasFactory{_createCanvas(a,b){return f.createCanvas(a,b)}}class j extends e.BaseCMapReaderFactory{_fetchData(a,b){return g(a).then(a=>({cMapData:a,compressionType:b}))}}class k extends e.BaseStandardFontDataFactory{_fetchData(a){return g(a)}}d()}catch(a){d(a)}},1)},890:(a,b,c)=>{c.d(b,{OptionalContentConfig:()=>h});var d=c(266),e=c(825);let f=Symbol("INTERNAL");class g{#eb=!0;constructor(a,b){this.name=a,this.intent=b}get visible(){return this.#eb}_setVisible(a,b){a!==f&&(0,d.unreachable)("Internal method `_setVisible` called."),this.#eb=b}}class h{#ec=null;#ed=new Map;#ee=null;#ef=null;constructor(a){if(this.name=null,this.creator=null,null===a)return;for(const b of(this.name=a.name,this.creator=a.creator,this.#ef=a.order,a.groups))this.#ed.set(b.id,new g(b.name,b.intent));if("OFF"===a.baseState)for(const a of this.#ed.values())a._setVisible(f,!1);for(const b of a.on)this.#ed.get(b)._setVisible(f,!0);for(const b of a.off)this.#ed.get(b)._setVisible(f,!1);this.#ee=this.getHash()}#eg(a){let b=a.length;if(b<2)return!0;let c=a[0];for(let e=1;e<b;e++){let b,f=a[e];if(Array.isArray(f))b=this.#eg(f);else{if(!this.#ed.has(f))return(0,d.warn)(`Optional content group not found: ${f}`),!0;b=this.#ed.get(f).visible}switch(c){case"And":if(!b)return!1;break;case"Or":if(b)return!0;break;case"Not":return!b;default:return!0}}return"And"===c}isVisible(a){if(0===this.#ed.size)return!0;if(!a)return(0,d.warn)("Optional content group not defined."),!0;if("OCG"===a.type)return this.#ed.has(a.id)?this.#ed.get(a.id).visible:((0,d.warn)(`Optional content group not found: ${a.id}`),!0);if("OCMD"===a.type){if(a.expression)return this.#eg(a.expression);if(a.policy&&"AnyOn"!==a.policy){if("AllOn"===a.policy){for(let b of a.ids){if(!this.#ed.has(b)){(0,d.warn)(`Optional content group not found: ${b}`);break}if(!this.#ed.get(b).visible)return!1}return!0}else if("AnyOff"===a.policy){for(let b of a.ids){if(!this.#ed.has(b))return(0,d.warn)(`Optional content group not found: ${b}`),!0;if(!this.#ed.get(b).visible)return!0}return!1}else if("AllOff"===a.policy){for(let b of a.ids){if(!this.#ed.has(b)){(0,d.warn)(`Optional content group not found: ${b}`);break}if(this.#ed.get(b).visible)return!1}return!0}}else{for(let b of a.ids){if(!this.#ed.has(b))return(0,d.warn)(`Optional content group not found: ${b}`),!0;if(this.#ed.get(b).visible)return!0}return!1}return(0,d.warn)(`Unknown optional content policy ${a.policy}.`),!0}return(0,d.warn)(`Unknown group type ${a.type}.`),!0}setVisibility(a,b=!0){this.#ed.has(a)?(this.#ed.get(a)._setVisible(f,!!b),this.#ec=null):(0,d.warn)(`Optional content group not found: ${a}`)}get hasInitialVisibility(){return null===this.#ee||this.getHash()===this.#ee}getOrder(){return this.#ed.size?this.#ef?this.#ef.slice():[...this.#ed.keys()]:null}getGroups(){return this.#ed.size>0?(0,d.objectFromMap)(this.#ed):null}getGroup(a){return this.#ed.get(a)||null}getHash(){if(null!==this.#ec)return this.#ec;let a=new e.MurmurHash3_64;for(let[b,c]of this.#ed)a.update(`${b}:${c.visible}`);return this.#ec=a.hexdigest()}}},739:(a,b,c)=>{c.d(b,{renderTextLayer:()=>j,updateTextLayer:()=>k});var d=c(266),e=c(473);let f=new Map;function g(a,b){let c;if(b&&d.FeatureTest.isOffscreenCanvasSupported)c=new OffscreenCanvas(a,a).getContext("2d",{alpha:!1});else{let b=document.createElement("canvas");b.width=b.height=a,c=b.getContext("2d",{alpha:!1})}return c}function h(a){let{div:b,scale:c,properties:d,ctx:e,prevFontSize:f,prevFontFamily:g}=a,{style:h}=b,i="";if(0!==d.canvasWidth&&d.hasText){let{fontFamily:j}=h,{canvasWidth:k,fontSize:l}=d;(f!==l||g!==j)&&(e.font=`${l*c}px ${j}`,a.prevFontSize=l,a.prevFontFamily=j);let{width:m}=e.measureText(b.textContent);m>0&&(i=`scaleX(${k*c/m})`)}0!==d.angle&&(i=`rotate(${d.angle}deg) ${i}`),i.length>0&&(h.transform=i)}class i{constructor({textContentSource:a,container:b,viewport:c,textDivs:f,textDivProperties:h,textContentItemsStr:i,isOffscreenCanvasSupported:j}){this._textContentSource=a,this._isReadableStream=a instanceof ReadableStream,this._container=this._rootContainer=b,this._textDivs=f||[],this._textContentItemsStr=i||[],this._isOffscreenCanvasSupported=j,this._fontInspectorEnabled=!!globalThis.FontInspector?.enabled,this._reader=null,this._textDivProperties=h||new WeakMap,this._canceled=!1,this._capability=new d.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:c.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:g(0,j)};const{pageWidth:k,pageHeight:l,pageX:m,pageY:n}=c.rawDims;this._transform=[1,0,0,-1,-m,n+l],this._pageWidth=k,this._pageHeight=l,(0,e.setLayerDimensions)(b,c),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new d.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new d.AbortException("TextLayer task cancelled."))}_processItems(a,b){for(let c of a){if(void 0===c.str){if("beginMarkedContentProps"===c.type||"beginMarkedContent"===c.type){let a=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),null!==c.id&&this._container.setAttribute("id",`${c.id}`),a.append(this._container)}else"endMarkedContent"===c.type&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(c.str),function(a,b,c){let e,h,i=document.createElement("span"),j={angle:0,canvasWidth:0,hasText:""!==b.str,hasEOL:b.hasEOL,fontSize:0};a._textDivs.push(i);let k=d.Util.transform(a._transform,b.transform),l=Math.atan2(k[1],k[0]),m=c[b.fontName];m.vertical&&(l+=Math.PI/2);let n=a._fontInspectorEnabled&&m.fontSubstitution||m.fontFamily,o=Math.hypot(k[2],k[3]),p=o*function(a,b){let c=f.get(a);if(c)return c;let d=g(30,b);d.font=`30px ${a}`;let e=d.measureText(""),h=e.fontBoundingBoxAscent,i=Math.abs(e.fontBoundingBoxDescent);if(h){let b=h/(h+i);return f.set(a,b),d.canvas.width=d.canvas.height=0,b}d.strokeStyle="red",d.clearRect(0,0,30,30),d.strokeText("g",0,0);let j=d.getImageData(0,0,30,30).data;i=0;for(let a=j.length-1-3;a>=0;a-=4)if(j[a]>0){i=Math.ceil(a/4/30);break}d.clearRect(0,0,30,30),d.strokeText("A",0,30),j=d.getImageData(0,0,30,30).data,h=0;for(let a=0,b=j.length;a<b;a+=4)if(j[a]>0){h=30-Math.floor(a/4/30);break}if(d.canvas.width=d.canvas.height=0,h){let b=h/(h+i);return f.set(a,b),b}return f.set(a,.8),.8}(n,a._isOffscreenCanvasSupported);0===l?(e=k[4],h=k[5]-p):(e=k[4]+p*Math.sin(l),h=k[5]-p*Math.cos(l));let q="calc(var(--scale-factor)*",r=i.style;a._container===a._rootContainer?(r.left=`${(100*e/a._pageWidth).toFixed(2)}%`,r.top=`${(100*h/a._pageHeight).toFixed(2)}%`):(r.left=`${q}${e.toFixed(2)}px)`,r.top=`${q}${h.toFixed(2)}px)`),r.fontSize=`${q}${o.toFixed(2)}px)`,r.fontFamily=n,j.fontSize=o,i.setAttribute("role","presentation"),i.textContent=b.str,i.dir=b.dir,a._fontInspectorEnabled&&(i.dataset.fontName=m.fontSubstitutionLoadedName||b.fontName),0!==l&&(j.angle=180/Math.PI*l);let s=!1;if(b.str.length>1)s=!0;else if(" "!==b.str&&b.transform[0]!==b.transform[3]){let a=Math.abs(b.transform[0]),c=Math.abs(b.transform[3]);a!==c&&Math.max(a,c)/Math.min(a,c)>1.5&&(s=!0)}s&&(j.canvasWidth=m.vertical?b.height:b.width),a._textDivProperties.set(i,j),a._isReadableStream&&a._layoutText(i)}(this,c,b)}}_layoutText(a){let b=this._layoutTextParams.properties=this._textDivProperties.get(a);if(this._layoutTextParams.div=a,h(this._layoutTextParams),b.hasText&&this._container.append(a),b.hasEOL){let a=document.createElement("br");a.setAttribute("role","presentation"),this._container.append(a)}}_render(){let a=new d.PromiseCapability,b=Object.create(null);if(this._isReadableStream){let c=()=>{this._reader.read().then(({value:d,done:e})=>{e?a.resolve():(Object.assign(b,d.styles),this._processItems(d.items,b),c())},a.reject)};this._reader=this._textContentSource.getReader(),c()}else if(this._textContentSource){let{items:b,styles:c}=this._textContentSource;this._processItems(b,c),a.resolve()}else throw Error('No "textContentSource" parameter specified.');a.promise.then(()=>{b=null,function(a){if(a._canceled)return;let b=a._textDivs,c=a._capability;if(b.length>1e5)return c.resolve();if(!a._isReadableStream)for(let c of b)a._layoutText(c);c.resolve()}(this)},this._capability.reject)}}function j(a){let b=new i(a);return b._render(),b}function k({container:a,viewport:b,textDivs:c,textDivProperties:d,isOffscreenCanvasSupported:f,mustRotate:i=!0,mustRescale:j=!0}){if(i&&(0,e.setLayerDimensions)(a,{rotation:b.rotation}),j){let a=g(0,f),e=b.scale*(globalThis.devicePixelRatio||1),i={prevFontSize:null,prevFontFamily:null,div:null,scale:e,properties:null,ctx:a};for(let a of c)i.properties=d.get(a),i.div=a,h(i)}}},92:(a,b,c)=>{c.d(b,{PDFDataTransportStream:()=>f});var d=c(266),e=c(473);class f{constructor({length:a,initialData:b,progressiveDone:c=!1,contentDispositionFilename:e=null,disableRange:f=!1,disableStream:g=!1},h){if((0,d.assert)(h,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=c,this._contentDispositionFilename=e,b?.length>0){const a=b instanceof Uint8Array&&b.byteLength===b.buffer.byteLength?b.buffer:new Uint8Array(b).buffer;this._queuedChunks.push(a)}this._pdfDataRangeTransport=h,this._isStreamingSupported=!g,this._isRangeSupported=!f,this._contentLength=a,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((a,b)=>{this._onReceiveData({begin:a,chunk:b})}),this._pdfDataRangeTransport.addProgressListener((a,b)=>{this._onProgress({loaded:a,total:b})}),this._pdfDataRangeTransport.addProgressiveReadListener(a=>{this._onReceiveData({chunk:a})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:a,chunk:b}){let c=b instanceof Uint8Array&&b.byteLength===b.buffer.byteLength?b.buffer:new Uint8Array(b).buffer;if(void 0===a)this._fullRequestReader?this._fullRequestReader._enqueue(c):this._queuedChunks.push(c);else{let b=this._rangeReaders.some(function(b){return b._begin===a&&(b._enqueue(c),!0)});(0,d.assert)(b,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(a){void 0===a.total?this._rangeReaders[0]?.onProgress?.({loaded:a.loaded}):this._fullRequestReader?.onProgress?.({loaded:a.loaded,total:a.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(a){let b=this._rangeReaders.indexOf(a);b>=0&&this._rangeReaders.splice(b,1)}getFullReader(){(0,d.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");let a=this._queuedChunks;return this._queuedChunks=null,new g(this,a,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(a,b){if(b<=this._progressiveDataLength)return null;let c=new h(this,a,b);return this._pdfDataRangeTransport.requestDataRange(a,b),this._rangeReaders.push(c),c}cancelAllRequests(a){for(let b of(this._fullRequestReader?.cancel(a),this._rangeReaders.slice(0)))b.cancel(a);this._pdfDataRangeTransport.abort()}}class g{constructor(a,b,c=!1,d=null){for(const f of(this._stream=a,this._done=c||!1,this._filename=(0,e.isPdfFile)(d)?d:null,this._queuedChunks=b||[],this._loaded=0,this._queuedChunks))this._loaded+=f.byteLength;this._requests=[],this._headersReady=Promise.resolve(),a._fullRequestReader=this,this.onProgress=null}_enqueue(a){this._done||(this._requests.length>0?this._requests.shift().resolve({value:a,done:!1}):this._queuedChunks.push(a),this._loaded+=a.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};let a=new d.PromiseCapability;return this._requests.push(a),a.promise}cancel(a){for(let a of(this._done=!0,this._requests))a.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class h{constructor(a,b,c){this._stream=a,this._begin=b,this._end=c,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(a){if(!this._done){if(0===this._requests.length)this._queuedChunk=a;else{for(let b of(this._requests.shift().resolve({value:a,done:!1}),this._requests))b.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){let a=this._queuedChunk;return this._queuedChunk=null,{value:a,done:!1}}if(this._done)return{value:void 0,done:!0};let a=new d.PromiseCapability;return this._requests.push(a),a.promise}cancel(a){for(let a of(this._done=!0,this._requests))a.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},368:(a,b,c)=>{c.d(b,{GlobalWorkerOptions:()=>d});let d=Object.create(null);d.workerPort=null,d.workerSrc=""},160:(a,b,c)=>{c.d(b,{XfaLayer:()=>e});var d=c(521);class e{static setupStorage(a,b,c,d,e){let f=d.getValue(b,{value:null});switch(c.name){case"textarea":if(null!==f.value&&(a.textContent=f.value),"print"===e)break;a.addEventListener("input",a=>{d.setValue(b,{value:a.target.value})});break;case"input":if("radio"===c.attributes.type||"checkbox"===c.attributes.type){if(f.value===c.attributes.xfaOn?a.setAttribute("checked",!0):f.value===c.attributes.xfaOff&&a.removeAttribute("checked"),"print"===e)break;a.addEventListener("change",a=>{d.setValue(b,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(null!==f.value&&a.setAttribute("value",f.value),"print"===e)break;a.addEventListener("input",a=>{d.setValue(b,{value:a.target.value})})}break;case"select":if(null!==f.value)for(let b of(a.setAttribute("value",f.value),c.children))b.attributes.value===f.value?b.attributes.selected=!0:b.attributes.hasOwnProperty("selected")&&delete b.attributes.selected;a.addEventListener("input",a=>{let c=a.target.options,e=-1===c.selectedIndex?"":c[c.selectedIndex].value;d.setValue(b,{value:e})})}}static setAttributes({html:a,element:b,storage:c=null,intent:d,linkService:e}){let{attributes:f}=b,g=a instanceof HTMLAnchorElement;for(let[b,c]of("radio"===f.type&&(f.name=`${f.name}-${d}`),Object.entries(f)))if(null!=c)switch(b){case"class":c.length&&a.setAttribute(b,c.join(" "));break;case"dataId":break;case"id":a.setAttribute("data-element-id",c);break;case"style":Object.assign(a.style,c);break;case"textContent":a.textContent=c;break;default:g&&("href"===b||"newWindow"===b)||a.setAttribute(b,c)}g&&e.addLinkAttributes(a,f.href,f.newWindow),c&&f.dataId&&this.setupStorage(a,f.dataId,b,c)}static render(a){let b=a.annotationStorage,c=a.linkService,e=a.xfaHtml,f=a.intent||"display",g=document.createElement(e.name);e.attributes&&this.setAttributes({html:g,element:e,intent:f,linkService:c});let h="richText"!==f,i=a.div;if(i.append(g),a.viewport){let b=`matrix(${a.viewport.transform.join(",")})`;i.style.transform=b}h&&i.setAttribute("class","xfaLayer xfaFont");let j=[];if(0===e.children.length){if(e.value){let a=document.createTextNode(e.value);g.append(a),h&&d.XfaText.shouldBuildText(e.name)&&j.push(a)}return{textDivs:j}}let k=[[e,-1,g]];for(;k.length>0;){let[a,e,g]=k.at(-1);if(e+1===a.children.length){k.pop();continue}let i=a.children[++k.at(-1)[1]];if(null===i)continue;let{name:l}=i;if("#text"===l){let a=document.createTextNode(i.value);j.push(a),g.append(a);continue}let m=i?.attributes?.xmlns?document.createElementNS(i.attributes.xmlns,l):document.createElement(l);if(g.append(m),i.attributes&&this.setAttributes({html:m,element:i,storage:b,intent:f,linkService:c}),i.children?.length>0)k.push([i,-1,m]);else if(i.value){let a=document.createTextNode(i.value);h&&d.XfaText.shouldBuildText(l)&&j.push(a),m.append(a)}}for(let a of i.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))a.setAttribute("readOnly",!0);return{textDivs:j}}static update(a){let b=`matrix(${a.viewport.transform.join(",")})`;a.div.style.transform=b,a.div.hidden=!1}}},521:(a,b,c)=>{c.d(b,{XfaText:()=>d});class d{static textContent(a){let b=[],c={items:b,styles:Object.create(null)};return!function a(c){if(!c)return;let e=null,f=c.name;if("#text"===f)e=c.value;else{if(!d.shouldBuildText(f))return;c?.attributes?.textContent?e=c.attributes.textContent:c.value&&(e=c.value)}if(null!==e&&b.push({str:e}),c.children)for(let b of c.children)a(b)}(a),c}static shouldBuildText(a){return"textarea"!==a&&"input"!==a&&"option"!==a&&"select"!==a}}},907:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{AbortException:()=>e.AbortException,AnnotationEditorLayer:()=>i.AnnotationEditorLayer,AnnotationEditorParamsType:()=>e.AnnotationEditorParamsType,AnnotationEditorType:()=>e.AnnotationEditorType,AnnotationEditorUIManager:()=>j.AnnotationEditorUIManager,AnnotationLayer:()=>k.AnnotationLayer,AnnotationMode:()=>e.AnnotationMode,CMapCompressionType:()=>e.CMapCompressionType,ColorPicker:()=>l.ColorPicker,DOMSVGFactory:()=>g.DOMSVGFactory,DrawLayer:()=>m.DrawLayer,FeatureTest:()=>e.FeatureTest,GlobalWorkerOptions:()=>n.GlobalWorkerOptions,ImageKind:()=>e.ImageKind,InvalidPDFException:()=>e.InvalidPDFException,MissingPDFException:()=>e.MissingPDFException,OPS:()=>e.OPS,Outliner:()=>o.Outliner,PDFDataRangeTransport:()=>f.PDFDataRangeTransport,PDFDateString:()=>g.PDFDateString,PDFWorker:()=>f.PDFWorker,PasswordResponses:()=>e.PasswordResponses,PermissionFlag:()=>e.PermissionFlag,PixelsPerInch:()=>g.PixelsPerInch,PromiseCapability:()=>e.PromiseCapability,RenderingCancelledException:()=>g.RenderingCancelledException,UnexpectedResponseException:()=>e.UnexpectedResponseException,Util:()=>e.Util,VerbosityLevel:()=>e.VerbosityLevel,XfaLayer:()=>p.XfaLayer,build:()=>f.build,createValidAbsoluteUrl:()=>e.createValidAbsoluteUrl,fetchData:()=>g.fetchData,getDocument:()=>f.getDocument,getFilenameFromUrl:()=>g.getFilenameFromUrl,getPdfFilenameFromUrl:()=>g.getPdfFilenameFromUrl,getXfaPageViewport:()=>g.getXfaPageViewport,isDataScheme:()=>g.isDataScheme,isPdfFile:()=>g.isPdfFile,noContextMenu:()=>g.noContextMenu,normalizeUnicode:()=>e.normalizeUnicode,renderTextLayer:()=>h.renderTextLayer,setLayerDimensions:()=>g.setLayerDimensions,shadow:()=>e.shadow,updateTextLayer:()=>h.updateTextLayer,version:()=>f.version});var e=c(266),f=c(406),g=c(473),h=c(739),i=c(629),j=c(812),k=c(640),l=c(97),m=c(423),n=c(368),o=c(405),p=c(160),q=a([f]);f=(q.then?(await q)():q)[0],d()}catch(a){d(a)}})},694:(a,b,c)=>{c.d(b,{MessageHandler:()=>f});var d=c(266);function e(a){switch(!(a instanceof Error||"object"==typeof a&&null!==a)&&(0,d.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),a.name){case"AbortException":return new d.AbortException(a.message);case"MissingPDFException":return new d.MissingPDFException(a.message);case"PasswordException":return new d.PasswordException(a.message,a.code);case"UnexpectedResponseException":return new d.UnexpectedResponseException(a.message,a.status);case"UnknownErrorException":return new d.UnknownErrorException(a.message,a.details);default:return new d.UnknownErrorException(a.message,a.toString())}}class f{constructor(a,b,c){this.sourceName=a,this.targetName=b,this.comObj=c,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=a=>{let b=a.data;if(b.targetName!==this.sourceName)return;if(b.stream)return void this.#eh(b);if(b.callback){let a=b.callbackId,c=this.callbackCapabilities[a];if(!c)throw Error(`Cannot resolve callback ${a}`);if(delete this.callbackCapabilities[a],1===b.callback)c.resolve(b.data);else if(2===b.callback)c.reject(e(b.reason));else throw Error("Unexpected callback case");return}let d=this.actionHandler[b.action];if(!d)throw Error(`Unknown action from worker: ${b.action}`);if(b.callbackId){let a=this.sourceName,f=b.sourceName;new Promise(function(a){a(d(b.data))}).then(function(d){c.postMessage({sourceName:a,targetName:f,callback:1,callbackId:b.callbackId,data:d})},function(d){c.postMessage({sourceName:a,targetName:f,callback:2,callbackId:b.callbackId,reason:e(d)})});return}b.streamId?this.#ei(b):d(b.data)},c.addEventListener("message",this._onComObjOnMessage)}on(a,b){let c=this.actionHandler;if(c[a])throw Error(`There is already an actionName called "${a}"`);c[a]=b}send(a,b,c){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:a,data:b},c)}sendWithPromise(a,b,c){let e=this.callbackId++,f=new d.PromiseCapability;this.callbackCapabilities[e]=f;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:a,callbackId:e,data:b},c)}catch(a){f.reject(a)}return f.promise}sendWithStream(a,b,c,f){let g=this.streamId++,h=this.sourceName,i=this.targetName,j=this.comObj;return new ReadableStream({start:c=>{let e=new d.PromiseCapability;return this.streamControllers[g]={controller:c,startCall:e,pullCall:null,cancelCall:null,isClosed:!1},j.postMessage({sourceName:h,targetName:i,action:a,streamId:g,data:b,desiredSize:c.desiredSize},f),e.promise},pull:a=>{let b=new d.PromiseCapability;return this.streamControllers[g].pullCall=b,j.postMessage({sourceName:h,targetName:i,stream:6,streamId:g,desiredSize:a.desiredSize}),b.promise},cancel:a=>{(0,d.assert)(a instanceof Error,"cancel must have a valid reason");let b=new d.PromiseCapability;return this.streamControllers[g].cancelCall=b,this.streamControllers[g].isClosed=!0,j.postMessage({sourceName:h,targetName:i,stream:1,streamId:g,reason:e(a)}),b.promise}},c)}#ei(a){let b=a.streamId,c=this.sourceName,f=a.sourceName,g=this.comObj,h=this,i=this.actionHandler[a.action],j={enqueue(a,e=1,h){if(this.isCancelled)return;let i=this.desiredSize;this.desiredSize-=e,i>0&&this.desiredSize<=0&&(this.sinkCapability=new d.PromiseCapability,this.ready=this.sinkCapability.promise),g.postMessage({sourceName:c,targetName:f,stream:4,streamId:b,chunk:a},h)},close(){this.isCancelled||(this.isCancelled=!0,g.postMessage({sourceName:c,targetName:f,stream:3,streamId:b}),delete h.streamSinks[b])},error(a){(0,d.assert)(a instanceof Error,"error must have a valid reason"),this.isCancelled||(this.isCancelled=!0,g.postMessage({sourceName:c,targetName:f,stream:5,streamId:b,reason:e(a)}))},sinkCapability:new d.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:a.desiredSize,ready:null};j.sinkCapability.resolve(),j.ready=j.sinkCapability.promise,this.streamSinks[b]=j,new Promise(function(b){b(i(a.data,j))}).then(function(){g.postMessage({sourceName:c,targetName:f,stream:8,streamId:b,success:!0})},function(a){g.postMessage({sourceName:c,targetName:f,stream:8,streamId:b,reason:e(a)})})}#eh(a){let b=a.streamId,c=this.sourceName,f=a.sourceName,g=this.comObj,h=this.streamControllers[b],i=this.streamSinks[b];switch(a.stream){case 8:a.success?h.startCall.resolve():h.startCall.reject(e(a.reason));break;case 7:a.success?h.pullCall.resolve():h.pullCall.reject(e(a.reason));break;case 6:if(!i){g.postMessage({sourceName:c,targetName:f,stream:7,streamId:b,success:!0});break}i.desiredSize<=0&&a.desiredSize>0&&i.sinkCapability.resolve(),i.desiredSize=a.desiredSize,new Promise(function(a){a(i.onPull?.())}).then(function(){g.postMessage({sourceName:c,targetName:f,stream:7,streamId:b,success:!0})},function(a){g.postMessage({sourceName:c,targetName:f,stream:7,streamId:b,reason:e(a)})});break;case 4:if((0,d.assert)(h,"enqueue should have stream controller"),h.isClosed)break;h.controller.enqueue(a.chunk);break;case 3:if((0,d.assert)(h,"close should have stream controller"),h.isClosed)break;h.isClosed=!0,h.controller.close(),this.#ej(h,b);break;case 5:(0,d.assert)(h,"error should have stream controller"),h.controller.error(e(a.reason)),this.#ej(h,b);break;case 2:a.success?h.cancelCall.resolve():h.cancelCall.reject(e(a.reason)),this.#ej(h,b);break;case 1:if(!i)break;new Promise(function(b){b(i.onCancel?.(e(a.reason)))}).then(function(){g.postMessage({sourceName:c,targetName:f,stream:2,streamId:b,success:!0})},function(a){g.postMessage({sourceName:c,targetName:f,stream:2,streamId:b,reason:e(a)})}),i.sinkCapability.reject(e(a.reason)),i.isCancelled=!0,delete this.streamSinks[b];break;default:throw Error("Unexpected stream case")}}async #ej(a,b){await Promise.allSettled([a.startCall?.promise,a.pullCall?.promise,a.cancelCall?.promise]),delete this.streamControllers[b]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}},825:(a,b,c)=>{c.d(b,{MurmurHash3_64:()=>e});var d=c(266);class e{constructor(a){this.h1=a?0|a:0xc3d2e1f0,this.h2=a?0|a:0xc3d2e1f0}update(a){let b,c;if("string"==typeof a){b=new Uint8Array(2*a.length),c=0;for(let d=0,e=a.length;d<e;d++){let e=a.charCodeAt(d);e<=255?b[c++]=e:(b[c++]=e>>>8,b[c++]=255&e)}}else if((0,d.isArrayBuffer)(a))c=(b=a.slice()).byteLength;else throw Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");let e=c>>2,f=c-4*e,g=new Uint32Array(b.buffer,0,e),h=0,i=0,j=this.h1,k=this.h2;for(let a=0;a<e;a++)1&a?(h=0x1b873593*(h=(h=0xcc9e2d51*(h=g[a])&0xffff0000|11601*h&65535)<<15|h>>>17)&0xffff0000|13715*h&65535,j^=h,j=j<<13|j>>>19,j=5*j+0xe6546b64):(i=0x1b873593*(i=(i=0xcc9e2d51*(i=g[a])&0xffff0000|11601*i&65535)<<15|i>>>17)&0xffff0000|13715*i&65535,k^=i,k=k<<13|k>>>19,k=5*k+0xe6546b64);switch(h=0,f){case 3:h^=b[4*e+2]<<16;case 2:h^=b[4*e+1]<<8;case 1:h^=b[4*e],h=0x1b873593*(h=(h=0xcc9e2d51*h&0xffff0000|11601*h&65535)<<15|h>>>17)&0xffff0000|13715*h&65535,1&e?j^=h:k^=h}this.h1=j,this.h2=k}hexdigest(){let a=this.h1,b=this.h2;return a^=b>>>1,a=0xed558ccd*a&0xffff0000|36045*a&65535,b=0xff51afd7*b&0xffff0000|((b<<16|a>>>16)*0xafd7ed55&0xffff0000)>>>16,a^=b>>>1,a=0x1a85ec53*a&0xffff0000|60499*a&65535,b=0xc4ceb9fe*b&0xffff0000|((b<<16|a>>>16)*0xb9fe1a85&0xffff0000)>>>16,((a^=b>>>1)>>>0).toString(16).padStart(8,"0")+(b>>>0).toString(16).padStart(8,"0")}}},266:(a,b,c)=>{c.d(b,{AbortException:()=>M,AnnotationBorderStyleType:()=>r,AnnotationEditorParamsType:()=>m,AnnotationEditorPrefix:()=>k,AnnotationEditorType:()=>l,AnnotationMode:()=>j,AnnotationPrefix:()=>$,AnnotationType:()=>q,BaseException:()=>F,CMapCompressionType:()=>t,FONT_IDENTITY_MATRIX:()=>f,FeatureTest:()=>R,FormatError:()=>L,IDENTITY_MATRIX:()=>e,ImageKind:()=>p,InvalidPDFException:()=>I,LINE_FACTOR:()=>h,MAX_IMAGE_SIZE_TO_CACHE:()=>g,MissingPDFException:()=>J,OPS:()=>u,PasswordException:()=>G,PasswordResponses:()=>v,PermissionFlag:()=>n,PromiseCapability:()=>V,RenderingIntentFlag:()=>i,TextRenderingMode:()=>o,UnexpectedResponseException:()=>K,UnknownErrorException:()=>H,Util:()=>T,VerbosityLevel:()=>s,assert:()=>C,bytesToString:()=>N,createValidAbsoluteUrl:()=>D,getUuid:()=>Z,getVerbosityLevel:()=>y,info:()=>z,isArrayBuffer:()=>U,isNodeJS:()=>d,normalizeUnicode:()=>Y,objectFromMap:()=>Q,setVerbosityLevel:()=>x,shadow:()=>E,string32:()=>P,stringToBytes:()=>O,unreachable:()=>B,warn:()=>A});let d="object"==typeof process&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&"browser"!==process.type),e=[1,0,0,1,0,0],f=[.001,0,0,.001,0,0],g=1e7,h=1.35,i={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256},j={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},k="pdfjs_internal_editor_",l={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},m={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32},n={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},o={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},p={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},q={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},r={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},s={ERRORS:0,WARNINGS:1,INFOS:5},t={NONE:0,BINARY:1},u={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},v={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},w=s.WARNINGS;function x(a){Number.isInteger(a)&&(w=a)}function y(){return w}function z(a){w>=s.INFOS&&console.log(`Info: ${a}`)}function A(a){w>=s.WARNINGS&&console.log(`Warning: ${a}`)}function B(a){throw Error(a)}function C(a,b){a||B(b)}function D(a,b=null,c=null){if(!a)return null;try{if(c&&"string"==typeof a){if(c.addDefaultProtocol&&a.startsWith("www.")){let b=a.match(/\./g);b?.length>=2&&(a=`http://${a}`)}if(c.tryConvertEncoding)try{var d;d=a,a=decodeURIComponent(escape(d))}catch{}}let e=b?new URL(a,b):new URL(a);if(function(a){switch(a?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}(e))return e}catch{}return null}function E(a,b,c,d=!1){return Object.defineProperty(a,b,{value:c,enumerable:!d,configurable:!0,writable:!1}),c}let F=function(){function a(b,c){this.constructor===a&&B("Cannot initialize BaseException."),this.message=b,this.name=c}return a.prototype=Error(),a.constructor=a,a}();class G extends F{constructor(a,b){super(a,"PasswordException"),this.code=b}}class H extends F{constructor(a,b){super(a,"UnknownErrorException"),this.details=b}}class I extends F{constructor(a){super(a,"InvalidPDFException")}}class J extends F{constructor(a){super(a,"MissingPDFException")}}class K extends F{constructor(a,b){super(a,"UnexpectedResponseException"),this.status=b}}class L extends F{constructor(a){super(a,"FormatError")}}class M extends F{constructor(a){super(a,"AbortException")}}function N(a){("object"!=typeof a||a?.length===void 0)&&B("Invalid argument for bytesToString");let b=a.length;if(b<8192)return String.fromCharCode.apply(null,a);let c=[];for(let d=0;d<b;d+=8192){let e=Math.min(d+8192,b),f=a.subarray(d,e);c.push(String.fromCharCode.apply(null,f))}return c.join("")}function O(a){"string"!=typeof a&&B("Invalid argument for stringToBytes");let b=a.length,c=new Uint8Array(b);for(let d=0;d<b;++d)c[d]=255&a.charCodeAt(d);return c}function P(a){return String.fromCharCode(a>>24&255,a>>16&255,a>>8&255,255&a)}function Q(a){let b=Object.create(null);for(let[c,d]of a)b[c]=d;return b}class R{static get isLittleEndian(){let a,b;return E(this,"isLittleEndian",((a=new Uint8Array(4))[0]=1,b=new Uint32Array(a.buffer,0,1),1===b[0]))}static get isEvalSupported(){return E(this,"isEvalSupported",function(){try{return Function(""),!0}catch{return!1}}())}static get isOffscreenCanvasSupported(){return E(this,"isOffscreenCanvasSupported","undefined"!=typeof OffscreenCanvas)}static get platform(){return"undefined"!=typeof navigator&&"string"==typeof navigator?.platform?E(this,"platform",{isMac:navigator.platform.includes("Mac")}):E(this,"platform",{isMac:!1})}static get isCSSRoundSupported(){return E(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}let S=[...Array(256).keys()].map(a=>a.toString(16).padStart(2,"0"));class T{static makeHexColor(a,b,c){return`#${S[a]}${S[b]}${S[c]}`}static scaleMinMax(a,b){let c;a[0]?(a[0]<0&&(c=b[0],b[0]=b[1],b[1]=c),b[0]*=a[0],b[1]*=a[0],a[3]<0&&(c=b[2],b[2]=b[3],b[3]=c),b[2]*=a[3],b[3]*=a[3]):(c=b[0],b[0]=b[2],b[2]=c,c=b[1],b[1]=b[3],b[3]=c,a[1]<0&&(c=b[2],b[2]=b[3],b[3]=c),b[2]*=a[1],b[3]*=a[1],a[2]<0&&(c=b[0],b[0]=b[1],b[1]=c),b[0]*=a[2],b[1]*=a[2]),b[0]+=a[4],b[1]+=a[4],b[2]+=a[5],b[3]+=a[5]}static transform(a,b){return[a[0]*b[0]+a[2]*b[1],a[1]*b[0]+a[3]*b[1],a[0]*b[2]+a[2]*b[3],a[1]*b[2]+a[3]*b[3],a[0]*b[4]+a[2]*b[5]+a[4],a[1]*b[4]+a[3]*b[5]+a[5]]}static applyTransform(a,b){let c=a[0]*b[0]+a[1]*b[2]+b[4],d=a[0]*b[1]+a[1]*b[3]+b[5];return[c,d]}static applyInverseTransform(a,b){let c=b[0]*b[3]-b[1]*b[2],d=(a[0]*b[3]-a[1]*b[2]+b[2]*b[5]-b[4]*b[3])/c,e=(-a[0]*b[1]+a[1]*b[0]+b[4]*b[1]-b[5]*b[0])/c;return[d,e]}static getAxialAlignedBoundingBox(a,b){let c=this.applyTransform(a,b),d=this.applyTransform(a.slice(2,4),b),e=this.applyTransform([a[0],a[3]],b),f=this.applyTransform([a[2],a[1]],b);return[Math.min(c[0],d[0],e[0],f[0]),Math.min(c[1],d[1],e[1],f[1]),Math.max(c[0],d[0],e[0],f[0]),Math.max(c[1],d[1],e[1],f[1])]}static inverseTransform(a){let b=a[0]*a[3]-a[1]*a[2];return[a[3]/b,-a[1]/b,-a[2]/b,a[0]/b,(a[2]*a[5]-a[4]*a[3])/b,(a[4]*a[1]-a[5]*a[0])/b]}static singularValueDecompose2dScale(a){let b=[a[0],a[2],a[1],a[3]],c=a[0]*b[0]+a[1]*b[2],d=a[0]*b[1]+a[1]*b[3],e=a[2]*b[0]+a[3]*b[2],f=a[2]*b[1]+a[3]*b[3],g=(c+f)/2,h=Math.sqrt((c+f)**2-4*(c*f-e*d))/2;return[Math.sqrt(g+h||1),Math.sqrt(g-h||1)]}static normalizeRect(a){let b=a.slice(0);return a[0]>a[2]&&(b[0]=a[2],b[2]=a[0]),a[1]>a[3]&&(b[1]=a[3],b[3]=a[1]),b}static intersect(a,b){let c=Math.max(Math.min(a[0],a[2]),Math.min(b[0],b[2])),d=Math.min(Math.max(a[0],a[2]),Math.max(b[0],b[2]));if(c>d)return null;let e=Math.max(Math.min(a[1],a[3]),Math.min(b[1],b[3])),f=Math.min(Math.max(a[1],a[3]),Math.max(b[1],b[3]));return e>f?null:[c,e,d,f]}static bezierBoundingBox(a,b,c,d,e,f,g,h){let i,j,k,l,m,n,o,p,q=[],r=[[],[]];for(let r=0;r<2;++r){if(0===r?(j=6*a-12*c+6*e,i=-3*a+9*c-9*e+3*g,k=3*c-3*a):(j=6*b-12*d+6*f,i=-3*b+9*d-9*f+3*h,k=3*d-3*b),1e-12>Math.abs(i)){if(1e-12>Math.abs(j))continue;l=-k/j,0<l&&l<1&&q.push(l);continue}o=j*j-4*k*i,p=Math.sqrt(o),!(o<0)&&(m=(-j+p)/(2*i),0<m&&m<1&&q.push(m),n=(-j-p)/(2*i),0<n&&n<1&&q.push(n))}let s=q.length,t,u=s;for(;s--;)l=q[s],t=1-l,r[0][s]=t*t*t*a+3*t*t*l*c+3*t*l*l*e+l*l*l*g,r[1][s]=t*t*t*b+3*t*t*l*d+3*t*l*l*f+l*l*l*h;return r[0][u]=a,r[1][u]=b,r[0][u+1]=g,r[1][u+1]=h,r[0].length=r[1].length=u+2,[Math.min(...r[0]),Math.min(...r[1]),Math.max(...r[0]),Math.max(...r[1])]}}function U(a){return"object"==typeof a&&a?.byteLength!==void 0}class V{#ek=!1;constructor(){this.promise=new Promise((a,b)=>{this.resolve=b=>{this.#ek=!0,a(b)},this.reject=a=>{this.#ek=!0,b(a)}})}get settled(){return this.#ek}}let W=null,X=null;function Y(a){return W||(W=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,X=new Map([["","t"]])),a.replaceAll(W,(a,b,c)=>b?b.normalize("NFKC"):X.get(c))}function Z(){if("undefined"!=typeof crypto&&"function"==typeof crypto?.randomUUID)return crypto.randomUUID();let a=new Uint8Array(32);if("undefined"!=typeof crypto&&"function"==typeof crypto?.getRandomValues)crypto.getRandomValues(a);else for(let b=0;b<32;b++)a[b]=Math.floor(255*Math.random());return N(a)}let $="pdfjs_internal_id_"}},i={};function j(a){var b=i[a];if(void 0!==b)return b.exports;var c=i[a]={exports:{}};return h[a](c,c.exports,j),c.exports}d="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",f="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",g=a=>{a&&a.d<1&&(a.d=1,a.forEach(a=>a.r--),a.forEach(a=>a.r--?a.r++:a()))},j.a=(a,b,c)=>{c&&((h=[]).d=-1);var h,i,j,k,l=new Set,m=a.exports,n=new Promise((a,b)=>{k=b,j=a});n[e]=m,n[d]=a=>(h&&a(h),l.forEach(a),n.catch(a=>{})),a.exports=n,b(a=>{i=a.map(a=>{if(null!==a&&"object"==typeof a){if(a[d])return a;if(a.then){var b=[];b.d=0,a.then(a=>{c[e]=a,g(b)},a=>{c[f]=a,g(b)});var c={};return c[d]=a=>a(b),c}}var h={};return h[d]=a=>{},h[e]=a,h});var b,c=()=>i.map(a=>{if(a[f])throw a[f];return a[e]}),j=new Promise(a=>{(b=()=>a(c)).r=0;var e=a=>a!==h&&!l.has(a)&&(l.add(a),a&&!a.d&&(b.r++,a.push(b)));i.map(a=>a[d](e))});return b.r?j:c()},a=>(a?k(n[f]=a):j(m),g(h))),h&&h.d<0&&(h.d=0)},j.d=(a,b)=>{for(var c in b)j.o(b,c)&&!j.o(a,c)&&Object.defineProperty(a,c,{enumerable:!0,get:b[c]})},j.o=(a,b)=>Object.prototype.hasOwnProperty.call(a,b);var k=j(907);(k=globalThis.pdfjsLib=await (globalThis.pdfjsLibPromise=k)).AbortException,k.AnnotationEditorLayer,k.AnnotationEditorParamsType,k.AnnotationEditorType,k.AnnotationEditorUIManager,k.AnnotationLayer,k.AnnotationMode,k.CMapCompressionType,k.ColorPicker,k.DOMSVGFactory,k.DrawLayer,k.FeatureTest;var l=k.GlobalWorkerOptions;k.ImageKind,k.InvalidPDFException,k.MissingPDFException,k.OPS,k.Outliner,k.PDFDataRangeTransport,k.PDFDateString,k.PDFWorker,k.PasswordResponses,k.PermissionFlag,k.PixelsPerInch,k.PromiseCapability,k.RenderingCancelledException,k.UnexpectedResponseException,k.Util,k.VerbosityLevel,k.XfaLayer,k.build,k.createValidAbsoluteUrl,k.fetchData;var m=k.getDocument;k.getFilenameFromUrl,k.getPdfFilenameFromUrl,k.getXfaPageViewport,k.isDataScheme,k.isPdfFile,k.noContextMenu,k.normalizeUnicode,k.renderTextLayer,k.setLayerDimensions,k.shadow,k.updateTextLayer,k.version,a.s(["GlobalWorkerOptions",()=>l,"getDocument",()=>m]),c()}catch(a){c(a)}},!0),77688,a=>a.a(async(b,c)=>{try{var d=a.i(39415),e=a.i(34415),f=a.i(78691),g=a.i(33142),h=a.i(40915),i=a.i(47109),j=a.i(61085),k=a.i(53696),l=a.i(59501),m=a.i(57316),n=a.i(9086),o=a.i(69763),p=b([o]);function q(){let a=(0,f.useRouter)(),{config:b,setConfig:c,resetInterview:p}=(0,g.useInterview)(),[q,r]=(0,e.useState)(""),[s,t]=(0,e.useState)(h.DOMAINS[0]),[u,v]=(0,e.useState)(i.Difficulty.MID),[w,x]=(0,e.useState)(""),[y,z]=(0,e.useState)(null),[A,B]=(0,e.useState)(!1),C=async a=>{if(a){z(a.name),B(!0);try{if("application/pdf"===a.type){let b=await a.arrayBuffer(),c=await (0,o.getDocument)({data:b}).promise,d="";for(let a=1;a<=c.numPages;a++){let b=await c.getPage(a),e=await b.getTextContent();d+=e.items.map(a=>a.str).join(" ")+"\n"}x(d.trim())}else{let b=new FileReader;b.onload=a=>x(a.target?.result),b.readAsText(a)}}catch(a){console.error(a),z("Error processing file")}finally{B(!1)}}};return(0,d.jsx)("div",{className:"min-h-screen bg-bg text-txt-main font-sans flex flex-col",children:(0,d.jsxs)("div",{className:"w-full max-w-3xl mx-auto px-6 py-12 flex-1 flex flex-col",children:[(0,d.jsxs)("button",{onClick:()=>a.push("/"),className:"self-start mb-12 text-txt-sec hover:text-txt-main flex items-center gap-2 transition-colors",children:[(0,d.jsx)(j.ArrowLeft,{className:"w-4 h-4"})," Back"]}),(0,d.jsx)("h1",{className:"text-3xl font-light text-txt-main mb-2",children:"Configure Session"}),(0,d.jsx)("p",{className:"text-txt-sec text-sm mb-10",children:"Set parameters for the interview simulation."}),(0,d.jsxs)("div",{className:"space-y-10",children:[(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsx)("label",{className:"block text-xs font-mono text-accent uppercase",children:"Candidate Name"}),(0,d.jsx)("input",{type:"text",value:q,onChange:a=>r(a.target.value),placeholder:"Enter your name",className:"w-full bg-transparent border-b border-border py-2 text-xl text-txt-main placeholder-border focus:border-txt-main focus:outline-none transition-colors rounded-none"})]}),(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsx)("label",{className:"block text-xs font-mono text-accent uppercase",children:"Specialization"}),(0,d.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:h.DOMAINS.map(a=>(0,d.jsx)("button",{onClick:()=>t(a),className:`text-left px-4 py-3 border rounded-md text-sm transition-all ${s===a?"border-txt-main bg-white/5 text-txt-main":"border-border text-txt-sec hover:border-accent"}`,children:a},a))})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-10",children:[(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsx)("label",{className:"block text-xs font-mono text-accent uppercase",children:"Difficulty"}),(0,d.jsx)("div",{className:"flex flex-col gap-2",children:Object.values(i.Difficulty).map(a=>(0,d.jsxs)("button",{onClick:()=>v(a),className:`text-left px-4 py-3 border rounded-md text-sm transition-all flex justify-between ${u===a?"border-txt-main bg-white/5 text-txt-main":"border-border text-txt-sec hover:border-accent"}`,children:[a,u===a&&(0,d.jsx)(k.Check,{className:"w-4 h-4"})]},a))})]}),(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsx)("label",{className:"block text-xs font-mono text-accent uppercase",children:"Resume (Optional)"}),(0,d.jsxs)("div",{className:"border border-dashed border-border rounded-md p-6 flex flex-col items-center justify-center text-center hover:bg-white/5 transition-colors relative",children:[(0,d.jsx)("input",{type:"file",accept:".pdf,.txt",className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",onChange:a=>a.target.files?.[0]&&C(a.target.files[0])}),A?(0,d.jsx)(m.Loader2,{className:"w-6 h-6 text-txt-main animate-spin"}):y?(0,d.jsxs)("div",{className:"flex items-center gap-2 text-txt-main",children:[(0,d.jsx)(n.FileText,{className:"w-4 h-4"}),(0,d.jsx)("span",{className:"text-sm underline",children:y})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(l.Upload,{className:"w-6 h-6 text-border mb-2"}),(0,d.jsx)("span",{className:"text-sm text-txt-sec",children:"Upload PDF/TXT"})]})]})]})]})]}),(0,d.jsx)("div",{className:"mt-16 flex justify-end",children:(0,d.jsx)("button",{onClick:()=>{q.trim()&&(p(),c({candidateName:q,domain:s,difficulty:u,resumeText:w}),a.push("/room"))},disabled:!q.trim()||A,className:`px-8 py-3 bg-txt-main text-bg font-semibold rounded-md transition-all ${!q.trim()||A?"opacity-50 cursor-not-allowed":"hover:bg-white"}`,children:"Start Interview"})})]})})}[o]=p.then?(await p)():p,o.GlobalWorkerOptions.workerSrc="https://cdn.jsdelivr.net/npm/pdfjs-dist@4.0.379/build/pdf.worker.min.mjs",a.s(["default",()=>q]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=nexus_fb329ae6._.js.map